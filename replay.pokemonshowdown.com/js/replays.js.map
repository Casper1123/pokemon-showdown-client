{"version":3,"file":"replays.js","names":["PSRouter","_PSModel","_class","_this","call","baseLoc","leftLoc","rightLoc","forceSinglePanel","stickyRight","baseLocSlashIndex","document","location","href","lastIndexOf","slice","Net","defaultRoute","replace","go","setSinglePanel","window","history","addEventListener","e","popState","update","onresize","_inheritsLoose","_proto","prototype","showingLeft","showingRight","route","startsWith","init","singlePanel","innerWidth","innerHeight","push","_window$history","pushState","loc","length","_window$history2","replaceState","Array","isArray","state","_e$state","PSModel","PSReplays","_preact$Component","apply","arguments","updateDarkMode","dark","darkMode","matchMedia","matches","documentElement","className","_proto2","componentDidMount","_this2","subscribe","forceUpdate","base","el","target","parentNode","tagName","preventDefault","stopImmediatePropagation","Config","routes","client","get","then","response","data","JSON","parse","Object","assign","customcolors","render","position","display","flexDirection","justifyContent","preact","h","style","SearchPanel","id","BattlePanel","clear","Component","getElementById","event"],"sources":["../src/replays.tsx"],"sourcesContent":["/** @jsx preact.h */\r\nimport preact from '../../play.pokemonshowdown.com/js/lib/preact';\r\nimport { Net, PSModel } from './utils';\r\nimport { BattlePanel } from './replays-battle';\r\nimport { SearchPanel } from './replays-index';\r\ndeclare const Config: any;\r\n\r\nexport const PSRouter = new class extends PSModel {\r\n\tbaseLoc: string;\r\n\tleftLoc: string | null = null;\r\n\trightLoc: string | null = null;\r\n\tforceSinglePanel = false;\r\n\tstickyRight = true;\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tconst baseLocSlashIndex = document.location.href.lastIndexOf('/');\r\n\t\tthis.baseLoc = document.location.href.slice(0, baseLocSlashIndex + 1);\r\n\t\tif (Net.defaultRoute) {\r\n\t\t\tthis.baseLoc = document.location.href.replace(/#.*/, '') + '#';\r\n\t\t}\r\n\t\tthis.go(document.location.href);\r\n\t\tthis.setSinglePanel(true);\r\n\t\tif (window.history) window.addEventListener('popstate', e => {\r\n\t\t\tPSRouter.popState(e);\r\n\t\t\tthis.update();\r\n\t\t});\r\n\t\twindow.onresize = () => {\r\n\t\t\tPSRouter.setSinglePanel();\r\n\t\t};\r\n\t}\r\n\tshowingLeft() {\r\n\t\treturn this.leftLoc !== null && (!this.forceSinglePanel || this.rightLoc === null);\r\n\t}\r\n\tshowingRight() {\r\n\t\treturn this.rightLoc !== null;\r\n\t}\r\n\thref(route: string | null) {\r\n\t\treturn `${Net.defaultRoute ? '#' : route?.startsWith('?') ? './' : ''}${route || ''}` || '.';\r\n\t}\r\n\tsetSinglePanel(init?: boolean) {\r\n\t\tconst singlePanel = window.innerWidth < 1300;\r\n\t\tconst stickyRight = (window.innerHeight > 614);\r\n\t\tif (this.forceSinglePanel !== singlePanel || this.stickyRight !== stickyRight) {\r\n\t\t\tthis.forceSinglePanel = singlePanel;\r\n\t\t\tthis.stickyRight = stickyRight;\r\n\t\t\tif (!init) this.update();\r\n\t\t}\r\n\t}\r\n\tpush(href: string): boolean {\r\n\t\tif (!href.startsWith(this.baseLoc)) return false;\r\n\r\n\t\tif (this.go(href)) {\r\n\t\t\twindow.history?.pushState([this.leftLoc, this.rightLoc], '', href);\r\n\t\t}\r\n\t\treturn true;\r\n\t}\r\n\t/** returns whether the URL should change */\r\n\tgo(href: string): boolean {\r\n\t\tif (!href.startsWith(this.baseLoc) && href + '#' !== this.baseLoc) return false;\r\n\r\n\t\tconst loc = href.slice(this.baseLoc.length);\r\n\t\tif (!loc || loc.startsWith('?')) {\r\n\t\t\tthis.leftLoc = loc;\r\n\t\t\tif (this.forceSinglePanel) {\r\n\t\t\t\tthis.rightLoc = null;\r\n\t\t\t} else {\r\n\t\t\t\treturn this.rightLoc === null;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tthis.rightLoc = loc;\r\n\t\t}\r\n\t\treturn true;\r\n\t}\r\n\treplace(loc: string) {\r\n\t\tconst href = this.baseLoc + loc;\r\n\t\tif (this.go(href)) {\r\n\t\t\twindow.history?.replaceState([this.leftLoc, this.rightLoc], '', href);\r\n\t\t}\r\n\t\treturn true;\r\n\t}\r\n\tpopState(e: PopStateEvent) {\r\n\t\tif (Array.isArray(e.state)) {\r\n\t\t\tconst [leftLoc, rightLoc] = e.state;\r\n\t\t\tthis.leftLoc = leftLoc;\r\n\t\t\tthis.rightLoc = rightLoc;\r\n\t\t\tif (this.forceSinglePanel) this.leftLoc = null;\r\n\t\t} else {\r\n\t\t\tthis.leftLoc = null;\r\n\t\t\tthis.rightLoc = null;\r\n\t\t\tthis.go(document.location.href);\r\n\t\t}\r\n\t\tthis.update();\r\n\t}\r\n};\r\n\r\nexport class PSReplays extends preact.Component {\r\n\tstatic darkMode: 'dark' | 'light' | 'auto' = 'auto';\r\n\tstatic updateDarkMode() {\r\n\t\tlet dark = this.darkMode === 'dark' ? 'dark' : '';\r\n\t\tif (this.darkMode === 'auto') {\r\n\t\t\tdark = window.matchMedia?.('(prefers-color-scheme: dark)').matches ? 'dark' : '';\r\n\t\t}\r\n\t\tdocument.documentElement.className = dark;\r\n\t}\r\n\toverride componentDidMount() {\r\n\t\tPSRouter.subscribe(() => this.forceUpdate());\r\n\t\tif (window.history) {\r\n\t\t\tthis.base!.addEventListener('click', e => {\r\n\t\t\t\tlet el = e.target as HTMLElement;\r\n\t\t\t\tfor (; el; el = el.parentNode as HTMLElement) {\r\n\t\t\t\t\tif (el.tagName === 'A' && PSRouter.push((el as HTMLAnchorElement).href)) {\r\n\t\t\t\t\t\te.preventDefault();\r\n\t\t\t\t\t\te.stopImmediatePropagation();\r\n\t\t\t\t\t\tthis.forceUpdate();\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t\t// load custom colors from loginserver\r\n\t\tNet(`https://${Config.routes.client}/config/colors.json`).get().then(response => {\r\n\t\t\tconst data = JSON.parse(response);\r\n\t\t\tObject.assign(Config.customcolors, data);\r\n\t\t});\r\n\t}\r\n\toverride render() {\r\n\t\tconst position = PSRouter.showingLeft() && PSRouter.showingRight() && !PSRouter.stickyRight ?\r\n\t\t\t{ display: 'flex', flexDirection: 'column', justifyContent: 'flex-end' } : {};\r\n\t\treturn <div\r\n\t\t\tclass={'bar-wrapper' + (PSRouter.showingLeft() && PSRouter.showingRight() ? ' has-sidebar' : '')} style={position}\r\n\t\t>\r\n\t\t\t{PSRouter.showingLeft() && <SearchPanel id={PSRouter.leftLoc!} />}\r\n\t\t\t{PSRouter.showingRight() && <BattlePanel id={PSRouter.rightLoc!} />}\r\n\t\t\t<div style={{ clear: 'both' }}></div>\r\n\t\t</div>;\r\n\t}\r\n}\r\n\r\npreact.render(<PSReplays />, document.getElementById('main')!);\r\n\r\nif (window.matchMedia?.('(prefers-color-scheme: dark)').matches) {\r\n\tdocument.documentElement.className = 'dark';\r\n}\r\nwindow.matchMedia?.('(prefers-color-scheme: dark)').addEventListener('change', event => {\r\n\tif (PSReplays.darkMode === 'auto') document.documentElement.className = event.matches ? \"dark\" : \"\";\r\n});\r\n"],"mappings":";;;;;;;AAOO,GAAM,CAAAA,QAAQ,CAAG,aAAAC,QAAA;;;;;;AAMvB,SAAAC,OAAA,CAAc,KAAAC,KAAA;AACbA,KAAA,CAAAF,QAAA,CAAAG,IAAA,KAAM,CAAC,OAACD,KAAA,CANTE,OAAO,QAAAF,KAAA,CACPG,OAAO,CAAkB,IAAI,CAAAH,KAAA,CAC7BI,QAAQ,CAAkB,IAAI,CAAAJ,KAAA,CAC9BK,gBAAgB,CAAG,KAAK,CAAAL,KAAA,CACxBM,WAAW,CAAG,IAAI;AAGjB,GAAM,CAAAC,iBAAiB,CAAGC,QAAQ,CAACC,QAAQ,CAACC,IAAI,CAACC,WAAW,CAAC,GAAG,CAAC;AACjEX,KAAA,CAAKE,OAAO,CAAGM,QAAQ,CAACC,QAAQ,CAACC,IAAI,CAACE,KAAK,CAAC,CAAC,CAAEL,iBAAiB,CAAG,CAAC,CAAC;AACrE,GAAIM,GAAG,CAACC,YAAY,CAAE;AACrBd,KAAA,CAAKE,OAAO,CAAGM,QAAQ,CAACC,QAAQ,CAACC,IAAI,CAACK,OAAO,CAAC,KAAK,CAAE,EAAE,CAAC,CAAG,GAAG;AAC/D;AACAf,KAAA,CAAKgB,EAAE,CAACR,QAAQ,CAACC,QAAQ,CAACC,IAAI,CAAC;AAC/BV,KAAA,CAAKiB,cAAc,CAAC,IAAI,CAAC;AACzB,GAAIC,MAAM,CAACC,OAAO,CAAED,MAAM,CAACE,gBAAgB,CAAC,UAAU,CAAE,SAAAC,CAAC,CAAI;AAC5DxB,QAAQ,CAACyB,QAAQ,CAACD,CAAC,CAAC;AACpBrB,KAAA,CAAKuB,MAAM,CAAC,CAAC;AACd,CAAC,CAAC;AACFL,MAAM,CAACM,QAAQ,CAAG,UAAM;AACvB3B,QAAQ,CAACoB,cAAc,CAAC,CAAC;AAC1B,CAAC,CAAC,OAAAjB,KAAA;AACH,CAACyB,cAAA,CAAA1B,MAAA,CAAAD,QAAA,MAAA4B,MAAA,CAAA3B,MAAA,CAAA4B,SAAA,CAAAD,MAAA;AACDE,WAAW,CAAX,SAAAA,WAAWA,CAAA,CAAG;AACb,MAAO,KAAI,CAACzB,OAAO,GAAK,IAAI,GAAK,CAAC,IAAI,CAACE,gBAAgB,EAAI,IAAI,CAACD,QAAQ,GAAK,IAAI,CAAC;AACnF,CAAC,CAAAsB,MAAA;AACDG,YAAY,CAAZ,SAAAA,YAAYA,CAAA,CAAG;AACd,MAAO,KAAI,CAACzB,QAAQ,GAAK,IAAI;AAC9B,CAAC,CAAAsB,MAAA;AACDhB,IAAI,CAAJ,SAAAA,IAAIA,CAACoB,KAAoB,CAAE;AAC1B,MAAO,IAAGjB,GAAG,CAACC,YAAY,CAAG,GAAG,CAAGgB,KAAK,QAALA,KAAK,CAAEC,UAAU,CAAC,GAAG,CAAC,CAAG,IAAI,CAAG,EAAE,GAAGD,KAAK,EAAI,EAAE,GAAM,GAAG;AAC7F,CAAC,CAAAJ,MAAA;AACDT,cAAc,CAAd,SAAAA,cAAcA,CAACe,IAAc,CAAE;AAC9B,GAAM,CAAAC,WAAW,CAAGf,MAAM,CAACgB,UAAU,CAAG,IAAI;AAC5C,GAAM,CAAA5B,WAAW,CAAIY,MAAM,CAACiB,WAAW,CAAG,GAAI;AAC9C,GAAI,IAAI,CAAC9B,gBAAgB,GAAK4B,WAAW,EAAI,IAAI,CAAC3B,WAAW,GAAKA,WAAW,CAAE;AAC9E,IAAI,CAACD,gBAAgB,CAAG4B,WAAW;AACnC,IAAI,CAAC3B,WAAW,CAAGA,WAAW;AAC9B,GAAI,CAAC0B,IAAI,CAAE,IAAI,CAACT,MAAM,CAAC,CAAC;AACzB;AACD,CAAC,CAAAG,MAAA;AACDU,IAAI,CAAJ,SAAAA,IAAIA,CAAC1B,IAAY,CAAW;AAC3B,GAAI,CAACA,IAAI,CAACqB,UAAU,CAAC,IAAI,CAAC7B,OAAO,CAAC,CAAE,MAAO,MAAK;;AAEhD,GAAI,IAAI,CAACc,EAAE,CAACN,IAAI,CAAC,CAAE,KAAA2B,eAAA;AAClB,CAAAA,eAAA,CAAAnB,MAAM,CAACC,OAAO,SAAdkB,eAAA,CAAgBC,SAAS,CAAC,CAAC,IAAI,CAACnC,OAAO,CAAE,IAAI,CAACC,QAAQ,CAAC,CAAE,EAAE,CAAEM,IAAI,CAAC;AACnE;AACA,MAAO,KAAI;AACZ,CAAC,CAAAgB,MAAA;;AAEDV,EAAE,CAAF,SAAAA,EAAEA,CAACN,IAAY,CAAW;AACzB,GAAI,CAACA,IAAI,CAACqB,UAAU,CAAC,IAAI,CAAC7B,OAAO,CAAC,EAAIQ,IAAI,CAAG,GAAG,GAAK,IAAI,CAACR,OAAO,CAAE,MAAO,MAAK;;AAE/E,GAAM,CAAAqC,GAAG,CAAG7B,IAAI,CAACE,KAAK,CAAC,IAAI,CAACV,OAAO,CAACsC,MAAM,CAAC;AAC3C,GAAI,CAACD,GAAG,EAAIA,GAAG,CAACR,UAAU,CAAC,GAAG,CAAC,CAAE;AAChC,IAAI,CAAC5B,OAAO,CAAGoC,GAAG;AAClB,GAAI,IAAI,CAAClC,gBAAgB,CAAE;AAC1B,IAAI,CAACD,QAAQ,CAAG,IAAI;AACrB,CAAC,IAAM;AACN,MAAO,KAAI,CAACA,QAAQ,GAAK,IAAI;AAC9B;AACD,CAAC,IAAM;AACN,IAAI,CAACA,QAAQ,CAAGmC,GAAG;AACpB;AACA,MAAO,KAAI;AACZ,CAAC,CAAAb,MAAA;AACDX,OAAO,CAAP,SAAAA,OAAOA,CAACwB,GAAW,CAAE;AACpB,GAAM,CAAA7B,IAAI,CAAG,IAAI,CAACR,OAAO,CAAGqC,GAAG;AAC/B,GAAI,IAAI,CAACvB,EAAE,CAACN,IAAI,CAAC,CAAE,KAAA+B,gBAAA;AAClB,CAAAA,gBAAA,CAAAvB,MAAM,CAACC,OAAO,SAAdsB,gBAAA,CAAgBC,YAAY,CAAC,CAAC,IAAI,CAACvC,OAAO,CAAE,IAAI,CAACC,QAAQ,CAAC,CAAE,EAAE,CAAEM,IAAI,CAAC;AACtE;AACA,MAAO,KAAI;AACZ,CAAC,CAAAgB,MAAA;AACDJ,QAAQ,CAAR,SAAAA,QAAQA,CAACD,CAAgB,CAAE;AAC1B,GAAIsB,KAAK,CAACC,OAAO,CAACvB,CAAC,CAACwB,KAAK,CAAC,CAAE;AAC3B,IAAAC,QAAA,CAA4BzB,CAAC,CAACwB,KAAK,CAA5B1C,OAAO,CAAA2C,QAAA,IAAE1C,QAAQ,CAAA0C,QAAA;AACxB,IAAI,CAAC3C,OAAO,CAAGA,OAAO;AACtB,IAAI,CAACC,QAAQ,CAAGA,QAAQ;AACxB,GAAI,IAAI,CAACC,gBAAgB,CAAE,IAAI,CAACF,OAAO,CAAG,IAAI;AAC/C,CAAC,IAAM;AACN,IAAI,CAACA,OAAO,CAAG,IAAI;AACnB,IAAI,CAACC,QAAQ,CAAG,IAAI;AACpB,IAAI,CAACY,EAAE,CAACR,QAAQ,CAACC,QAAQ,CAACC,IAAI,CAAC;AAChC;AACA,IAAI,CAACa,MAAM,CAAC,CAAC;AACd,CAAC,QAAAxB,MAAA,GArFwCgD,OAAO;AAsFjD,CAAC,CAAC;;AAEWC,SAAS,UAAAC,iBAAA,WAAAD,UAAA,SAAAC,iBAAA,CAAAC,KAAA,MAAAC,SAAA,SAAA1B,cAAA,CAAAuB,SAAA,CAAAC,iBAAA,EAAAD,SAAA;;AAEdI,cAAc,CAArB,QAAO,CAAAA,cAAcA,CAAA,CAAG;AACvB,GAAI,CAAAC,IAAI,CAAG,IAAI,CAACC,QAAQ,GAAK,MAAM,CAAG,MAAM,CAAG,EAAE;AACjD,GAAI,IAAI,CAACA,QAAQ,GAAK,MAAM,CAAE;AAC7BD,IAAI,CAAGnC,MAAM,CAACqC,UAAU,QAAjBrC,MAAM,CAACqC,UAAU,CAAG,8BAA8B,CAAC,CAACC,OAAO,CAAG,MAAM,CAAG,EAAE;AACjF;AACAhD,QAAQ,CAACiD,eAAe,CAACC,SAAS,CAAGL,IAAI;AAC1C,CAAC,KAAAM,OAAA,CAAAX,SAAA,CAAArB,SAAA,CAAAgC,OAAA;AACQC,iBAAiB,CAA1B,QAAS,CAAAA,iBAAiBA,CAAA,CAAG,KAAAC,MAAA;AAC5BhE,QAAQ,CAACiE,SAAS,CAAC,iBAAM,CAAAD,MAAI,CAACE,WAAW,CAAC,CAAC,GAAC;AAC5C,GAAI7C,MAAM,CAACC,OAAO,CAAE;AACnB,IAAI,CAAC6C,IAAI,CAAE5C,gBAAgB,CAAC,OAAO,CAAE,SAAAC,CAAC,CAAI;AACzC,GAAI,CAAA4C,EAAE,CAAG5C,CAAC,CAAC6C,MAAqB;AAChC,KAAOD,EAAE,CAAEA,EAAE,CAAGA,EAAE,CAACE,UAAyB,CAAE;AAC7C,GAAIF,EAAE,CAACG,OAAO,GAAK,GAAG,EAAIvE,QAAQ,CAACuC,IAAI,CAAE6B,EAAE,CAAuBvD,IAAI,CAAC,CAAE;AACxEW,CAAC,CAACgD,cAAc,CAAC,CAAC;AAClBhD,CAAC,CAACiD,wBAAwB,CAAC,CAAC;AAC5BT,MAAI,CAACE,WAAW,CAAC,CAAC;AAClB;AACD;AACD;AACD,CAAC,CAAC;AACH;;AAEAlD,GAAG,YAAY0D,MAAM,CAACC,MAAM,CAACC,MAAM,sBAAqB,CAAC,CAACC,GAAG,CAAC,CAAC,CAACC,IAAI,CAAC,SAAAC,QAAQ,CAAI;AAChF,GAAM,CAAAC,IAAI,CAAGC,IAAI,CAACC,KAAK,CAACH,QAAQ,CAAC;AACjCI,MAAM,CAACC,MAAM,CAACV,MAAM,CAACW,YAAY,CAAEL,IAAI,CAAC;AACzC,CAAC,CAAC;AACH,CAAC,CAAAlB,OAAA;AACQwB,MAAM,CAAf,QAAS,CAAAA,MAAMA,CAAA,CAAG;AACjB,GAAM,CAAAC,QAAQ,CAAGvF,QAAQ,CAAC+B,WAAW,CAAC,CAAC,EAAI/B,QAAQ,CAACgC,YAAY,CAAC,CAAC,EAAI,CAAChC,QAAQ,CAACS,WAAW;AAC1F,CAAE+E,OAAO,CAAE,MAAM,CAAEC,aAAa,CAAE,QAAQ,CAAEC,cAAc,CAAE,UAAW,CAAC,CAAG,CAAC,CAAC;AAC9E,MAAO,CAAAC,MAAA,CAAAC,CAAA;AACN,QAAO,aAAa,EAAI5F,QAAQ,CAAC+B,WAAW,CAAC,CAAC,EAAI/B,QAAQ,CAACgC,YAAY,CAAC,CAAC,CAAG,cAAc,CAAG,EAAE,CAAE,CAAC6D,KAAK,CAAEN,QAAS;;AAEjHvF,QAAQ,CAAC+B,WAAW,CAAC,CAAC,EAAI4D,MAAA,CAAAC,CAAA,CAACE,WAAW,EAACC,EAAE,CAAE/F,QAAQ,CAACM,OAAS,CAAE,CAAC;AAChEN,QAAQ,CAACgC,YAAY,CAAC,CAAC,EAAI2D,MAAA,CAAAC,CAAA,CAACI,WAAW,EAACD,EAAE,CAAE/F,QAAQ,CAACO,QAAU,CAAE,CAAC;AACnEoF,MAAA,CAAAC,CAAA,QAAKC,KAAK,CAAE,CAAEI,KAAK,CAAE,MAAO,CAAE,CAAM;AAChC,CAAC;AACP,CAAC,QAAA9C,SAAA,GAxC6BwC,MAAM,CAACO,SAAS,EAAlC/C,SAAS,CACdM,QAAQ,CAA8B,MAAM;;;AA0CpDkC,MAAM,CAACL,MAAM,CAACK,MAAA,CAAAC,CAAA,CAACzC,SAAS,KAAE,CAAC,CAAExC,QAAQ,CAACwF,cAAc,CAAC,MAAM,CAAE,CAAC;;AAE9D,GAAI9E,MAAM,CAACqC,UAAU,QAAjBrC,MAAM,CAACqC,UAAU,CAAG,8BAA8B,CAAC,CAACC,OAAO,CAAE;AAChEhD,QAAQ,CAACiD,eAAe,CAACC,SAAS,CAAG,MAAM;AAC5C;AACAxC,MAAM,CAACqC,UAAU,cAAjBrC,MAAM,CAACqC,UAAU,CAAG,8BAA8B,CAAC,CAACnC,gBAAgB,CAAC,QAAQ,CAAE,SAAA6E,KAAK,CAAI;AACvF,GAAIjD,SAAS,CAACM,QAAQ,GAAK,MAAM,CAAE9C,QAAQ,CAACiD,eAAe,CAACC,SAAS,CAAGuC,KAAK,CAACzC,OAAO,CAAG,MAAM,CAAG,EAAE;AACpG,CAAC,CAAC","ignoreList":[]}