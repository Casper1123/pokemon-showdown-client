{"version":3,"file":"panel-mainmenu.js","names":["MainMenuRoom","_PSRoom","options","_this","call","classType","userdetailsCache","roomsCache","searchCountdown","searchSent","search","searching","games","disallowSpectators","PS","prefs","disallowspectators","startSearch","format","team","requestNotifications","alert","packedTeam","countdown","timer","setInterval","doSearchCountdown","update","cancelSearch","_this$search$searchin","clearTimeout","length","send","doSearch","privacy","adjustPrivacy","backlog","rooms","mainmenu","_i2","_this$backlog2","args","receiveLine","_inheritsLoose","_proto","prototype","set","cmd","challstr","user","PSLoginServer","query","then","res","username","initializing","replace","loggedin","registered","name","userid","toID","handleAssertion","assertion","fullName","namedCode","avatar","named","setName","teams","loadRemoteTeams","challengesBuf","receiveChallenges","searchBuf","receiveSearch","queryId","responseJSON","handleQueryResponse","JSON","parse","_sideRoom$log","user1","user2","message","handlePM","sideRoom","rightPanel","type","inchatpm","log","add","parseFormats","lobby","dataBuf","json","_unused","challengesFrom","getPMRoom","challengeTo","to","roomid","_json$challengeTo","_json$challengeTo2","room","pmTarget","targetUserid","challenged","challenging","parseChallenge","_unused2","formatsList","isSection","section","column","window","NonBattleGames","rps","i","BattleFormats","j","entry","usesLocalLadder","startsWith","isNaN","Number","slice","parseInt","_BattleFormats$id","searchShow","challengeShow","tournamentShow","teambuilderLevel","lastCommaIndex","lastIndexOf","code","substr","NaN","id","isTeambuilderFormat","endsWith","teambuilderFormat","teambuilderFormatName","parenPos","indexOf","trim","rated","effectType","FormatModMapping","modid","BattleTeambuilderTable","Dex","loadModData","multivariantFormats","battleFormat","userid1","userid2","pmTargetid","addRoom","updateTarget","response","_PS$rooms","_PS$rooms2","_PS$rooms3","userdetails","Object","assign","pspl","_i4","_response$pspl2","roomInfo","spotlight","chat","concat","official","_i6","_response$official2","roomsRoom","battlesRoom","battleTable","battles","battleid","push","_i8","_Object$entries2","entries","_ref","ladderRoom","uploading","_PS$rooms4","_PS$rooms$teambuilder","uploaded","teamid","notLoaded","key","teambuilder","_i0","_PS$teams$list2","list","_PS$rooms5","_PS$rooms$teambuilder2","PSRoom","NewsPanel","_PSRoomPanel","_this2","_len","arguments","Array","_key","apply","change","ev","target","currentTarget","value","document","cookie","location","href","_proto2","render","cookieSet","includes","preact","h","PSPanelWrapper","props","fullSize","scrollable","onChange","checked","style","dangerouslySetInnerHTML","__html","newsHTML","PSRoomPanel","routes","title","MainMenuPanel","_PSRoomPanel2","_this3","_len2","_key2","submitSearch","join","parentElem","base","querySelector","handleDragStart","e","_PS$rightPanel","getRoom","foreground","leftPanel","dragging","handleDragEnter","_PS$dragging","_PS$rooms$draggingRoo","preventDefault","draggingRoom","draggedOverRoom","index","miniRoomList","dragOnto","handleClickMinimize","_e$target","_e$target2","getAttribute","parentNode","minimized","forceUpdate","_proto3","focus","_this$base","renderMiniRoom","RoomType","roomTypes","Panel","renderMiniRooms","_this4","map","notifying","notifications","isSubtleNotifying","draggable","onDragStart","onClick","tabIndex","renderGames","_ref2","gameName","renderSearchButton","_PS$mainmenu$searchCo","down","textAlign","width","height","src","Config","client","alt","isOffline","_PS$connection","TeamForm","onSubmit","selectType","disabled","connection","reconnectTimer","Math","round","reconnectDelay","Fragment","onlineButton","tinyLayout","onDragEnter","display","leftPanelWidth","server","dex","replays","root","Model","icon","FormatDropdown","_preact$Component","_this5","_len3","_key3","_proto4","componentWillMount","undefined","defaultFormat","_this$format$split","split","formatName","customRules","BattleLog","placeholder","Component","TeamDropdown","_preact$Component2","_this6","_len4","_key4","teamFormat","teamKey","_proto5","getDefaultTeam","_i10","_PS$teams$list4","_window$BattleFormats","formatData","PSIcon","pokemon","byKey","TeamBox","noLink","_preact$Component3","_this7","_len5","_key5","changeFormat","submit","validate","loadTeam","_ref3","onValidate","handleClick","tagName","_proto6","starredPrefs","starredformats","starred","keys","filter","reverse","gen","_i12","hideFormat","children","addRoomType"],"sources":["../src/panel-mainmenu.tsx"],"sourcesContent":["/**\r\n * Main menu panel\r\n *\r\n * @author Guangcong Luo <guangcongluo@gmail.com>\r\n * @license AGPLv3\r\n */\r\n\r\nimport preact from \"../js/lib/preact\";\r\nimport { PSLoginServer } from \"./client-connection\";\r\nimport { Config, PS, PSRoom, type RoomID, type RoomOptions, type Team } from \"./client-main\";\r\nimport { PSIcon, PSPanelWrapper, PSRoomPanel } from \"./panels\";\r\nimport type { BattlesRoom } from \"./panel-battle\";\r\nimport type { ChatRoom } from \"./panel-chat\";\r\nimport type { LadderFormatRoom } from \"./panel-ladder\";\r\nimport type { RoomsRoom } from \"./panel-rooms\";\r\nimport { TeamBox, type SelectType } from \"./panel-teamdropdown\";\r\nimport { Dex, toID, type ID } from \"./battle-dex\";\r\nimport type { Args } from \"./battle-text-parser\";\r\nimport { BattleLog } from \"./battle-log\"; // optional\r\n\r\nexport type RoomInfo = {\r\n\ttitle: string, desc?: string, userCount?: number, section?: string, privacy?: 'hidden',\r\n\tspotlight?: string, subRooms?: string[],\r\n};\r\n\r\nexport class MainMenuRoom extends PSRoom {\r\n\toverride readonly classType: string = 'mainmenu';\r\n\tuserdetailsCache: {\r\n\t\t[userid: string]: {\r\n\t\t\tuserid: ID,\r\n\t\t\tname: string,\r\n\t\t\tavatar?: string | number,\r\n\t\t\tstatus?: string,\r\n\t\t\tgroup?: string,\r\n\t\t\tcustomgroup?: string,\r\n\t\t\trooms?: { [roomid: string]: { isPrivate?: true, p1?: string, p2?: string } },\r\n\t\t},\r\n\t} = {};\r\n\troomsCache: {\r\n\t\tbattleCount?: number,\r\n\t\tuserCount?: number,\r\n\t\tchat?: RoomInfo[],\r\n\t\tsectionTitles?: string[],\r\n\t} = {};\r\n\tsearchCountdown: { format: string, packedTeam: string, countdown: number, timer: number } | null = null;\r\n\t/** used to track the moment between \"search sent\" and \"server acknowledged search sent\" */\r\n\tsearchSent = false;\r\n\tsearch: { searching: string[], games: Record<RoomID, string> | null } = { searching: [], games: null };\r\n\tdisallowSpectators: boolean | null = PS.prefs.disallowspectators;\r\n\tconstructor(options: RoomOptions) {\r\n\t\tsuper(options);\r\n\t\tif (this.backlog) {\r\n\t\t\t// these aren't set yet, but a lot of things could go wrong if we don't\r\n\t\t\tPS.rooms[''] = this;\r\n\t\t\tPS.mainmenu = this;\r\n\t\t\tfor (const args of this.backlog) {\r\n\t\t\t\tthis.receiveLine(args);\r\n\t\t\t}\r\n\t\t\tthis.backlog = null;\r\n\t\t}\r\n\t}\r\n\tadjustPrivacy() {\r\n\t\tPS.prefs.set('disallowspectators', this.disallowSpectators);\r\n\t\tif (this.disallowSpectators) return '/noreply /hidenext \\n';\r\n\t\treturn '';\r\n\t}\r\n\tstartSearch = (format: string, team?: Team) => {\r\n\t\tPS.requestNotifications();\r\n\t\tif (this.searchCountdown) {\r\n\t\t\tPS.alert(\"Wait for this countdown to finish first...\");\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis.searchCountdown = {\r\n\t\t\tformat,\r\n\t\t\tpackedTeam: team?.packedTeam || '',\r\n\t\t\tcountdown: 3,\r\n\t\t\ttimer: setInterval(this.doSearchCountdown, 1000),\r\n\t\t};\r\n\t\tthis.update(null);\r\n\t};\r\n\tcancelSearch = () => {\r\n\t\tif (this.searchCountdown) {\r\n\t\t\tclearTimeout(this.searchCountdown.timer);\r\n\t\t\tthis.searchCountdown = null;\r\n\t\t\tthis.update(null);\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\tif (this.searchSent || this.search.searching?.length) {\r\n\t\t\tthis.searchSent = false;\r\n\t\t\tPS.send(`/cancelsearch`);\r\n\t\t\tthis.update(null);\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\treturn false;\r\n\t};\r\n\tdoSearchCountdown = () => {\r\n\t\tif (!this.searchCountdown) return; // ??? race???\r\n\r\n\t\tthis.searchCountdown.countdown--;\r\n\t\tif (this.searchCountdown.countdown <= 0) {\r\n\t\t\tthis.doSearch(this.searchCountdown);\r\n\t\t\tclearTimeout(this.searchCountdown.timer);\r\n\t\t\tthis.searchCountdown = null;\r\n\t\t}\r\n\t\tthis.update(null);\r\n\t};\r\n\tdoSearch = (search: NonNullable<typeof this.searchCountdown>) => {\r\n\t\tthis.searchSent = true;\r\n\t\tconst privacy = this.adjustPrivacy();\r\n\t\tPS.send(`/utm ${search.packedTeam}`);\r\n\t\tPS.send(`${privacy}/search ${search.format}`);\r\n\t};\r\n\toverride receiveLine(args: Args) {\r\n\t\tconst [cmd] = args;\r\n\t\tswitch (cmd) {\r\n\t\tcase 'challstr': {\r\n\t\t\tconst [, challstr] = args;\r\n\t\t\tPS.user.challstr = challstr;\r\n\t\t\tPSLoginServer.query(\r\n\t\t\t\t'upkeep', { challstr }\r\n\t\t\t).then(res => {\r\n\t\t\t\tif (!res?.username) {\r\n\t\t\t\t\tPS.user.initializing = false;\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\t// | , ; are not valid characters in names\r\n\t\t\t\tres.username = res.username.replace(/[|,;]+/g, '');\r\n\t\t\t\tif (res.loggedin) {\r\n\t\t\t\t\tPS.user.registered = { name: res.username, userid: toID(res.username) };\r\n\t\t\t\t}\r\n\t\t\t\tPS.user.handleAssertion(res.username, res.assertion);\r\n\t\t\t});\r\n\t\t\treturn;\r\n\t\t} case 'updateuser': {\r\n\t\t\tconst [, fullName, namedCode, avatar] = args;\r\n\t\t\tconst named = namedCode === '1';\r\n\t\t\tif (named) PS.user.initializing = false;\r\n\t\t\tPS.user.setName(fullName, named, avatar);\r\n\t\t\tPS.teams.loadRemoteTeams();\r\n\t\t\treturn;\r\n\t\t} case 'updatechallenges': {\r\n\t\t\tconst [, challengesBuf] = args;\r\n\t\t\tthis.receiveChallenges(challengesBuf);\r\n\t\t\treturn;\r\n\t\t} case 'updatesearch': {\r\n\t\t\tconst [, searchBuf] = args;\r\n\t\t\tthis.receiveSearch(searchBuf);\r\n\t\t\treturn;\r\n\t\t} case 'queryresponse': {\r\n\t\t\tconst [, queryId, responseJSON] = args;\r\n\t\t\tthis.handleQueryResponse(queryId as ID, JSON.parse(responseJSON));\r\n\t\t\treturn;\r\n\t\t} case 'pm': {\r\n\t\t\tconst [, user1, user2, message] = args;\r\n\t\t\tthis.handlePM(user1, user2, message);\r\n\t\t\tlet sideRoom = PS.rightPanel as ChatRoom;\r\n\t\t\tif (sideRoom?.type === \"chat\" && PS.prefs.inchatpm) sideRoom?.log?.add(args);\r\n\t\t\treturn;\r\n\t\t} case 'formats': {\r\n\t\t\tthis.parseFormats(args);\r\n\t\t\treturn;\r\n\t\t} case 'popup': {\r\n\t\t\tconst [, message] = args;\r\n\t\t\tPS.alert(message.replace(/\\|\\|/g, '\\n'));\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t}\r\n\t\tconst lobby = PS.rooms['lobby'];\r\n\t\tif (lobby) lobby.receiveLine(args);\r\n\t}\r\n\treceiveChallenges(dataBuf: string) {\r\n\t\tlet json;\r\n\t\ttry {\r\n\t\t\tjson = JSON.parse(dataBuf);\r\n\t\t} catch {}\r\n\t\tfor (const userid in json.challengesFrom) {\r\n\t\t\tPS.getPMRoom(toID(userid));\r\n\t\t}\r\n\t\tif (json.challengeTo) {\r\n\t\t\tPS.getPMRoom(toID(json.challengeTo.to));\r\n\t\t}\r\n\t\tfor (const roomid in PS.rooms) {\r\n\t\t\tconst room = PS.rooms[roomid] as ChatRoom;\r\n\t\t\tif (!room.pmTarget) continue;\r\n\t\t\tconst targetUserid = toID(room.pmTarget);\r\n\t\t\tif (!room.challenged && !(targetUserid in json.challengesFrom) &&\r\n\t\t\t\t!room.challenging && json.challengeTo?.to !== targetUserid) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\troom.challenged = room.parseChallenge(json.challengesFrom[targetUserid]);\r\n\t\t\troom.challenging = json.challengeTo?.to === targetUserid ? room.parseChallenge(json.challengeTo.format) : null;\r\n\t\t\troom.update(null);\r\n\t\t}\r\n\t}\r\n\treceiveSearch(dataBuf: string) {\r\n\t\tlet json;\r\n\t\tthis.searchSent = false;\r\n\t\ttry {\r\n\t\t\tjson = JSON.parse(dataBuf);\r\n\t\t} catch {}\r\n\t\tthis.search = json;\r\n\t\tthis.update(null);\r\n\t}\r\n\tparseFormats(formatsList: string[]) {\r\n\t\tlet isSection = false;\r\n\t\tlet section = '';\r\n\r\n\t\tlet column = 0;\r\n\r\n\t\twindow.NonBattleGames = { rps: 'Rock Paper Scissors' };\r\n\t\tfor (let i = 3; i <= 9; i += 2) {\r\n\t\t\twindow.NonBattleGames[`bestof${i}`] = `Best-of-${i}`;\r\n\t\t}\r\n\t\twindow.BattleFormats = {};\r\n\t\tfor (let j = 1; j < formatsList.length; j++) {\r\n\t\t\tconst entry = formatsList[j];\r\n\t\t\tif (isSection) {\r\n\t\t\t\tsection = entry;\r\n\t\t\t\tisSection = false;\r\n\t\t\t} else if (entry === ',LL') {\r\n\t\t\t\tPS.teams.usesLocalLadder = true;\r\n\t\t\t} else if (entry === '' || (entry.startsWith(',') && !isNaN(Number(entry.slice(1))))) {\r\n\t\t\t\tisSection = true;\r\n\r\n\t\t\t\tif (entry) {\r\n\t\t\t\t\tcolumn = parseInt(entry.slice(1), 10) || 0;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tlet name = entry;\r\n\t\t\t\tlet searchShow = true;\r\n\t\t\t\tlet challengeShow = true;\r\n\t\t\t\tlet tournamentShow = true;\r\n\t\t\t\tlet team: 'preset' | null = null;\r\n\t\t\t\tlet teambuilderLevel: number | null = null;\r\n\t\t\t\tlet lastCommaIndex = name.lastIndexOf(',');\r\n\t\t\t\tlet code = lastCommaIndex >= 0 ? parseInt(name.substr(lastCommaIndex + 1), 16) : NaN;\r\n\t\t\t\tif (!isNaN(code)) {\r\n\t\t\t\t\tname = name.substr(0, lastCommaIndex);\r\n\t\t\t\t\tif (code & 1) team = 'preset';\r\n\t\t\t\t\tif (!(code & 2)) searchShow = false;\r\n\t\t\t\t\tif (!(code & 4)) challengeShow = false;\r\n\t\t\t\t\tif (!(code & 8)) tournamentShow = false;\r\n\t\t\t\t\tif (code & 16) teambuilderLevel = 50;\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// Backwards compatibility: late 0.9.0 -> 0.10.0\r\n\t\t\t\t\tif (name.substr(name.length - 2) === ',#') { // preset teams\r\n\t\t\t\t\t\tteam = 'preset';\r\n\t\t\t\t\t\tname = name.substr(0, name.length - 2);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (name.substr(name.length - 2) === ',,') { // search-only\r\n\t\t\t\t\t\tchallengeShow = false;\r\n\t\t\t\t\t\tname = name.substr(0, name.length - 2);\r\n\t\t\t\t\t} else if (name.substr(name.length - 1) === ',') { // challenge-only\r\n\t\t\t\t\t\tsearchShow = false;\r\n\t\t\t\t\t\tname = name.substr(0, name.length - 1);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tlet id = toID(name);\r\n\t\t\t\tlet isTeambuilderFormat = !team && !name.endsWith('Custom Game');\r\n\t\t\t\tlet teambuilderFormat = '' as ID;\r\n\t\t\t\tlet teambuilderFormatName = '';\r\n\t\t\t\tif (isTeambuilderFormat) {\r\n\t\t\t\t\tteambuilderFormatName = name;\r\n\t\t\t\t\tif (!id.startsWith('gen')) {\r\n\t\t\t\t\t\tteambuilderFormatName = '[Gen 6] ' + name;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tlet parenPos = teambuilderFormatName.indexOf('(');\r\n\t\t\t\t\tif (parenPos > 0 && name.endsWith(')')) {\r\n\t\t\t\t\t\t// variation of existing tier\r\n\t\t\t\t\t\tteambuilderFormatName = teambuilderFormatName.slice(0, parenPos).trim();\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (teambuilderFormatName !== name) {\r\n\t\t\t\t\t\tteambuilderFormat = toID(teambuilderFormatName);\r\n\t\t\t\t\t\tif (BattleFormats[teambuilderFormat]) {\r\n\t\t\t\t\t\t\tBattleFormats[teambuilderFormat].isTeambuilderFormat = true;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tBattleFormats[teambuilderFormat] = {\r\n\t\t\t\t\t\t\t\tid: teambuilderFormat,\r\n\t\t\t\t\t\t\t\tname: teambuilderFormatName,\r\n\t\t\t\t\t\t\t\tteam,\r\n\t\t\t\t\t\t\t\tsection,\r\n\t\t\t\t\t\t\t\tcolumn,\r\n\t\t\t\t\t\t\t\trated: false,\r\n\t\t\t\t\t\t\t\tisTeambuilderFormat: true,\r\n\t\t\t\t\t\t\t\teffectType: 'Format',\r\n\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tisTeambuilderFormat = false;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (BattleFormats[id]?.isTeambuilderFormat) {\r\n\t\t\t\t\tisTeambuilderFormat = true;\r\n\t\t\t\t}\r\n\t\t\t\t// make sure formats aren't out-of-order\r\n\t\t\t\tif (BattleFormats[id]) delete BattleFormats[id];\r\n\t\t\t\tBattleFormats[id] = {\r\n\t\t\t\t\tid,\r\n\t\t\t\t\tname,\r\n\t\t\t\t\tteam,\r\n\t\t\t\t\tsection,\r\n\t\t\t\t\tcolumn,\r\n\t\t\t\t\tsearchShow,\r\n\t\t\t\t\tchallengeShow,\r\n\t\t\t\t\ttournamentShow,\r\n\t\t\t\t\trated: searchShow && id.substr(4, 7) !== 'unrated',\r\n\t\t\t\t\tteambuilderLevel,\r\n\t\t\t\t\tteambuilderFormat,\r\n\t\t\t\t\tisTeambuilderFormat,\r\n\t\t\t\t\teffectType: 'Format',\r\n\t\t\t\t};\r\n\r\n\t\t\t\t// Ensure mod is loaded for format.\r\n\t\t\t\tif (window.FormatModMapping && window.FormatModMapping[id]) {\r\n\t\t\t\t\tconst modid = window.FormatModMapping[id];\r\n\t\t\t\t\tif (!window.BattleTeambuilderTable[modid]) {\r\n\t\t\t\t\t\tDex.loadModData(modid);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\r\n\r\n\t\t// Match base formats to their variants, if they are unavailable in the server.\r\n\t\tlet multivariantFormats: { [id: string]: 1 } = {};\r\n\t\tfor (let id in BattleFormats) {\r\n\t\t\tlet teambuilderFormat = BattleFormats[BattleFormats[id].teambuilderFormat!];\r\n\t\t\tif (!teambuilderFormat || multivariantFormats[teambuilderFormat.id]) continue;\r\n\t\t\tif (!teambuilderFormat.searchShow && !teambuilderFormat.challengeShow && !teambuilderFormat.tournamentShow) {\r\n\t\t\t\t// The base format is not available.\r\n\t\t\t\tif (teambuilderFormat.battleFormat) {\r\n\t\t\t\t\tmultivariantFormats[teambuilderFormat.id] = 1;\r\n\t\t\t\t\tteambuilderFormat.battleFormat = '';\r\n\t\t\t\t} else {\r\n\t\t\t\t\tteambuilderFormat.battleFormat = id;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tPS.teams.update('format');\r\n\t}\r\n\thandlePM(user1: string, user2: string, message?: string) {\r\n\t\tconst userid1 = toID(user1);\r\n\t\tconst userid2 = toID(user2);\r\n\t\tconst pmTarget = PS.user.userid === userid1 ? user2 : user1;\r\n\t\tconst pmTargetid = PS.user.userid === userid1 ? userid2 : userid1;\r\n\t\tlet roomid = `dm-${pmTargetid}` as RoomID;\r\n\t\tif (pmTargetid === PS.user.userid) roomid = 'dm-' as RoomID;\r\n\t\tlet room = PS.rooms[roomid] as ChatRoom | undefined;\r\n\t\tif (!room) {\r\n\t\t\tPS.addRoom({\r\n\t\t\t\tid: roomid,\r\n\t\t\t\targs: { pmTarget },\r\n\t\t\t}, true);\r\n\t\t\troom = PS.rooms[roomid] as ChatRoom;\r\n\t\t} else {\r\n\t\t\troom.updateTarget(pmTarget);\r\n\t\t}\r\n\t\tif (message) room.receiveLine([`c`, user1, message]);\r\n\t\tPS.update();\r\n\t}\r\n\thandleQueryResponse(id: ID, response: any) {\r\n\t\tswitch (id) {\r\n\t\tcase 'userdetails':\r\n\t\t\tlet userid = response.userid;\r\n\t\t\tlet userdetails = this.userdetailsCache[userid];\r\n\t\t\tif (!userdetails) {\r\n\t\t\t\tthis.userdetailsCache[userid] = response;\r\n\t\t\t} else {\r\n\t\t\t\tObject.assign(userdetails, response);\r\n\t\t\t}\r\n\t\t\tPS.rooms[`user-${userid}`]?.update(null);\r\n\t\t\tPS.rooms[`viewuser-${userid}`]?.update(null);\r\n\t\t\tPS.rooms[`users`]?.update(null);\r\n\t\t\tbreak;\r\n\t\tcase 'rooms':\r\n\t\t\tif (response.pspl) {\r\n\t\t\t\tfor (const roomInfo of response.pspl) roomInfo.spotlight = \"Spotlight\";\r\n\t\t\t\tresponse.chat = [...response.pspl, ...response.chat];\r\n\t\t\t\tresponse.pspl = null;\r\n\t\t\t}\r\n\t\t\tif (response.official) {\r\n\t\t\t\tfor (const roomInfo of response.official) roomInfo.section = \"Official\";\r\n\t\t\t\tresponse.chat = [...response.official, ...response.chat];\r\n\t\t\t\tresponse.official = null;\r\n\t\t\t}\r\n\t\t\tthis.roomsCache = response;\r\n\t\t\tconst roomsRoom = PS.rooms[`rooms`] as RoomsRoom;\r\n\t\t\tif (roomsRoom) roomsRoom.update(null);\r\n\t\t\tbreak;\r\n\t\tcase 'roomlist':\r\n\t\t\tconst battlesRoom = PS.rooms[`battles`] as BattlesRoom;\r\n\t\t\tif (battlesRoom) {\r\n\t\t\t\tconst battleTable = response.rooms;\r\n\t\t\t\tconst battles = [];\r\n\t\t\t\tfor (const battleid in battleTable) {\r\n\t\t\t\t\tbattleTable[battleid].id = battleid;\r\n\t\t\t\t\tbattles.push(battleTable[battleid]);\r\n\t\t\t\t}\r\n\t\t\t\tbattlesRoom.battles = battles;\r\n\t\t\t\tbattlesRoom.update(null);\r\n\t\t\t}\r\n\t\t\tbreak;\r\n\t\tcase 'laddertop':\r\n\t\t\tfor (const [roomid, ladderRoom] of Object.entries(PS.rooms)) {\r\n\t\t\t\tif (roomid.startsWith('ladder-')) {\r\n\t\t\t\t\t(ladderRoom as LadderFormatRoom).update(response);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tbreak;\r\n\t\tcase 'teamupload':\r\n\t\t\tif (PS.teams.uploading) {\r\n\t\t\t\tconst team = PS.teams.uploading;\r\n\t\t\t\tteam.uploaded = {\r\n\t\t\t\t\tteamid: response.teamid,\r\n\t\t\t\t\tnotLoaded: false,\r\n\t\t\t\t\tprivate: response.private,\r\n\t\t\t\t};\r\n\t\t\t\tPS.rooms[`team-${team.key}`]?.update(null);\r\n\t\t\t\tPS.rooms.teambuilder?.update(null);\r\n\t\t\t\tPS.teams.uploading = null;\r\n\t\t\t}\r\n\t\t\tbreak;\r\n\t\tcase 'teamupdate':\r\n\t\t\tfor (const team of PS.teams.list) {\r\n\t\t\t\tif (team.teamid === response.teamid) {\r\n\t\t\t\t\tteam.uploaded = {\r\n\t\t\t\t\t\tteamid: response.teamid,\r\n\t\t\t\t\t\tnotLoaded: false,\r\n\t\t\t\t\t\tprivate: response.private,\r\n\t\t\t\t\t};\r\n\t\t\t\t\tPS.rooms[`team-${team.key}`]?.update(null);\r\n\t\t\t\t\tPS.rooms.teambuilder?.update(null);\r\n\t\t\t\t\tPS.teams.uploading = null;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n}\r\n\r\nclass NewsPanel extends PSRoomPanel {\r\n\tstatic readonly id = 'news';\r\n\tstatic readonly routes = ['news'];\r\n\tstatic readonly title = 'News';\r\n\tstatic readonly location = 'mini-window';\r\n\tchange = (ev: Event) => {\r\n\t\tconst target = ev.currentTarget as HTMLInputElement;\r\n\t\tif (target.value === '1') {\r\n\t\t\tdocument.cookie = \"preactalpha=1; expires=Thu, 1 Aug 2025 12:00:00 UTC; path=/\";\r\n\t\t} else {\r\n\t\t\tdocument.cookie = \"preactalpha=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;\";\r\n\t\t}\r\n\t\tif (target.value === 'leave') {\r\n\t\t\tdocument.location.href = `/`;\r\n\t\t}\r\n\t};\r\n\toverride render() {\r\n\t\tconst cookieSet = document.cookie.includes('preactalpha=1');\r\n\t\treturn <PSPanelWrapper room={this.props.room} fullSize scrollable>\r\n\t\t\t<div class=\"construction\">\r\n\t\t\t\tThis is the client rewrite beta test.\r\n\t\t\t\t<form>\r\n\t\t\t\t\t<label class=\"checkbox\">\r\n\t\t\t\t\t\t<input type=\"radio\" name=\"preactalpha\" value=\"1\" onChange={this.change} checked={cookieSet} /> {}\r\n\t\t\t\t\t\tUse Rewrite always\r\n\t\t\t\t\t</label>\r\n\t\t\t\t\t<label class=\"checkbox\">\r\n\t\t\t\t\t\t<input type=\"radio\" name=\"preactalpha\" value=\"0\" onChange={this.change} checked={!cookieSet} /> {}\r\n\t\t\t\t\t\tUse Rewrite with URL\r\n\t\t\t\t\t</label>\r\n\t\t\t\t\t<label class=\"checkbox\">\r\n\t\t\t\t\t\t<input type=\"radio\" name=\"preactalpha\" value=\"leave\" onChange={this.change} /> {}\r\n\t\t\t\t\t\tBack to the old client\r\n\t\t\t\t\t</label>\r\n\t\t\t\t</form>\r\n\t\t\t\tProvide feedback in <a href=\"development\" style=\"color:black\">the Dev chatroom</a>.\r\n\t\t\t</div>\r\n\t\t\t<div class=\"readable-bg\" dangerouslySetInnerHTML={{ __html: PS.newsHTML }}></div>\r\n\t\t</PSPanelWrapper>;\r\n\t}\r\n}\r\n\r\nclass MainMenuPanel extends PSRoomPanel<MainMenuRoom> {\r\n\tstatic readonly id = 'mainmenu';\r\n\tstatic readonly routes = [''];\r\n\tstatic readonly Model = MainMenuRoom;\r\n\tstatic readonly icon = <i class=\"fa fa-home\" aria-hidden></i>;\r\n\toverride focus() {\r\n\t\tthis.base?.querySelector<HTMLButtonElement>('.formatselect')?.focus();\r\n\t}\r\n\tsubmitSearch = (ev: Event, format: string, team?: Team) => {\r\n\t\tif (!PS.user.named) {\r\n\t\t\tPS.join('login' as RoomID, {\r\n\t\t\t\tparentElem: this.base!.querySelector<HTMLElement>('.big.button'),\r\n\t\t\t});\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tPS.mainmenu.startSearch(format, team);\r\n\t};\r\n\thandleDragStart = (e: DragEvent) => {\r\n\t\tconst room = PS.getRoom(e.currentTarget);\r\n\t\tif (!room) return;\r\n\t\tconst foreground = (PS.leftPanel.id === room.id || PS.rightPanel?.id === room.id);\r\n\t\tPS.dragging = { type: 'room', roomid: room.id, foreground };\r\n\t};\r\n\thandleDragEnter = (e: DragEvent) => {\r\n\t\t// console.log('dragenter ' + e.dataTransfer!.dropEffect);\r\n\t\te.preventDefault();\r\n\t\tif (PS.dragging?.type !== 'room') return;\r\n\t\tconst draggingRoom = PS.dragging.roomid;\r\n\t\tif (draggingRoom === null) return;\r\n\r\n\t\tconst draggedOverRoom = PS.getRoom(e.target as HTMLElement);\r\n\t\tif (draggingRoom === draggedOverRoom?.id) return;\r\n\r\n\t\tconst index = PS.miniRoomList.indexOf(draggedOverRoom?.id as any);\r\n\t\tif (index >= 0) {\r\n\t\t\tPS.dragOnto(PS.rooms[draggingRoom]!, 'mini-window', index);\r\n\t\t} else if (PS.rooms[draggingRoom]?.location !== 'mini-window') {\r\n\t\t\tPS.dragOnto(PS.rooms[draggingRoom]!, 'mini-window', 0);\r\n\t\t}\r\n\r\n\t\t// dropEffect !== 'none' prevents bounce-back animation in\r\n\t\t// Chrome/Safari/Opera\r\n\t\t// if (e.dataTransfer) e.dataTransfer.dropEffect = 'move';\r\n\t};\r\n\trenderMiniRoom(room: PSRoom) {\r\n\t\tconst RoomType = PS.roomTypes[room.type];\r\n\t\tconst Panel = RoomType || PSRoomPanel;\r\n\t\treturn <Panel key={room.id} room={room} />;\r\n\t}\r\n\thandleClickMinimize = (e: MouseEvent) => {\r\n\t\tif ((e.target as Element)?.getAttribute('data-cmd')) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (((e.target as Element)?.parentNode as Element)?.getAttribute('data-cmd')) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tconst room = PS.getRoom(e.currentTarget);\r\n\t\tif (room) {\r\n\t\t\troom.minimized = !room.minimized;\r\n\t\t\tthis.forceUpdate();\r\n\t\t}\r\n\t};\r\n\trenderMiniRooms() {\r\n\t\treturn PS.miniRoomList.map(roomid => {\r\n\t\t\tconst room = PS.rooms[roomid]!;\r\n\t\t\tconst notifying = room.notifications.length ? ' notifying' : room.isSubtleNotifying ? ' subtle-notifying' : '';\r\n\t\t\treturn <div\r\n\t\t\t\tclass={`mini-window${room.minimized ? ' collapsed' : ''}${room === PS.room ? ' focused' : ''}`}\r\n\t\t\t\tkey={roomid} data-roomid={roomid}\r\n\t\t\t>\r\n\t\t\t\t<h3\r\n\t\t\t\t\tclass={`mini-window-header${notifying}`} draggable onDragStart={this.handleDragStart} onClick={this.handleClickMinimize}\r\n\t\t\t\t>\r\n\t\t\t\t\t<button class=\"closebutton\" data-cmd=\"/close\" aria-label=\"Close\" tabIndex={-1}>\r\n\t\t\t\t\t\t<i class=\"fa fa-times-circle\" aria-hidden></i>\r\n\t\t\t\t\t</button>\r\n\t\t\t\t\t<button class=\"maximizebutton\" data-cmd=\"/maximize\" tabIndex={-1} aria-label=\"Maximize\">\r\n\t\t\t\t\t\t<i class=\"fa fa-stop-circle\" aria-hidden></i>\r\n\t\t\t\t\t</button>\r\n\t\t\t\t\t<button class=\"minimizebutton\" tabIndex={-1} aria-label=\"Expand/Collapse\">\r\n\t\t\t\t\t\t<i class=\"fa fa-minus-circle\" aria-hidden></i>\r\n\t\t\t\t\t</button>\r\n\t\t\t\t\t{room.title}\r\n\t\t\t\t</h3>\r\n\t\t\t\t{this.renderMiniRoom(room)}\r\n\t\t\t</div>;\r\n\t\t});\r\n\t}\r\n\trenderGames() {\r\n\t\tif (!PS.mainmenu.search.games) return null;\r\n\r\n\t\t// This does not use the word \"game\" because it includes things like help tickets\r\n\t\treturn <div class=\"menugroup\">\r\n\t\t\t<p class=\"label\">You are in:</p>\r\n\t\t\t{Object.entries(PS.mainmenu.search.games).map(([roomid, gameName]) => <div>\r\n\t\t\t\t<a class=\"blocklink\" href={`${roomid}`}>{gameName}</a>\r\n\t\t\t</div>)}\r\n\t\t</div>;\r\n\t}\r\n\trenderSearchButton() {\r\n\t\tif (PS.down) {\r\n\t\t\treturn <div class=\"menugroup\" style=\"background: rgba(10,10,10,.6)\">\r\n\t\t\t\t{PS.down === 'ddos' ? (\r\n\t\t\t\t\t<p class=\"error\"><strong>Pok&eacute;mon Showdown is offline due to a DDoS attack!</strong></p>\r\n\t\t\t\t) : (\r\n\t\t\t\t\t<p class=\"error\"><strong>Pok&eacute;mon Showdown is offline due to technical difficulties!</strong></p>\r\n\t\t\t\t)}\r\n\t\t\t\t<p>\r\n\t\t\t\t\t<div style={{ textAlign: 'center' }}>\r\n\t\t\t\t\t\t<img width=\"96\" height=\"96\" src={`//${Config.routes.client}/sprites/gen5/teddiursa.png`} alt=\"\" />\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\tBear with us as we freak out.\r\n\t\t\t\t</p>\r\n\t\t\t\t<p>(We'll be back up in a few hours.)</p>\r\n\t\t\t</div>;\r\n\t\t}\r\n\r\n\t\tif (!PS.user.userid || PS.isOffline) {\r\n\t\t\treturn <TeamForm class=\"menugroup\" onSubmit={this.submitSearch} selectType=\"search\">\r\n\t\t\t\t<button class=\"mainmenu1 mainmenu big button disabled\" disabled name=\"search\">\r\n\t\t\t\t\t<em>{PS.isOffline ? [<span class=\"fa-stack fa-lg\">\r\n\t\t\t\t\t\t<i class=\"fa fa-plug fa-flip-horizontal fa-stack-1x\" aria-hidden></i>\r\n\t\t\t\t\t\t<i class=\"fa fa-ban fa-stack-2x text-danger\" aria-hidden></i>\r\n\t\t\t\t\t</span>, \" Disconnected\"] : \"Connecting...\"}</em>\r\n\t\t\t\t</button>\r\n\t\t\t\t{PS.isOffline && <p class=\"buttonbar\">\r\n\t\t\t\t\t<button class=\"button\" data-cmd=\"/reconnect\">\r\n\t\t\t\t\t\t<i class=\"fa fa-plug\" aria-hidden></i> <strong>Reconnect</strong>\r\n\t\t\t\t\t</button> {}\r\n\t\t\t\t\t{PS.connection?.reconnectTimer && <small>(Autoreconnect in {Math.round(PS.connection.reconnectDelay / 1000)}s)</small>}\r\n\t\t\t\t</p>}\r\n\t\t\t</TeamForm>;\r\n\t\t}\r\n\r\n\t\treturn <TeamForm\r\n\t\t\tclass=\"menugroup\" format={PS.mainmenu.searchCountdown?.format} selectType=\"search\" onSubmit={this.submitSearch}\r\n\t\t>\r\n\t\t\t<p>\r\n\t\t\t\t<button class=\"button small\" data-href=\"battleoptions\" title=\"Options\" aria-label=\"Options\">\r\n\t\t\t\t\tBattle options <i class=\"fa fa-caret-down\"></i>\r\n\t\t\t\t</button></p>\r\n\t\t\t{PS.mainmenu.searchCountdown ? (\r\n\t\t\t\t<>\r\n\t\t\t\t\t<button class=\"mainmenu1 mainmenu big button disabled\" type=\"submit\"><strong>\r\n\t\t\t\t\t\t<i class=\"fa fa-refresh fa-spin\" aria-hidden></i> Searching in {PS.mainmenu.searchCountdown.countdown}...\r\n\t\t\t\t\t</strong></button>\r\n\t\t\t\t\t<p class=\"buttonbar\"><button class=\"button\" data-cmd=\"/cancelsearch\">Cancel</button></p>\r\n\t\t\t\t</>\r\n\t\t\t) : (PS.mainmenu.searchSent || PS.mainmenu.search.searching.length) ? (\r\n\t\t\t\t<>\r\n\t\t\t\t\t<button class=\"mainmenu1 mainmenu big button disabled\" type=\"submit\">\r\n\t\t\t\t\t\t<strong><i class=\"fa fa-refresh fa-spin\" aria-hidden></i> Searching...</strong>\r\n\t\t\t\t\t</button>\r\n\t\t\t\t\t<p class=\"buttonbar\"><button class=\"button\" data-cmd=\"/cancelsearch\">Cancel</button></p>\r\n\t\t\t\t</>\r\n\t\t\t) : (\r\n\t\t\t\t<button class=\"mainmenu1 mainmenu big button\" type=\"submit\">\r\n\t\t\t\t\t<strong>Battle!</strong><br />\r\n\t\t\t\t\t<small>Find a random opponent</small>\r\n\t\t\t\t</button>\r\n\t\t\t)}\r\n\t\t</TeamForm>;\r\n\t}\r\n\toverride render() {\r\n\t\tconst onlineButton = ' button' + (PS.isOffline ? ' disabled' : '');\r\n\t\tconst tinyLayout = this.props.room.width < 620 ? ' tiny-layout' : '';\r\n\t\treturn <PSPanelWrapper room={this.props.room} scrollable onDragEnter={this.handleDragEnter}>\r\n\t\t\t<div class={`mainmenu-mini-windows${tinyLayout}`}>\r\n\t\t\t\t{this.renderMiniRooms()}\r\n\t\t\t</div>\r\n\t\t\t<div class={`mainmenu${tinyLayout}`}>\r\n\t\t\t\t<div class=\"mainmenu-left\">\r\n\t\t\t\t\t{this.renderGames()}\r\n\r\n\t\t\t\t\t{this.renderSearchButton()}\r\n\r\n\t\t\t\t\t<div class=\"menugroup\">\r\n\t\t\t\t\t\t<p><a class=\"mainmenu2 mainmenu button\" href=\"teambuilder\">Teambuilder</a></p>\r\n\t\t\t\t\t\t<p><a class={\"mainmenu3 mainmenu\" + onlineButton} href=\"ladder\">Ladder</a></p>\r\n\t\t\t\t\t\t<p><a class={\"mainmenu4 mainmenu\" + onlineButton} href=\"view-tournaments-all\">Tournaments</a></p>\r\n\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t<div class=\"menugroup\">\r\n\t\t\t\t\t\t<p><a class={\"mainmenu4 mainmenu\" + onlineButton} href=\"battles\">Watch a battle</a></p>\r\n\t\t\t\t\t\t<p><a class={\"mainmenu5 mainmenu\" + onlineButton} href=\"users\">Find a user</a></p>\r\n\t\t\t\t\t\t<p><a class={\"mainmenu6 mainmenu\" + onlineButton} href=\"view-friends-all\">Friends</a></p>\r\n\t\t\t\t\t\t<p><a class={\"mainmenu7 mainmenu\" + onlineButton} href=\"resources\">Info & Resources</a></p>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div class=\"mainmenu-right\" style={{ display: PS.leftPanelWidth ? 'none' : 'block' }}>\r\n\t\t\t\t\t<div class=\"menugroup\">\r\n\t\t\t\t\t\t<p><a class={\"mainmenu1 mainmenu\" + onlineButton} href=\"rooms\">Chat rooms</a></p>\r\n\t\t\t\t\t\t{PS.server.id !== 'showdown' && (\r\n\t\t\t\t\t\t\t<p><a class={\"mainmenu2 mainmenu\" + onlineButton} href=\"lobby\">Lobby chat</a></p>\r\n\t\t\t\t\t\t)}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div class=\"mainmenu-footer\">\r\n\t\t\t\t\t<div class=\"bgcredit\"></div>\r\n\t\t\t\t\t<small>\r\n\t\t\t\t\t\t<a href={`//${Config.routes.dex}/`} target=\"_blank\">Pok&eacute;dex</a> | {}\r\n\t\t\t\t\t\t<a href={`//${Config.routes.replays}/`} target=\"_blank\">Replays</a> | {}\r\n\t\t\t\t\t\t<a href={`//${Config.routes.root}/rules`} target=\"_blank\">Rules</a> | {}\r\n\t\t\t\t\t\t<a href={`//${Config.routes.root}/credits`} target=\"_blank\">Credits</a> | {}\r\n\t\t\t\t\t\t<a href=\"//smogon.com/forums/\" target=\"_blank\">Forum</a>\r\n\t\t\t\t\t</small>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</PSPanelWrapper>;\r\n\t}\r\n}\r\n\r\nexport class FormatDropdown extends preact.Component<{\r\n\tselectType?: SelectType, format?: string, defaultFormat?: string, placeholder?: string,\r\n\tonChange?: JSX.EventHandler<Event>,\r\n}> {\r\n\tdeclare base?: HTMLButtonElement;\r\n\tformat = '';\r\n\tchange = (e: Event) => {\r\n\t\tif (!this.base) return;\r\n\t\tthis.format = this.base.value;\r\n\t\tthis.forceUpdate();\r\n\t\tif (this.props.onChange) this.props.onChange(e);\r\n\t};\r\n\toverride componentWillMount() {\r\n\t\tif (this.props.format !== undefined) {\r\n\t\t\tthis.format = this.props.format;\r\n\t\t}\r\n\t}\r\n\trender() {\r\n\t\tthis.format ||= this.props.format || this.props.defaultFormat || '';\r\n\t\tlet [formatName, customRules] = this.format.split('@@@');\r\n\t\tif (window.BattleLog) formatName = BattleLog.formatName(formatName);\r\n\t\tif (this.props.format || PS.mainmenu.searchSent) {\r\n\t\t\treturn <button\r\n\t\t\t\tname=\"format\" value={this.format} class=\"select formatselect preselected\" disabled\r\n\t\t\t>\r\n\t\t\t\t{formatName}\r\n\t\t\t\t{!!customRules && [<br />, <small>Custom rules: {customRules}</small>]}\r\n\t\t\t</button>;\r\n\t\t}\r\n\t\treturn <button\r\n\t\t\tname=\"format\" value={this.format} data-selecttype={this.props.selectType}\r\n\t\t\tclass=\"select formatselect\" data-href=\"/formatdropdown\" onChange={this.change}\r\n\t\t>\r\n\t\t\t{formatName || (!!this.props.placeholder && <em>{this.props.placeholder}</em>) || null}\r\n\t\t\t{!!customRules && [<br />, <small>Custom rules: {customRules}</small>]}\r\n\t\t</button>;\r\n\t}\r\n}\r\n\r\nclass TeamDropdown extends preact.Component<{ format: string }> {\r\n\tteamFormat = '';\r\n\tteamKey = '';\r\n\tchange = () => {\r\n\t\tif (!this.base) return;\r\n\t\tthis.teamKey = (this.base as HTMLButtonElement).value;\r\n\t\tthis.forceUpdate();\r\n\t};\r\n\tgetDefaultTeam(teambuilderFormat: string) {\r\n\t\tfor (const team of PS.teams.list) {\r\n\t\t\tif (team.format === teambuilderFormat) return team.key;\r\n\t\t}\r\n\t\treturn '';\r\n\t}\r\n\trender() {\r\n\t\tconst teamFormat = PS.teams.teambuilderFormat(this.props.format);\r\n\t\tconst formatData = window.BattleFormats?.[teamFormat];\r\n\t\tif (formatData?.team) {\r\n\t\t\treturn <button class=\"select teamselect preselected\" name=\"team\" value=\"random\" disabled>\r\n\t\t\t\t<div class=\"team\">\r\n\t\t\t\t\t<strong>Random team</strong>\r\n\t\t\t\t\t<small>\r\n\t\t\t\t\t\t<PSIcon pokemon={null} />\r\n\t\t\t\t\t\t<PSIcon pokemon={null} />\r\n\t\t\t\t\t\t<PSIcon pokemon={null} />\r\n\t\t\t\t\t\t<PSIcon pokemon={null} />\r\n\t\t\t\t\t\t<PSIcon pokemon={null} />\r\n\t\t\t\t\t\t<PSIcon pokemon={null} />\r\n\t\t\t\t\t</small>\r\n\t\t\t\t</div>\r\n\t\t\t</button>;\r\n\t\t}\r\n\t\tif (teamFormat !== this.teamFormat) {\r\n\t\t\tthis.teamFormat = teamFormat;\r\n\t\t\tthis.teamKey = this.getDefaultTeam(teamFormat);\r\n\t\t}\r\n\t\tconst team = PS.teams.byKey[this.teamKey] || null;\r\n\t\treturn <button\r\n\t\t\tname=\"team\" value={this.teamKey}\r\n\t\t\tclass=\"select teamselect\" data-href=\"/teamdropdown\" data-format={teamFormat} onChange={this.change}\r\n\t\t>\r\n\t\t\t{PS.roomTypes['teamdropdown'] && <TeamBox team={team} noLink />}\r\n\t\t</button>;\r\n\t}\r\n}\r\n\r\nexport class TeamForm extends preact.Component<{\r\n\tchildren: preact.ComponentChildren,\r\n\tclass?: string, format?: string, teamFormat?: string, hideFormat?: boolean, selectType?: SelectType,\r\n\tonSubmit: ((e: Event, format: string, team?: Team) => void) | null,\r\n\tonValidate?: ((e: Event, format: string, team?: Team) => void) | null,\r\n}> {\r\n\tformat = '';\r\n\tchangeFormat = (ev: Event) => {\r\n\t\tthis.format = (ev.target as HTMLButtonElement).value;\r\n\t};\r\n\tsubmit = (ev: Event, validate?: 'validate') => {\r\n\t\tev.preventDefault();\r\n\t\tconst format = this.format;\r\n\t\tconst teamKey = this.base!.querySelector<HTMLButtonElement>('button[name=team]')!.value;\r\n\t\tconst team = teamKey ? PS.teams.byKey[teamKey] : undefined;\r\n\t\tPS.teams.loadTeam(team).then(() => {\r\n\t\t\t(validate === 'validate' ? this.props.onValidate : this.props.onSubmit)?.(ev, format, team);\r\n\t\t});\r\n\t};\r\n\thandleClick = (ev: Event) => {\r\n\t\tlet target = ev.target as HTMLButtonElement | null;\r\n\t\twhile (target && target !== this.base) {\r\n\t\t\tif (target.tagName === 'BUTTON' && target.name === 'validate') {\r\n\t\t\t\tthis.submit(ev, 'validate');\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\ttarget = target.parentNode as HTMLButtonElement | null;\r\n\t\t}\r\n\t};\r\n\trender() {\r\n\t\tif (window.BattleFormats) {\r\n\t\t\tconst starredPrefs = PS.prefs.starredformats || {};\r\n\t\t\t// .reverse() because the newest starred format should be the default one\r\n\t\t\tconst starred = Object.keys(starredPrefs).filter(id => starredPrefs[id] === true).reverse();\r\n\t\t\tif (!this.format) {\r\n\t\t\t\tthis.format = `gen${Dex.gen}randombattle`;\r\n\t\t\t\tfor (let id of starred) {\r\n\t\t\t\t\tlet format = window.BattleFormats[id];\r\n\t\t\t\t\tif (!format) continue;\r\n\t\t\t\t\tif (this.props.selectType === 'challenge' && format?.challengeShow === false) continue;\r\n\t\t\t\t\tif (this.props.selectType === 'search' && format?.searchShow === false) continue;\r\n\t\t\t\t\tif (this.props.selectType === 'teambuilder' && format?.team) continue;\r\n\t\t\t\t\tthis.format = id;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn <form class={this.props.class} onSubmit={this.submit} onClick={this.handleClick}>\r\n\t\t\t{!this.props.hideFormat && <p>\r\n\t\t\t\t<label class=\"label\">\r\n\t\t\t\t\tFormat:<br />\r\n\t\t\t\t\t<FormatDropdown\r\n\t\t\t\t\t\tselectType={this.props.selectType} format={this.props.format} defaultFormat={this.format}\r\n\t\t\t\t\t\tonChange={this.changeFormat}\r\n\t\t\t\t\t/>\r\n\t\t\t\t</label>\r\n\t\t\t</p>}\r\n\t\t\t<p>\r\n\t\t\t\t<label class=\"label\">\r\n\t\t\t\t\tTeam:<br />\r\n\t\t\t\t\t<TeamDropdown format={this.props.teamFormat || this.format} />\r\n\t\t\t\t</label>\r\n\t\t\t</p>\r\n\t\t\t<p>{this.props.children}</p>\r\n\t\t</form>;\r\n\t}\r\n}\r\n\r\nPS.addRoomType(NewsPanel, MainMenuPanel);\r\n"],"mappings":"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","ignoreList":[]}