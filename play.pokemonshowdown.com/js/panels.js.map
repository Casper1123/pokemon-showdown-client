{"version":3,"file":"panels.js","names":["VERTICAL_HEADER_WIDTH","NARROW_MODE_HEADER_WIDTH","PSRouter","roomid","panelState","currentRoomid","location","pathname","slice","test","subscribeHistory","endsWith","subscribeHash","_proto","prototype","extractRoomID","url","startsWith","document","origin","length","charAt","host","PS","server","id","replace","redirects","teamid","updatePanelState","room","noURL","rooms","popups","panel","mainmenu","leftPanelWidth","rightPanel","leftPanel","newTitle","title","changed","_this","hash","join","_this$updatePanelStat","subscribe","_this$updatePanelStat2","window","addEventListener","e","_PS$rooms$PS$popups","possibleRoomid","_this2","history","_this$updatePanelStat3","replaceState","_this2$updatePanelSta","pushState","state","_ref","split","leftRoomid","rightRoomid","addRoom","autofocus","router","PSRoomPanel","_preact$Component","_this3","_len","arguments","args","Array","_key","call","apply","concat","subscriptions","justUpdatedDimensions","_inheritsLoose","_proto2","subscribeTo","model","_this4","callback","undefined","forceUpdate","subscription","push","componentDidMount","_this5","props","onParentEvent","focus","receiveLine","componentDidUpdate","updateDimensions","justUpdated","newWidth","base","offsetWidth","newHeight","offsetHeight","width","height","currentlyHidden","parentElem","includes","focusNextUpdate","componentWillUnmount","_i2","_this$subscriptions2","unsubscribe","close","leave","componentDidCatch","err","caughtError","stack","message","setState","chooseParentValue","value","dropdownButton","changeEvent","Event","dispatchEvent","closePopup","_this$base","PSView","hasTapped","querySelector","select","render","preact","h","PSPanelWrapper","Component","size","fullSize","scrollable","onClick","focusClick","focusIfNoSelection","onDragEnter","children","isPopup","style","getPopupStyle","posStyle","overflow","tinyLayout","role","_preact$Component2","_this6","handleClickOverlay","ev","_ev$target","target","className","preventDefault","stopImmediatePropagation","isSafari","_document$querySelect","setAttribute","onbeforeunload","prefs","refreshprompt","elem","getAttribute","inputs","Net","formData","cmd","_i4","_Object$entries2","Object","entries","_ref2","name","getRoom","sendDirect","pointerType","clickedRoom","innerText","userid","toID","rightPopup","username","tagName","ctrlKey","metaKey","shiftKey","href","shortLinks","closeAllPopups","send","handleButtonClick","parentElement","autoDismissNotifications","closePopupsAbove","update","scrollToRoom","isTextInput","isNonEmptyTextInput","type","contentEditable","textContent","modifierKey","altKey","keyCode","arrowKeysUsed","focusUpRoom","focusDownRoom","focusRoom","hideRightRoom","focusLeftRoom","focusRightRoom","dragging","_ev$dataTransfer","_PS$dragging","console","log","dataTransfer","dropEffect","_type","updateAutojoin","_ev$dataTransfer2","files","_i6","_Object$values2","values","roomTypes","Panel","handleDrop","alert","colorSchemeQuery","matchMedia","media","cs","theme","body","matches","subscribeAndRun","key","dark","setTextboxFocused","focused","narrowMode","isChrome","textboxFocused","documentElement","classList","remove","add","focusPreview","verticalBuf","verticalFocusPreview","isMiniRoom","_PS$horizontalNav","horizontalNav","index","buf","leftRoom","rightRoom","_PS$verticalNav","verticalNav","upRoom","downRoom","altLabel","isMac","scrollToHeader","scrollX","isFirefox","scrollTo","setTimeout","_proto3","_PS$getRoom","_PS$rooms$roomid","table","closest","_log","_i8","_table$querySelectorA2","querySelectorAll","row","display","_i0","_table$querySelectorA4","updateScroll","dummyInput","createElement","position","appendChild","execCommand","removeChild","containingRoomid","curElem","isEmptyClick","selection","getSelection","_unused","BattleTooltips","hideTooltip","top","left","verticalHeaderWidth","minWidth","right","_room$parentElem","maxHeight","maxWidth","margin","source","getBoundingClientRect","visibility","isFixed","offsetLeft","offsetTop","scrollY","availableWidth","clientWidth","availableHeight","clientHeight","sourceWidth","sourceHeight","sourceTop","sourceLeft","bottom","Math","max","popupLeft","availableAlignedWidth","renderRoom","RoomType","isPlaceholder","renderPopup","_this7","isNormalRoom","PSHeader","PSMiniHeader","map","_PSView","isIOS","navigator","platform","userAgent","_navigator$platform","dragend","_window$getSelection","setFocus","PSIcon","Dex","getPokemonIcon","pokemon","getItemIcon","item","types","get","sanitizedType","src","resourcePrefix","alt","b","categoryID","category","sanitizedCategory","toUpperCase"],"sources":["../src/panels.tsx"],"sourcesContent":["/**\r\n * Panels\r\n *\r\n * Main view - sets up the frame, and the generic panels.\r\n *\r\n * Also sets up most global event listeners.\r\n *\r\n * @author Guangcong Luo <guangcongluo@gmail.com>\r\n * @license AGPLv3\r\n */\r\n\r\nimport preact from \"../js/lib/preact\";\r\nimport type { Pokemon, ServerPokemon } from \"./battle\";\r\nimport { Dex, toID } from \"./battle-dex\";\r\nimport type { Args } from \"./battle-text-parser\";\r\nimport { BattleTooltips } from \"./battle-tooltips\";\r\nimport { Net } from \"./client-connection\";\r\nimport type { PSModel, PSStreamModel, PSSubscription } from \"./client-core\";\r\nimport { PS, type PSRoom, type RoomID } from \"./client-main\";\r\nimport type { ChatRoom } from \"./panel-chat\";\r\nimport { PSHeader, PSMiniHeader } from \"./panel-topbar\";\r\n\r\nexport const VERTICAL_HEADER_WIDTH = 240;\r\nexport const NARROW_MODE_HEADER_WIDTH = 280;\r\n\r\nexport class PSRouter {\r\n\troomid = '' as RoomID;\r\n\tpanelState = '';\r\n\tconstructor() {\r\n\t\tconst currentRoomid = location.pathname.slice(1);\r\n\t\tif (/^[a-z0-9-]*$/.test(currentRoomid)) {\r\n\t\t\tthis.subscribeHistory();\r\n\t\t} else if (location.pathname.endsWith('.html')) {\r\n\t\t\tthis.subscribeHash();\r\n\t\t}\r\n\t}\r\n\textractRoomID(url: string | null) {\r\n\t\tif (!url) return null;\r\n\t\tif (url.startsWith(document.location.origin)) {\r\n\t\t\turl = url.slice(document.location.origin.length);\r\n\t\t} else {\r\n\t\t\tif (url.startsWith('http://')) {\r\n\t\t\t\turl = url.slice(7);\r\n\t\t\t} else if (url.startsWith('https://')) {\r\n\t\t\t\turl = url.slice(8);\r\n\t\t\t}\r\n\t\t\tif (url.startsWith('psim.us/t/')) {\r\n\t\t\t\turl = `viewteam-${url.slice(10)}`;\r\n\t\t\t}\r\n\t\t\tif (url.startsWith('teams.pokemonshowdown.com/view/') && /[0-9]/.test(url.charAt(31))) {\r\n\t\t\t\turl = `viewteam-${url.slice(31)}`;\r\n\t\t\t}\r\n\t\t\tif (url.startsWith('psim.us/r/')) {\r\n\t\t\t\turl = `battle-${url.slice(10)}`;\r\n\t\t\t}\r\n\t\t\tif (url.startsWith('replay.pokemonshowdown.com/') && /[a-z]/.test(url.charAt(27))) {\r\n\t\t\t\turl = `battle-${url.slice(27)}`;\r\n\t\t\t}\r\n\t\t\tif (url.startsWith(document.location.host)) {\r\n\t\t\t\turl = url.slice(document.location.host.length);\r\n\t\t\t} else if (PS.server.id === 'showdown' && url.startsWith('play.pokemonshowdown.com')) {\r\n\t\t\t\turl = url.slice(24);\r\n\t\t\t} else if (PS.server.id === 'showdown' && url.startsWith('psim.us')) {\r\n\t\t\t\turl = url.slice(7);\r\n\t\t\t} else if (url.startsWith('replay.pokemonshowdown.com')) {\r\n\t\t\t\turl = url.slice(26).replace('/', '/battle-');\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (url.startsWith('/')) url = url.slice(1);\r\n\t\tif (url === '.') url = '';\r\n\r\n\t\tif (!/^[a-z0-9-]*$/.test(url)) return null;\r\n\r\n\t\tconst redirects = /^(appeals?|rooms?suggestions?|suggestions?|adminrequests?|bugs?|bugreports?|rules?|faq|credits?|privacy|contact|dex|insecure)$/;\r\n\t\tif (redirects.test(url)) return null;\r\n\r\n\t\tif (url.startsWith('view-teams-view-')) {\r\n\t\t\tconst teamid = url.slice(16);\r\n\t\t\turl = `viewteam-${teamid}` as RoomID;\r\n\t\t}\r\n\t\treturn url as RoomID;\r\n\t}\r\n\t/** true: roomid changed, false: panelState changed, null: neither changed */\r\n\tupdatePanelState(): { roomid: RoomID, changed: boolean | null, newTitle: string } {\r\n\t\tlet room = PS.room;\r\n\t\t// some popups don't have URLs and don't generate history\r\n\t\t// there's definitely a better way to do this but I'm lazy\r\n\t\tif (room.noURL) room = PS.rooms[PS.popups[PS.popups.length - 2]] || PS.panel;\r\n\t\tif (room.noURL) room = PS.panel;\r\n\r\n\t\t// don't generate history when focusing things on things visible on the home screen\r\n\t\tif (room.id === 'news' && room.location === 'mini-window') room = PS.mainmenu;\r\n\t\tif (room.id === '' && PS.leftPanelWidth && PS.rightPanel) {\r\n\t\t\troom = PS.rightPanel;\r\n\t\t}\r\n\t\tif (room.id === 'rooms') room = PS.leftPanel;\r\n\r\n\t\tlet roomid = room.id;\r\n\t\tconst panelState = (PS.leftPanelWidth && room === PS.panel ?\r\n\t\t\tPS.leftPanel.id + '..' + PS.rightPanel!.id :\r\n\t\t\troom.id);\r\n\t\tconst newTitle = roomid === '' ? 'Showdown!' : `${room.title} - Showdown!`;\r\n\t\tlet changed: boolean | null = (roomid !== this.roomid);\r\n\r\n\t\tthis.roomid = roomid;\r\n\t\tif (this.panelState === panelState) changed = null;\r\n\t\tthis.panelState = panelState;\r\n\t\treturn { roomid, changed, newTitle };\r\n\t}\r\n\tsubscribeHash() {\r\n\t\tif (location.hash) {\r\n\t\t\tconst currentRoomid = location.hash.slice(1);\r\n\t\t\tif (/^[a-z0-9-]+$/.test(currentRoomid)) {\r\n\t\t\t\tPS.join(currentRoomid as RoomID);\r\n\t\t\t}\r\n\t\t}\r\n\t\t{\r\n\t\t\tconst { newTitle } = this.updatePanelState();\r\n\t\t\tdocument.title = newTitle;\r\n\t\t}\r\n\t\tPS.subscribe(() => {\r\n\t\t\tconst { roomid, changed, newTitle } = this.updatePanelState();\r\n\t\t\tif (changed) location.hash = roomid ? `#${roomid}` : '';\r\n\t\t\t// n.b. must be done after changing hash, so history entry has the old title\r\n\t\t\tdocument.title = newTitle;\r\n\t\t});\r\n\t\twindow.addEventListener('hashchange', e => {\r\n\t\t\t// really dumb hack, but it's not like back/forward has ever been very reliable\r\n\t\t\tif (PS.popups.length && PS.rooms[PS.popups[PS.popups.length - 1]]?.noURL) return;\r\n\t\t\tconst possibleRoomid = location.hash.slice(1);\r\n\t\t\tlet currentRoomid: RoomID | null = null;\r\n\t\t\tif (/^[a-z0-9-]*$/.test(possibleRoomid)) {\r\n\t\t\t\tcurrentRoomid = possibleRoomid as RoomID;\r\n\t\t\t}\r\n\t\t\tif (currentRoomid !== null) {\r\n\t\t\t\tif (currentRoomid === PS.room.id) return;\r\n\t\t\t\tthis.roomid = currentRoomid;\r\n\t\t\t\tPS.join(currentRoomid);\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\tsubscribeHistory() {\r\n\t\tconst currentRoomid = location.pathname.slice(1);\r\n\t\tif (/^[a-z0-9-]+$/.test(currentRoomid)) {\r\n\t\t\tif (currentRoomid !== 'preactalpha' && currentRoomid !== 'preactbeta' && currentRoomid !== 'beta') {\r\n\t\t\t\tPS.join(currentRoomid as RoomID);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (!window.history) return;\r\n\t\t{\r\n\t\t\tconst { roomid, newTitle } = this.updatePanelState();\r\n\t\t\thistory.replaceState(this.panelState, '', `/${roomid}`);\r\n\t\t\tdocument.title = newTitle;\r\n\t\t}\r\n\t\tPS.subscribe(() => {\r\n\t\t\tconst { roomid, changed, newTitle } = this.updatePanelState();\r\n\t\t\tif (changed) {\r\n\t\t\t\thistory.pushState(this.panelState, '', `/${roomid}`);\r\n\t\t\t} else if (changed !== null) {\r\n\t\t\t\thistory.replaceState(this.panelState, '', `/${roomid}`);\r\n\t\t\t}\r\n\t\t\t// n.b. must be done after changing hash, so history entry has the old title\r\n\t\t\tdocument.title = newTitle;\r\n\t\t});\r\n\t\twindow.addEventListener('popstate', e => {\r\n\t\t\tconst possibleRoomid = location.pathname.slice(1);\r\n\t\t\tlet roomid: RoomID | null = null;\r\n\t\t\tif (/^[a-z0-9-]*$/.test(possibleRoomid)) {\r\n\t\t\t\troomid = possibleRoomid as RoomID;\r\n\t\t\t}\r\n\t\t\tif (typeof e.state === 'string') {\r\n\t\t\t\tconst [leftRoomid, rightRoomid] = e.state.split('..') as RoomID[];\r\n\t\t\t\tif (rightRoomid) {\r\n\t\t\t\t\tPS.addRoom({ id: leftRoomid, location: 'left', autofocus: false });\r\n\t\t\t\t\tPS.addRoom({ id: rightRoomid, location: 'right', autofocus: false });\r\n\t\t\t\t\tPS.leftPanel = PS.rooms[leftRoomid] || PS.leftPanel;\r\n\t\t\t\t\tPS.rightPanel = PS.rooms[rightRoomid] || PS.rightPanel;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (roomid !== null) {\r\n\t\t\t\tthis.roomid = roomid;\r\n\t\t\t\tPS.join(roomid);\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n}\r\nPS.router = new PSRouter();\r\n\r\nexport class PSRoomPanel<T extends PSRoom = PSRoom> extends preact.Component<{ room: T }> {\r\n\tsubscriptions: PSSubscription[] = [];\r\n\tsubscribeTo<M>(\r\n\t\tmodel: PSModel<M> | PSStreamModel<M>, callback: (value: M) => void = () => { this.forceUpdate(); }\r\n\t): PSSubscription {\r\n\t\tconst subscription = model.subscribe(callback);\r\n\t\tthis.subscriptions.push(subscription);\r\n\t\treturn subscription;\r\n\t}\r\n\toverride componentDidMount() {\r\n\t\tthis.props.room.onParentEvent = (id: string, e?: Event) => {\r\n\t\t\tif (id === 'focus') this.focus();\r\n\t\t};\r\n\t\tthis.subscriptions.push(this.props.room.subscribe(args => {\r\n\t\t\tif (!args) this.forceUpdate();\r\n\t\t\telse this.receiveLine(args);\r\n\t\t}));\r\n\t\tthis.componentDidUpdate();\r\n\t}\r\n\tjustUpdatedDimensions = false;\r\n\tupdateDimensions() {\r\n\t\tconst justUpdated = this.justUpdatedDimensions;\r\n\t\tthis.justUpdatedDimensions = false;\r\n\r\n\t\tconst room = this.props.room;\r\n\t\tconst newWidth = this.base!.offsetWidth;\r\n\t\tconst newHeight = this.base!.offsetHeight;\r\n\t\tif (room.width === newWidth && room.height === newHeight) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\troom.width = newWidth;\r\n\t\troom.height = newHeight;\r\n\r\n\t\tif (justUpdated) return; // should never happen; safeguard against infinite loops\r\n\t\tthis.justUpdatedDimensions = true;\r\n\t\tthis.forceUpdate();\r\n\t}\r\n\toverride componentDidUpdate() {\r\n\t\tconst room = this.props.room;\r\n\t\tconst currentlyHidden = !room.width && room.parentElem && ['popup', 'semimodal-popup'].includes(room.location);\r\n\t\tthis.updateDimensions();\r\n\t\tif (currentlyHidden) return;\r\n\t\tif (room.focusNextUpdate) {\r\n\t\t\troom.focusNextUpdate = false;\r\n\t\t\tthis.focus();\r\n\t\t}\r\n\t}\r\n\toverride componentWillUnmount() {\r\n\t\tthis.props.room.onParentEvent = null;\r\n\t\tfor (const subscription of this.subscriptions) {\r\n\t\t\tsubscription.unsubscribe();\r\n\t\t}\r\n\t\tthis.subscriptions = [];\r\n\t}\r\n\tclose() {\r\n\t\tPS.leave(this.props.room.id);\r\n\t}\r\n\tcomponentDidCatch(err: Error) {\r\n\t\tthis.props.room.caughtError = err.stack || err.message;\r\n\t\tthis.setState({});\r\n\t}\r\n\treceiveLine(args: Args) {}\r\n\t/**\r\n\t * PS has \"fake select menus\", buttons that act like <select> dropdowns.\r\n\t * This function is used by the popups they open to change the button\r\n\t * values.\r\n\t */\r\n\tchooseParentValue(value: string) {\r\n\t\tconst dropdownButton = this.props.room.parentElem as HTMLButtonElement;\r\n\t\tdropdownButton.value = value;\r\n\t\tconst changeEvent = new Event('change');\r\n\t\tdropdownButton.dispatchEvent(changeEvent);\r\n\t\tPS.closePopup();\r\n\t}\r\n\tfocus() {\r\n\t\tif (PSView.hasTapped) return;\r\n\r\n\t\tconst autofocus = this.base?.querySelector<HTMLElement>('.autofocus');\r\n\t\tautofocus?.focus();\r\n\t\t(autofocus as HTMLInputElement)?.select?.();\r\n\t}\r\n\toverride render() {\r\n\t\treturn <PSPanelWrapper room={this.props.room}>\r\n\t\t\t<div class=\"mainmessage\"><p>Loading...</p></div>\r\n\t\t</PSPanelWrapper>;\r\n\t}\r\n}\r\n\r\nexport function PSPanelWrapper(props: {\r\n\troom: PSRoom, children: preact.ComponentChildren,\r\n\tfocusClick?: boolean, scrollable?: boolean | 'hidden', width?: number | 'auto',\r\n\tfullSize?: boolean, onDragEnter?: (ev: DragEvent) => void,\r\n}) {\r\n\tconst room = props.room;\r\n\tif (room.location === 'mini-window') {\r\n\t\tconst size = props.fullSize ? ' mini-window-flex' : '';\r\n\t\treturn <div\r\n\t\t\tid={`room-${room.id}`}\r\n\t\t\tclass={`mini-window-contents tiny-layout ps-room-light${props.scrollable === true ? ' scrollable' : ''}${size}`}\r\n\t\t\tonClick={props.focusClick ? PSView.focusIfNoSelection : undefined} onDragEnter={props.onDragEnter}\r\n\t\t>\r\n\t\t\t{props.children}\r\n\t\t</div>;\r\n\t}\r\n\tif (PS.isPopup(room)) {\r\n\t\tconst style = PSView.getPopupStyle(room, props.width, props.fullSize);\r\n\t\treturn <div class=\"ps-popup\" id={`room-${room.id}`} style={style} onDragEnter={props.onDragEnter}>\r\n\t\t\t{props.children}\r\n\t\t</div>;\r\n\t}\r\n\tconst style = PSView.posStyle(room) as any;\r\n\tif (props.scrollable === 'hidden') style.overflow = 'hidden';\r\n\tconst tinyLayout = room.width < 620 ? ' tiny-layout' : '';\r\n\treturn <div\r\n\t\tclass={`ps-room${room.id === '' ? '' : ' ps-room-light'}${props.scrollable === true ? ' scrollable' : ''}${tinyLayout}`}\r\n\t\tid={`room-${room.id}`} role=\"tabpanel\" aria-labelledby={`roomtab-${room.id}`}\r\n\t\tstyle={style} onClick={props.focusClick ? PSView.focusIfNoSelection : undefined} onDragEnter={props.onDragEnter}\r\n\t>\r\n\t\t{room.caughtError ? <div class=\"broadcast broadcast-red\"><pre>{room.caughtError}</pre></div> : props.children}\r\n\t</div>;\r\n}\r\n\r\nexport class PSView extends preact.Component {\r\n\tstatic readonly isIOS = [\r\n\t\t'iPad Simulator', 'iPhone Simulator', 'iPod Simulator', 'iPad', 'iPhone', 'iPod',\r\n\t].includes(navigator.platform);\r\n\tstatic readonly isChrome = navigator.userAgent.includes(' Chrome/');\r\n\tstatic readonly isSafari = !this.isChrome && navigator.userAgent.includes(' Safari/');\r\n\tstatic readonly isFirefox = navigator.userAgent.includes(' Firefox/');\r\n\tstatic readonly isMac = navigator.platform?.startsWith('Mac');\r\n\tstatic textboxFocused = false;\r\n\tstatic dragend: ((ev: DragEvent) => void) | null = null;\r\n\t/** was the last click event a tap? heristic for mobile/desktop */\r\n\tstatic hasTapped = false;\r\n\t/** mode where the tabbar is opened rather than always being there */\r\n\tstatic narrowMode = false;\r\n\tstatic verticalHeaderWidth = VERTICAL_HEADER_WIDTH;\r\n\tstatic setTextboxFocused(focused: boolean) {\r\n\t\tif (!PSView.narrowMode) return;\r\n\t\tif (!PSView.isChrome && !PSView.isSafari) return;\r\n\t\t// Chrome bug: on Android, it insistently scrolls everything leftmost when scroll snap is enabled\r\n\r\n\t\tthis.textboxFocused = focused;\r\n\t\tif (focused) {\r\n\t\t\tdocument.documentElement.classList.remove('scroll-snap-enabled');\r\n\t\t\tPSView.scrollToRoom();\r\n\t\t} else {\r\n\t\t\tdocument.documentElement.classList.add('scroll-snap-enabled');\r\n\t\t}\r\n\t}\r\n\tstatic focusPreview(room: PSRoom) {\r\n\t\tif (room !== PS.room) return '';\r\n\r\n\t\tconst verticalBuf = this.verticalFocusPreview();\r\n\t\tif (verticalBuf) return verticalBuf;\r\n\r\n\t\tconst isMiniRoom = PS.room.location === 'mini-window';\r\n\t\tconst { rooms, index } = PS.horizontalNav();\r\n\t\tif (index === -1) return '';\r\n\r\n\t\tlet buf = ' ';\r\n\t\tconst leftRoom = PS.rooms[rooms[index - 1]];\r\n\t\tif (leftRoom) buf += `\\u2190 ${leftRoom.title}`;\r\n\t\tbuf += (PS.arrowKeysUsed || isMiniRoom ? \" | \" : \" (use arrow keys) \");\r\n\t\tconst rightRoom = PS.rooms[rooms[index + 1]];\r\n\t\tif (rightRoom) buf += `${rightRoom.title} \\u2192`;\r\n\t\treturn buf;\r\n\t}\r\n\tstatic verticalFocusPreview() {\r\n\t\tconst { rooms, index } = PS.verticalNav();\r\n\t\tif (index === -1) return '';\r\n\r\n\t\tconst upRoom = PS.rooms[rooms[index - 1]];\r\n\t\tlet downRoom = PS.rooms[rooms[index + 1]];\r\n\t\tif (index === rooms.length - 2 && rooms[index + 1] === 'news') downRoom = undefined;\r\n\t\tif (!upRoom && !downRoom) return '';\r\n\r\n\t\tlet buf = ' ';\r\n\t\t// const altLabel = PSMain.isMac ? '⌥' : 'ᴀʟᴛ';\r\n\t\tconst altLabel = PSView.isMac ? 'ᴏᴘᴛ' : 'ᴀʟᴛ';\r\n\t\tif (upRoom) buf += `${altLabel}\\u2191 ${upRoom.title}`;\r\n\t\tbuf += \" | \";\r\n\t\tif (downRoom) buf += `${altLabel}\\u2193 ${downRoom.title}`;\r\n\r\n\t\treturn buf;\r\n\t}\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tPS.subscribe(() => this.forceUpdate());\r\n\r\n\t\tif (PSView.isSafari) {\r\n\t\t\t// I don't want to prevent users from being able to zoom, but iOS Safari\r\n\t\t\t// auto-zooms when focusing textboxes (unless the font size is 16px),\r\n\t\t\t// and this apparently fixes it while still allowing zooming.\r\n\t\t\tdocument.querySelector('meta[name=viewport]')?.setAttribute('content', 'width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0');\r\n\t\t}\r\n\r\n\t\twindow.onbeforeunload = (ev: Event) => {\r\n\t\t\treturn PS.prefs.refreshprompt ? \"Are you sure you want to leave?\" : null;\r\n\t\t};\r\n\r\n\t\twindow.addEventListener('submit', ev => {\r\n\t\t\tconst elem = ev.target as HTMLFormElement | null;\r\n\t\t\tif (elem?.getAttribute('data-submitsend')) {\r\n\t\t\t\tconst inputs = Net.formData(elem);\r\n\t\t\t\tlet cmd = elem.getAttribute('data-submitsend')!;\r\n\t\t\t\tfor (const [name, value] of Object.entries(inputs)) {\r\n\t\t\t\t\tcmd = cmd.replace(`{${name}}`, value === true ? 'on' : value === false ? 'off' : value);\r\n\t\t\t\t}\r\n\t\t\t\tcmd = cmd.replace(/\\{[a-z0-9-]+\\}/g, '');\r\n\t\t\t\tconst room = PS.getRoom(elem) || PS.mainmenu;\r\n\t\t\t\troom.sendDirect(cmd);\r\n\r\n\t\t\t\tev.preventDefault();\r\n\t\t\t\tev.stopImmediatePropagation();\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\twindow.addEventListener('pointerdown', ev => {\r\n\t\t\t// can't be part of the click event because Safari pretends the pointer is a mouse\r\n\t\t\tPSView.hasTapped = ev.pointerType === 'touch' || ev.pointerType === 'pen';\r\n\t\t});\r\n\r\n\t\twindow.addEventListener('click', ev => {\r\n\t\t\tlet elem = ev.target as HTMLElement | null;\r\n\t\t\tconst clickedRoom = PS.getRoom(elem);\r\n\t\t\twhile (elem) {\r\n\t\t\t\tif (elem.className === 'spoiler') {\r\n\t\t\t\t\telem.className = 'spoiler-shown';\r\n\t\t\t\t} else if (elem.className === 'spoiler-shown') {\r\n\t\t\t\t\telem.className = 'spoiler';\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (` ${elem.className} `.includes(' username ')) {\r\n\t\t\t\t\tconst name = elem.getAttribute('data-name') || elem.innerText;\r\n\t\t\t\t\tconst userid = toID(name);\r\n\t\t\t\t\tconst roomid = `${` ${elem.className} `.includes(' no-interact ') ? 'viewuser' : 'user'}-${userid}` as RoomID;\r\n\t\t\t\t\tPS.join(roomid, {\r\n\t\t\t\t\t\tparentElem: elem,\r\n\t\t\t\t\t\trightPopup: elem.className === 'userbutton username',\r\n\t\t\t\t\t\targs: { username: name },\r\n\t\t\t\t\t});\r\n\t\t\t\t\tev.preventDefault();\r\n\t\t\t\t\tev.stopImmediatePropagation();\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (elem.tagName === 'A' || elem.getAttribute('data-href')) {\r\n\t\t\t\t\tif (ev.ctrlKey || ev.metaKey || ev.shiftKey) break;\r\n\r\n\t\t\t\t\tconst href = elem.getAttribute('data-href') || elem.getAttribute('href');\r\n\t\t\t\t\tlet roomid = PS.router.extractRoomID(href);\r\n\r\n\t\t\t\t\t// keep this in sync with .htaccess\r\n\t\t\t\t\tconst shortLinks = /^(rooms?suggestions?|suggestions?|adminrequests?|forgotpassword|bugs?(reports?)?|formatsuggestions|rules?|faq|credits?|privacy|contact|dex|(damage)?calc|insecure|replays?|devdiscord|smogdex|smogcord|forums?|trustworthy-dlc-link)$/;\r\n\t\t\t\t\tif (roomid === 'appeal' || roomid === 'appeals') roomid = 'view-help-request--appeal' as RoomID;\r\n\t\t\t\t\tif (roomid === 'report') roomid = 'view-help-request--report' as RoomID;\r\n\t\t\t\t\tif (roomid === 'requesthelp') roomid = 'view-help-request--other' as RoomID;\r\n\r\n\t\t\t\t\tif (roomid !== null && elem.className !== 'no-panel-intercept' && !shortLinks.test(roomid)) {\r\n\t\t\t\t\t\tlet location = null;\r\n\t\t\t\t\t\tif (elem.getAttribute('data-target') === 'replace') {\r\n\t\t\t\t\t\t\tconst room = PS.getRoom(elem);\r\n\t\t\t\t\t\t\tif (room) {\r\n\t\t\t\t\t\t\t\tPS.leave(room.id);\r\n\t\t\t\t\t\t\t\tlocation = room.location;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tPS.join(roomid, {\r\n\t\t\t\t\t\t\tparentElem: elem,\r\n\t\t\t\t\t\t\tlocation,\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tif (!PS.isPopup(PS.rooms[roomid])) {\r\n\t\t\t\t\t\t\tPS.closeAllPopups();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tev.preventDefault();\r\n\t\t\t\t\t\tev.stopImmediatePropagation();\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tif (elem.getAttribute('data-cmd')) {\r\n\t\t\t\t\tconst cmd = elem.getAttribute('data-cmd')!;\r\n\t\t\t\t\tconst room = PS.getRoom(elem) || PS.mainmenu;\r\n\t\t\t\t\troom.send(cmd, elem);\r\n\t\t\t\t\tev.preventDefault();\r\n\t\t\t\t\tev.stopImmediatePropagation();\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tif (elem.getAttribute('data-sendraw')) {\r\n\t\t\t\t\tconst cmd = elem.getAttribute('data-sendraw')!;\r\n\t\t\t\t\tconst room = PS.getRoom(elem) || PS.mainmenu;\r\n\t\t\t\t\troom.sendDirect(cmd);\r\n\t\t\t\t\tev.preventDefault();\r\n\t\t\t\t\tev.stopImmediatePropagation();\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tif (elem.tagName === 'BUTTON') {\r\n\t\t\t\t\tif (this.handleButtonClick(elem as HTMLButtonElement)) {\r\n\t\t\t\t\t\tev.preventDefault();\r\n\t\t\t\t\t\tev.stopImmediatePropagation();\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t} else if (!elem.getAttribute('type')) {\r\n\t\t\t\t\t\t// the spec says that buttons with no `type` attribute should be\r\n\t\t\t\t\t\t// submit buttons, but this is a bad default so we're going\r\n\t\t\t\t\t\t// to just assume they're not\r\n\t\t\t\t\t\telem.setAttribute('type', 'button');\r\n\r\n\t\t\t\t\t\t// don't return, to allow <a><button> to make links that look\r\n\t\t\t\t\t\t// like buttons\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (elem.id.startsWith('room-')) {\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\telem = elem.parentElement;\r\n\t\t\t}\r\n\t\t\tif (PS.room !== clickedRoom) {\r\n\t\t\t\tif (clickedRoom) PS.room = clickedRoom;\r\n\t\t\t\tPS.room.autoDismissNotifications();\r\n\t\t\t\tPS.closePopupsAbove(clickedRoom);\r\n\t\t\t\tPS.update();\r\n\t\t\t}\r\n\t\t\tif (clickedRoom && !PS.isPopup(clickedRoom)) {\r\n\t\t\t\tPSView.scrollToRoom();\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\twindow.addEventListener('keydown', ev => {\r\n\t\t\tlet elem = ev.target as HTMLInputElement | null;\r\n\t\t\tlet isTextInput = false;\r\n\t\t\tlet isNonEmptyTextInput = false;\r\n\t\t\tif (elem) {\r\n\t\t\t\tisTextInput = (elem.tagName === 'INPUT' || elem.tagName === 'TEXTAREA');\r\n\t\t\t\tif (isTextInput && ['button', 'radio', 'checkbox', 'file'].includes(elem.type)) {\r\n\t\t\t\t\tisTextInput = false;\r\n\t\t\t\t}\r\n\t\t\t\tif (isTextInput && elem.value) {\r\n\t\t\t\t\tisNonEmptyTextInput = true;\r\n\t\t\t\t}\r\n\t\t\t\tif (elem.contentEditable === 'true') {\r\n\t\t\t\t\tisTextInput = true;\r\n\t\t\t\t\tif (elem.textContent && elem.textContent !== '\\n') {\r\n\t\t\t\t\t\tisNonEmptyTextInput = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (!isNonEmptyTextInput) {\r\n\t\t\t\tif (PS.room.onParentEvent?.('keydown', ev) === false) {\r\n\t\t\t\t\tev.stopImmediatePropagation();\r\n\t\t\t\t\tev.preventDefault();\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tconst modifierKey = ev.ctrlKey || ev.altKey || ev.metaKey || ev.shiftKey;\r\n\t\t\tconst altKey = !ev.ctrlKey && ev.altKey && !ev.metaKey && !ev.shiftKey;\r\n\t\t\tif (altKey && ev.keyCode === 38) { // alt + up\r\n\t\t\t\tPS.arrowKeysUsed = true;\r\n\t\t\t\tPS.focusUpRoom();\r\n\t\t\t} else if (altKey && ev.keyCode === 40) { // alt + down\r\n\t\t\t\tPS.arrowKeysUsed = true;\r\n\t\t\t\tPS.focusDownRoom();\r\n\t\t\t} else if (ev.keyCode === 27) { // escape\r\n\t\t\t\t// close popups\r\n\t\t\t\tif (PS.popups.length) {\r\n\t\t\t\t\tev.stopImmediatePropagation();\r\n\t\t\t\t\tev.preventDefault();\r\n\t\t\t\t\tPS.closePopup();\r\n\t\t\t\t\tPS.focusRoom(PS.room.id);\r\n\t\t\t\t} else if (PS.room.id === 'rooms') {\r\n\t\t\t\t\tPS.hideRightRoom();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (isNonEmptyTextInput) return;\r\n\t\t\tif (altKey && ev.keyCode === 37) { // alt + left\r\n\t\t\t\tPS.arrowKeysUsed = true;\r\n\t\t\t\tPS.focusLeftRoom();\r\n\t\t\t} else if (altKey && ev.keyCode === 39) { // alt + right\r\n\t\t\t\tPS.arrowKeysUsed = true;\r\n\t\t\t\tPS.focusRightRoom();\r\n\t\t\t}\r\n\t\t\tif (modifierKey) return;\r\n\t\t\tif (ev.keyCode === 37) { // left\r\n\t\t\t\tPS.arrowKeysUsed = true;\r\n\t\t\t\tPS.focusLeftRoom();\r\n\t\t\t} else if (ev.keyCode === 39) { // right\r\n\t\t\t\tPS.arrowKeysUsed = true;\r\n\t\t\t\tPS.focusRightRoom();\r\n\t\t\t} else if (ev.keyCode === 191 && !isTextInput && PS.room === PS.mainmenu) { // forward slash\r\n\t\t\t\tev.stopImmediatePropagation();\r\n\t\t\t\tev.preventDefault();\r\n\t\t\t\tPS.join('dm---' as RoomID);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\twindow.addEventListener('dragend', ev => {\r\n\t\t\tPS.dragging = null;\r\n\t\t\tev.preventDefault();\r\n\t\t});\r\n\r\n\t\twindow.addEventListener('drop', ev => {\r\n\t\t\tconsole.log(`drop: ${ev.dataTransfer?.dropEffect as any}`);\r\n\t\t\tconst target = ev.target as HTMLElement;\r\n\t\t\tif (PS.dragging?.type === 'room') {\r\n\t\t\t\tif ((target as HTMLInputElement).type?.startsWith(\"text\")) {\r\n\t\t\t\t\tPS.dragging = null;\r\n\t\t\t\t\treturn; // Rooms dragged into text fields become URLs\r\n\t\t\t\t}\r\n\t\t\t\tPS.updateAutojoin();\r\n\t\t\t\tev.preventDefault();\r\n\t\t\t\tPS.dragging = null;\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tif (!PS.dragging || PS.dragging.type === '?') {\r\n\t\t\t\t// dragging text\r\n\t\t\t\tif (!ev.dataTransfer?.files.length) return;\r\n\t\t\t}\r\n\r\n\t\t\t// The default file drop action for Firefox is to open the file as a\r\n\t\t\t// URL, which needs to be prevented.\r\n\t\t\t// The default file drop action for most browsers is to open the file\r\n\t\t\t// in the tab, which is generally undesirable anyway.\r\n\t\t\tev.preventDefault();\r\n\r\n\t\t\tfor (const Panel of Object.values(PS.roomTypes)) {\r\n\t\t\t\tif (Panel!.handleDrop?.(ev)) {\r\n\t\t\t\t\tPS.dragging = null;\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tPS.alert(\r\n\t\t\t\t`Sorry, we don't know what to do with that file.\\n\\nSupported file types:\\n` +\r\n\t\t\t\t`- images (to set your background)\\n- downloaded replay files\\n- team files`\r\n\t\t\t);\r\n\t\t\tPS.dragging = null;\r\n\t\t});\r\n\r\n\t\tconst colorSchemeQuery = window.matchMedia?.('(prefers-color-scheme: dark)');\r\n\t\tif (colorSchemeQuery?.media !== 'not all') {\r\n\t\t\tcolorSchemeQuery.addEventListener('change', cs => {\r\n\t\t\t\tif (PS.prefs.theme === 'system') document.body.className = cs.matches ? 'dark' : '';\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tPS.prefs.subscribeAndRun(key => {\r\n\t\t\tif (!key || key === 'theme') {\r\n\t\t\t\tconst dark = PS.prefs.theme === 'dark' ||\r\n\t\t\t\t\t(PS.prefs.theme === 'system' && colorSchemeQuery?.matches);\r\n\t\t\t\tdocument.body.className = dark ? 'dark' : '';\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\tstatic scrollToHeader() {\r\n\t\tif (PSView.narrowMode && window.scrollX > 0) {\r\n\t\t\tif (PSView.isSafari || PSView.isFirefox) {\r\n\t\t\t\t// Safari bug: `scrollBy` doesn't actually work when scroll snap is enabled\r\n\t\t\t\t// note: interferes with the `PSView.textboxFocused` workaround for a Chrome bug\r\n\t\t\t\tdocument.documentElement.classList.remove('scroll-snap-enabled');\r\n\t\t\t\twindow.scrollTo(0, 0);\r\n\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\tif (!PSView.textboxFocused) document.documentElement.classList.add('scroll-snap-enabled');\r\n\t\t\t\t}, 1);\r\n\t\t\t} else {\r\n\t\t\t\twindow.scrollTo(0, 0);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tstatic scrollToRoom() {\r\n\t\tif (PSView.narrowMode && window.scrollX === 0) {\r\n\t\t\tif (PSView.isSafari || PSView.isFirefox) {\r\n\t\t\t\t// Safari bug: `scrollBy` doesn't actually work when scroll snap is enabled\r\n\t\t\t\t// note: interferes with the `PSView.textboxFocused` workaround for a Chrome bug\r\n\t\t\t\tdocument.documentElement.classList.remove('scroll-snap-enabled');\r\n\t\t\t\twindow.scrollTo(NARROW_MODE_HEADER_WIDTH, 0);\r\n\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\tif (!PSView.textboxFocused) document.documentElement.classList.add('scroll-snap-enabled');\r\n\t\t\t\t}, 1);\r\n\t\t\t} else {\r\n\t\t\t\twindow.scrollTo(NARROW_MODE_HEADER_WIDTH, 0);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tstatic focusIfNoSelection = (ev: MouseEvent) => {\r\n\t\tconst room = PS.getRoom(ev.target as HTMLElement, true);\r\n\t\tif (!room) return;\r\n\r\n\t\tif (window.getSelection?.()?.type === 'Range') return;\r\n\t\troom.autoDismissNotifications();\r\n\t\tPS.setFocus(room);\r\n\t};\r\n\thandleClickOverlay = (ev: MouseEvent) => {\r\n\t\t// iOS Safari bug, no global click events when tapping\r\n\t\t// I'm sure it's intentional but it interferes with putting the dismiss feature in window.onclick\r\n\t\tif ((ev.target as Element)?.className === 'ps-overlay') {\r\n\t\t\tPS.closePopup();\r\n\t\t\tev.preventDefault();\r\n\t\t\tev.stopImmediatePropagation();\r\n\t\t}\r\n\t};\r\n\thandleButtonClick(elem: HTMLButtonElement) {\r\n\t\tswitch (elem.name) {\r\n\t\tcase 'closeRoom': {\r\n\t\t\tconst roomid = elem.value as RoomID || PS.getRoom(elem)?.id || '' as RoomID;\r\n\t\t\tPS.rooms[roomid]?.send('/close', elem);\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\tcase 'joinRoom':\r\n\t\t\tPS.join(elem.value as RoomID, {\r\n\t\t\t\tparentElem: elem,\r\n\t\t\t});\r\n\t\t\treturn true;\r\n\t\tcase 'register':\r\n\t\t\tPS.join('register' as RoomID, {\r\n\t\t\t\tparentElem: elem,\r\n\t\t\t});\r\n\t\t\treturn true;\r\n\t\tcase 'showOtherFormats': {\r\n\t\t\t// TODO: refactor to a command after we drop support for the old client\r\n\t\t\tconst table = elem.closest('table');\r\n\t\t\tconst room = PS.getRoom(elem);\r\n\t\t\tif (table) {\r\n\t\t\t\tfor (const row of table.querySelectorAll<HTMLElement>('tr.hidden')) {\r\n\t\t\t\t\trow.style.display = 'table-row';\r\n\t\t\t\t}\r\n\t\t\t\tfor (const row of table.querySelectorAll<HTMLElement>('tr.no-matches')) {\r\n\t\t\t\t\trow.style.display = 'none';\r\n\t\t\t\t}\r\n\t\t\t\telem.closest('tr')!.style.display = 'none';\r\n\t\t\t\t(room as ChatRoom).log?.updateScroll();\r\n\t\t\t}\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\tcase 'copyText':\r\n\t\t\tconst dummyInput = document.createElement(\"input\");\r\n\t\t\t// This is a hack. You can only \"select\" an input field.\r\n\t\t\t//  The trick is to create a short lived input element and destroy it after a copy.\r\n\t\t\t// (stolen from the replay code, obviously --mia)\r\n\t\t\tdummyInput.id = \"dummyInput\";\r\n\t\t\tdummyInput.value = elem.value || (elem as any).href || \"\";\r\n\t\t\tdummyInput.style.position = 'absolute';\r\n\t\t\telem.appendChild(dummyInput);\r\n\t\t\tdummyInput.select();\r\n\t\t\tdocument.execCommand(\"copy\");\r\n\t\t\telem.removeChild(dummyInput);\r\n\t\t\telem.innerText = 'Copied!';\r\n\t\t\treturn true;\r\n\t\tcase 'send':\r\n\t\tcase 'cmd':\r\n\t\t\tconst room = PS.getRoom(elem) || PS.mainmenu;\r\n\t\t\tif (elem.name === 'send') {\r\n\t\t\t\troom.sendDirect(elem.value);\r\n\t\t\t} else {\r\n\t\t\t\troom.send(elem.value);\r\n\t\t\t}\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\tcomponentDidCatch(err: Error) {\r\n\t\tPS.mainmenu.caughtError = err.stack || err.message;\r\n\t\tthis.setState({});\r\n\t}\r\n\tstatic containingRoomid(elem: HTMLElement) {\r\n\t\tlet curElem: HTMLElement | null = elem;\r\n\t\twhile (curElem) {\r\n\t\t\tif (curElem.id.startsWith('room-')) {\r\n\t\t\t\treturn curElem.id.slice(5) as RoomID;\r\n\t\t\t}\r\n\t\t\tcurElem = curElem.parentElement;\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\tstatic isEmptyClick(e: MouseEvent) {\r\n\t\ttry {\r\n\t\t\tconst selection = window.getSelection()!;\r\n\t\t\tif (selection.type === 'Range') return false;\r\n\t\t} catch {}\r\n\t\tBattleTooltips.hideTooltip();\r\n\t}\r\n\tstatic posStyle(room: PSRoom) {\r\n\t\tif (PS.leftPanelWidth === null) {\r\n\t\t\t// vertical mode\r\n\t\t\tif (room === PS.panel) {\r\n\t\t\t\t// const minWidth = Math.min(500, Math.max(320, document.body.offsetWidth - 9));\r\n\t\t\t\treturn { top: '30px', left: `${PSView.verticalHeaderWidth}px`, minWidth: `none` };\r\n\t\t\t}\r\n\t\t} else if (PS.leftPanelWidth === 0) {\r\n\t\t\t// one panel visible\r\n\t\t\tif (room === PS.panel) return {};\r\n\t\t} else {\r\n\t\t\t// both panels visible\r\n\t\t\tif (room === PS.leftPanel) return { width: `${PS.leftPanelWidth}px`, right: 'auto' };\r\n\t\t\tif (room === PS.rightPanel) return { top: 56, left: PS.leftPanelWidth + 1 };\r\n\t\t}\r\n\r\n\t\treturn { display: 'none' };\r\n\t}\r\n\tstatic getPopupStyle(room: PSRoom, width?: number | 'auto', fullSize?: boolean): any {\r\n\t\tif (fullSize) {\r\n\t\t\treturn { width: '90%', maxHeight: '90%', maxWidth: 'none', position: 'relative', margin: '5vh auto 0' };\r\n\t\t}\r\n\r\n\t\tconst source = room.parentElem?.getBoundingClientRect();\r\n\t\tif (source && !source.width && !source.height && !source.top && !source.left) {\r\n\t\t\t// parent elem has been unmounted\r\n\t\t\troom.parentElem = null;\r\n\t\t\tPS.update();\r\n\t\t}\r\n\r\n\t\tif (room.location === 'modal-popup' || !room.parentElem || !source) {\r\n\t\t\treturn { maxWidth: width || 480 };\r\n\t\t}\r\n\t\tif (!room.width || !room.height) {\r\n\t\t\troom.focusNextUpdate = true;\r\n\t\t\treturn {\r\n\t\t\t\tposition: 'absolute',\r\n\t\t\t\tvisibility: 'hidden',\r\n\t\t\t\tmargin: 0,\r\n\t\t\t\ttop: 0,\r\n\t\t\t\tleft: 0,\r\n\t\t\t};\r\n\t\t}\r\n\t\t// nonmodal popup: should be positioned near source element\r\n\t\tlet style: any = {\r\n\t\t\tposition: 'absolute',\r\n\t\t\tmargin: 0,\r\n\t\t};\r\n\t\t// semimodal popups exist in a fixed-positioned overlay and are\r\n\t\t// positioned relative to the overlay (the viewport).\r\n\t\t// regular popups are positioned relative to the document root, and so\r\n\t\t// need to account for scrolling.\r\n\t\tconst isFixed = room.location !== 'popup';\r\n\t\tconst offsetLeft = isFixed ? 0 : window.scrollX;\r\n\t\tconst offsetTop = isFixed ? 0 : window.scrollY;\r\n\t\tconst availableWidth = document.documentElement.clientWidth + offsetLeft;\r\n\t\tconst availableHeight = document.documentElement.clientHeight;\r\n\r\n\t\tconst sourceWidth = source.width;\r\n\t\tconst sourceHeight = source.height;\r\n\t\tconst sourceTop = source.top + offsetTop;\r\n\t\tconst sourceLeft = source.left + offsetLeft;\r\n\r\n\t\tconst height = room.height;\r\n\t\twidth = width || room.width;\r\n\r\n\t\tif (room.rightPopup) {\r\n\r\n\t\t\tif (availableHeight > sourceTop + height + 5 &&\r\n\t\t\t\t(sourceTop < availableHeight * 2 / 3 || sourceTop + 200 < availableHeight)) {\r\n\t\t\t\tstyle.top = sourceTop;\r\n\t\t\t} else if (sourceTop + sourceHeight >= height) {\r\n\t\t\t\tstyle.bottom = Math.max(availableHeight - sourceTop - sourceHeight, 0);\r\n\t\t\t} else {\r\n\t\t\t\tstyle.top = Math.max(0, availableHeight - height);\r\n\t\t\t}\r\n\t\t\tconst popupLeft = sourceLeft + sourceWidth;\r\n\t\t\tif (width !== 'auto' && popupLeft + width > availableWidth) {\r\n\t\t\t\t// can't fit, give up and put it in the normal place\r\n\t\t\t\tstyle = {\r\n\t\t\t\t\tposition: 'absolute',\r\n\t\t\t\t\tmargin: 0,\r\n\t\t\t\t};\r\n\t\t\t} else {\r\n\t\t\t\tstyle.left = popupLeft;\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tif (style.left === undefined) {\r\n\r\n\t\t\tif (availableHeight > sourceTop + sourceHeight + height + 5 &&\r\n\t\t\t\t(sourceTop + sourceHeight < availableHeight * 2 / 3 || sourceTop + sourceHeight + 200 < availableHeight)) {\r\n\t\t\t\tstyle.top = sourceTop + sourceHeight;\r\n\t\t\t} else if (height + 30 <= sourceTop) {\r\n\t\t\t\tstyle.bottom = Math.max(availableHeight - sourceTop, 0);\r\n\t\t\t} else if (height + 35 < availableHeight) {\r\n\t\t\t\tstyle.bottom = 5;\r\n\t\t\t} else {\r\n\t\t\t\tstyle.top = 25;\r\n\t\t\t}\r\n\r\n\t\t\tconst availableAlignedWidth = availableWidth - sourceLeft;\r\n\t\t\tif (width !== 'auto' && availableAlignedWidth < width + 10) {\r\n\t\t\t\t// while `right: 10` would be simpler, it doesn't work if there is horizontal scrolling,\r\n\t\t\t\t// like in the mobile layout\r\n\t\t\t\tstyle.left = Math.max(availableWidth - width - 10, offsetLeft);\r\n\t\t\t} else {\r\n\t\t\t\tstyle.left = sourceLeft;\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tif (width) style.maxWidth = width;\r\n\r\n\t\treturn style;\r\n\t}\r\n\trenderRoom(room: PSRoom) {\r\n\t\tconst RoomType = PS.roomTypes[room.type];\r\n\t\tconst Panel = RoomType && !room.isPlaceholder && !room.caughtError ? RoomType : PSRoomPanel;\r\n\t\treturn <Panel key={room.id} room={room} />;\r\n\t}\r\n\trenderPopup(room: PSRoom) {\r\n\t\tconst RoomType = PS.roomTypes[room.type];\r\n\t\tconst Panel = RoomType && !room.isPlaceholder && !room.caughtError ? RoomType : PSRoomPanel;\r\n\t\tif (room.location === 'popup' && room.parentElem) {\r\n\t\t\treturn <Panel key={room.id} room={room} />;\r\n\t\t}\r\n\t\treturn <div key={room.id} class=\"ps-overlay\" onClick={this.handleClickOverlay} role=\"dialog\">\r\n\t\t\t<Panel room={room} />\r\n\t\t</div>;\r\n\t}\r\n\trender() {\r\n\t\tlet rooms = [] as preact.VNode[];\r\n\t\tfor (const roomid in PS.rooms) {\r\n\t\t\tconst room = PS.rooms[roomid]!;\r\n\t\t\tif (PS.isNormalRoom(room)) {\r\n\t\t\t\trooms.push(this.renderRoom(room));\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn <div class=\"ps-frame\" role=\"none\">\r\n\t\t\t<PSHeader />\r\n\t\t\t<PSMiniHeader />\r\n\t\t\t{rooms}\r\n\t\t\t{PS.popups.map(roomid => this.renderPopup(PS.rooms[roomid]!))}\r\n\t\t</div>;\r\n\t}\r\n}\r\n\r\nexport function PSIcon(\r\n\tprops: { pokemon: string | Pokemon | ServerPokemon | Dex.PokemonSet | null } |\r\n\t\t{ item: string } | { type: string, b?: boolean } | { category: string }\r\n) {\r\n\tif ('pokemon' in props) {\r\n\t\treturn <span class=\"picon\" style={Dex.getPokemonIcon(props.pokemon)} />;\r\n\t}\r\n\tif ('item' in props) {\r\n\t\treturn <span class=\"itemicon\" style={Dex.getItemIcon(props.item)} />;\r\n\t}\r\n\tif ('type' in props) {\r\n\t\tlet type = Dex.types.get(props.type).name;\r\n\t\tif (!type) type = '???';\r\n\t\tlet sanitizedType = type.replace(/\\?/g, '%3f');\r\n\t\treturn <img\r\n\t\t\tsrc={`${Dex.resourcePrefix}sprites/types/${sanitizedType}.png`} alt={type}\r\n\t\t\theight=\"14\" width=\"32\" class={`pixelated${props.b ? ' b' : ''}`}\r\n\t\t/>;\r\n\t}\r\n\tif ('category' in props) {\r\n\t\tconst categoryID = toID(props.category);\r\n\t\tlet sanitizedCategory = '';\r\n\t\tswitch (categoryID) {\r\n\t\tcase 'physical':\r\n\t\tcase 'special':\r\n\t\tcase 'status':\r\n\t\t\tsanitizedCategory = categoryID.charAt(0).toUpperCase() + categoryID.slice(1);\r\n\t\t\tbreak;\r\n\t\tdefault:\r\n\t\t\tsanitizedCategory = 'undefined';\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\treturn <img\r\n\t\t\tsrc={`${Dex.resourcePrefix}sprites/categories/${sanitizedCategory}.png`} alt={sanitizedCategory}\r\n\t\t\theight=\"14\" width=\"32\" class=\"pixelated\"\r\n\t\t/>;\r\n\t}\r\n\treturn null!;\r\n}\r\n"],"mappings":"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","ignoreList":[]}