{"version":3,"file":"battle-dex.js","names":["window","global","exports","nodewebkit","process","_process$versions","versions","toID","text","_text","_text2","id","userid","toLowerCase","replace","toUserid","PSUtils","_class","_proto","prototype","splitFirst","str","delimiter","limit","arguments","length","undefined","splitStr","delimiterIndex","indexOf","push","slice","compare","a","b","localeCompare","Array","isArray","i","comparison","reverse","Error","sortBy","array","callback","sort","toRoomid","roomid","toName","name","trim","substr","Dex","_class2","_this","Ability","Item","Move","Species","gen","modid","cache","REGULAR","WEAK","RESIST","IMMUNE","statNames","statNamesExceptHP","pokeballs","resourcePrefix","_window$document","prefix","document","location","protocol","Config","routes","client","fxPrefix","_window$document2","loadedSpriteData","xy","bw","moddedDexes","afdMode","moves","get","nameOrMove","BattleAliases","BattleMovedex","data","exists","_ref","exec","hpWithType","hpPower","Object","assign","basePower","Number","move","items","nameOrItem","BattleItems","item","abilities","nameOrAbility","BattleAbilities","ability","species","nameOrSpecies","formid","BattlePokedexAltForms","BattlePokedex","BattleBaseSpeciesChart","_i2","_BattleBaseSpeciesCha2","baseSpeciesId","startsWith","_evos","tier","endsWith","baseSpecies","nfe","evos","some","evo","evoSpecies","isNonstandard","cosmeticFormes","_i4","_species$cosmeticForm2","forme","baseForme","otherFormes","types","allCache","namesCache","type","_window$BattleTypeCha","toUpperCase","BattleTypeChart","damageTaken","effectType","all","names","map","splice","isName","_window$BattleTypeCha2","hasOwnProperty","_proto2","convertLearnsetArrayToString","learnsetArray","generations","Set","versionChars","_i6","moveSource","parseInt","charAt","add","includes","genString","from","join","versionString","loadModData","modId","depth","BattleTeambuilderTable","AvailableCustomMods","xhr","XMLHttpRequest","serverUrl","PS","server","host","console","log","open","send","status","statusText","modData","JSON","parse","responseText","e","integrateModData","error","debug","parentMod","parentData","stringify","baseProps","_i8","prop","learnsets","overrideSpeciesData","overrideMoveData","overrideAbilityData","overrideItemData","overrideTier","overrideTypeChart","mon","pokedex","monData","inherit","attribute","moveData","itemData","monLearnsetData","formatsData","speciesId","formatData","typeId","typechart","typeData","keys","initializeCustomMods","availableModsXhr","availableMods","availableModsData","String","warn","formatModsXhr","formatMods","FormatModMapping","_i0","_availableMods2","mod","ModdedDex","forGen","formatGen","format","formatid","forFormat","formatId","dex","resolveAvatar","avatar","_window$Config","BattleAvatarNumbers","registered","port","encodeURIComponent","sanitizeName","prefs","_window$Storage","_window$PS","Storage","getShortName","shortName","getEffect","PureEffect","getGen3Category","hasAbility","loadSpriteData","path","$","attr","qs","split","el","createElement","src","getElementsByTagName","appendChild","getSpriteData","pokemon","isFront","options","mechanicsGen","isDynamax","dynamax","Pokemon","volatiles","transform","shiny","gender","isGigantamax","getSpeciesForme","spriteData","w","h","y","url","pixelated","isFrontSprite","cryurl","spriteid","dir","facing","graphicsGen","Math","max","min","baseDir","miscData","speciesid","isTotem","BattlePokemonSprites","BattlePokemonSpritesBW","num","baseSpeciesid","formeid","isMega","afd","noScale","animatedSprite","animationArray","_i10","_ref2","animationData","animDir","getPokemonIconNum","isFemale","facingLeft","_window$BattlePokemon","_window$BattlePokedex","_window$BattlePokemon2","BattlePokemonIconIndexes","BattlePokemonIconIndexesLeft","getPokemonIcon","_pokemon","_pokemon2","_pokemon3","_pokemon4","_pokemon5","speciesForme","formechange","top","floor","left","fainted","getTeambuilderSpriteData","spriteDir","x","homeExists","xydexExists","getTeambuilderSprite","xOffset","yOffset","resize","getItemIcon","_item","spritenum","getTypeIcon","sanitizedType","getCategoryIcon","category","categoryID","sanitizedCategory","getPokeballs","_window","_i12","_Object$values2","values","isPokeball","_this2","Moves","Items","Abilities","Types","table","_data$evos","curNames","concat","removeType","_proto3","_window2","_i14","_Object$values4","require"],"sources":["../src/battle-dex.ts"],"sourcesContent":["/**\r\n * Pokemon Showdown Dex\r\n *\r\n * Roughly equivalent to sim/dex.js in a Pokemon Showdown server, but\r\n * designed for use in browsers rather than in Node.\r\n *\r\n * This is a generic utility library for Pokemon Showdown code: any\r\n * code shared between the replay viewer and the client usually ends up\r\n * here.\r\n *\r\n * Licensing note: PS's client has complicated licensing:\r\n * - The client as a whole is AGPLv3\r\n * - The battle replay/animation engine (battle-*.ts) by itself is MIT\r\n *\r\n * Compiled into battledata.js which includes all dependencies\r\n *\r\n * @author Guangcong Luo <guangcongluo@gmail.com>\r\n * @license MIT\r\n */\r\n\r\nimport {Pokemon, type ServerPokemon} from \"./battle\";\r\nimport type * as DexData from \"./battle-dex-data\";\r\nimport {\r\n\tAbility,\r\n\tBattleAvatarNumbers,\r\n\tBattleBaseSpeciesChart,\r\n\tBattlePokemonIconIndexes,\r\n\tBattlePokemonIconIndexesLeft,\r\n\ttype ID,\r\n\tItem,\r\n\tMove,\r\n\tPureEffect,\r\n\tSpecies,\r\n\ttype Type,\r\n} from \"./battle-dex-data\";\r\nimport type {Teams} from \"./battle-teams\";\r\nimport {Config, PS} from \"./client-main\";\r\n\r\nexport declare namespace Dex {\r\n\t/* eslint-disable @typescript-eslint/no-shadow */\r\n\texport type Ability = DexData.Ability;\r\n\texport type Item = DexData.Item;\r\n\texport type Move = DexData.Move;\r\n\texport type Species = DexData.Species;\r\n\texport type Type = DexData.Type;\r\n\texport type Nature = DexData.Nature;\r\n\texport type PureEffect = DexData.PureEffect;\r\n\texport type Effect = DexData.Effect;\r\n\texport type ID = DexData.ID;\r\n\t/* eslint-enable @typescript-eslint/no-shadow */\r\n\texport type StatName = DexData.StatName;\r\n\texport type StatNameExceptHP = DexData.StatNameExceptHP;\r\n\texport type BoostStatName = DexData.BoostStatName;\r\n\texport type TypeName = DexData.TypeName;\r\n\texport type StatusName = DexData.StatusName;\r\n\texport type GenderName = DexData.GenderName;\r\n\texport type NatureName = DexData.NatureName;\r\n\texport type MoveTarget = DexData.MoveTarget;\r\n\texport type REGULAR = 0;\r\n\texport type WEAK = 1;\r\n\texport type RESIST = 2;\r\n\texport type IMMUNE = 3;\r\n\texport type WeaknessType = REGULAR | WEAK | RESIST | IMMUNE;\r\n\texport type StatsTable = { hp: number, atk: number, def: number, spa: number, spd: number, spe: number };\r\n\texport type PokemonSet = Teams.PokemonSet;\r\n}\r\nexport type { ID };\r\n\r\ndeclare const require: any;\r\ndeclare const global: any;\r\ndeclare const process: any;\r\n\r\nif (typeof window === 'undefined') {\r\n\t// Node\r\n\tglobal.window = global;\r\n} else {\r\n\t// browser (possibly NW.js!)\r\n\twindow.exports = window;\r\n}\r\n\r\nwindow.nodewebkit = !!(typeof process !== 'undefined' && process.versions?.['node-webkit']);\r\n\r\nexport function toID(text: any) {\r\n\tif (text?.id) {\r\n\t\ttext = text.id;\r\n\t} else if (text?.userid) {\r\n\t\ttext = text.userid;\r\n\t}\r\n\tif (typeof text !== 'string' && typeof text !== 'number') return '' as ID;\r\n\treturn `${text}`.toLowerCase().replace(/[^a-z0-9]+/g, '') as ID;\r\n}\r\n\r\nexport function toUserid(text: any) {\r\n\treturn toID(text);\r\n}\r\n\r\ntype Comparable = number | string | boolean | Comparable[] | { reverse: Comparable };\r\nexport const PSUtils = new class {\r\n\t/**\r\n\t * Like string.split(delimiter), but only recognizes the first `limit`\r\n\t * delimiters (default 1).\r\n\t *\r\n\t * `\"1 2 3 4\".split(\" \", 2) => [\"1\", \"2\"]`\r\n\t *\r\n\t * `splitFirst(\"1 2 3 4\", \" \", 1) => [\"1\", \"2 3 4\"]`\r\n\t *\r\n\t * Returns an array of length exactly limit + 1.\r\n\t */\r\n\tsplitFirst(str: string, delimiter: string, limit = 1) {\r\n\t\tlet splitStr: string[] = [];\r\n\t\twhile (splitStr.length < limit) {\r\n\t\t\tlet delimiterIndex = str.indexOf(delimiter);\r\n\t\t\tif (delimiterIndex >= 0) {\r\n\t\t\t\tsplitStr.push(str.slice(0, delimiterIndex));\r\n\t\t\t\tstr = str.slice(delimiterIndex + delimiter.length);\r\n\t\t\t} else {\r\n\t\t\t\tsplitStr.push(str);\r\n\t\t\t\tstr = '';\r\n\t\t\t}\r\n\t\t}\r\n\t\tsplitStr.push(str);\r\n\t\treturn splitStr;\r\n\t}\r\n\r\n\t/**\r\n\t * Compares two variables; intended to be used as a smarter comparator.\r\n\t * The two variables must be the same type (TypeScript will not check this).\r\n\t *\r\n\t * - Numbers are sorted low-to-high, use `-val` to reverse\r\n\t * - Strings are sorted A to Z case-semi-insensitively, use `{reverse: val}` to reverse\r\n\t * - Booleans are sorted true-first (REVERSE of casting to numbers), use `!val` to reverse\r\n\t * - Arrays are sorted lexically in the order of their elements\r\n\t *\r\n\t * In other words: `[num, str]` will be sorted A to Z, `[num, {reverse: str}]` will be sorted Z to A.\r\n\t */\r\n\tcompare(a: Comparable, b: Comparable): number {\r\n\t\tif (typeof a === 'number') {\r\n\t\t\treturn a - (b as number);\r\n\t\t}\r\n\t\tif (typeof a === 'string') {\r\n\t\t\treturn a.localeCompare(b as string);\r\n\t\t}\r\n\t\tif (typeof a === 'boolean') {\r\n\t\t\treturn (a ? 1 : 2) - (b ? 1 : 2);\r\n\t\t}\r\n\t\tif (Array.isArray(a)) {\r\n\t\t\tfor (let i = 0; i < a.length; i++) {\r\n\t\t\t\tconst comparison = PSUtils.compare(a[i], (b as Comparable[])[i]);\r\n\t\t\t\tif (comparison) return comparison;\r\n\t\t\t}\r\n\t\t\treturn 0;\r\n\t\t}\r\n\t\tif (a.reverse) {\r\n\t\t\treturn PSUtils.compare((b as { reverse: string }).reverse, a.reverse);\r\n\t\t}\r\n\t\tthrow new Error(`Passed value ${a as any} is not comparable`);\r\n\t}\r\n\t/**\r\n\t * Sorts an array according to the callback's output on its elements.\r\n\t *\r\n\t * The callback's output is compared according to `PSUtils.compare` (in\r\n\t * particular, it supports arrays so you can sort by multiple things).\r\n\t */\r\n\tsortBy<T>(array: T[], callback: (a: T) => Comparable): T[];\r\n\t/**\r\n\t * Sorts an array according to `PSUtils.compare`. (Correctly sorts numbers,\r\n\t * unlike `array.sort`)\r\n\t */\r\n\tsortBy<T extends Comparable>(array: T[]): T[];\r\n\tsortBy<T>(array: T[], callback?: (a: T) => Comparable) {\r\n\t\tif (!callback) return (array as any[]).sort(PSUtils.compare);\r\n\t\treturn array.sort((a, b) => PSUtils.compare(callback(a), callback(b)));\r\n\t}\r\n};\r\n\r\n/**\r\n * Sanitize a room ID by removing anything that isn't alphanumeric or `-`.\r\n * Shouldn't actually do anything except against malicious input.\r\n */\r\nexport function toRoomid(roomid: string) {\r\n\treturn roomid.replace(/[^a-zA-Z0-9-]+/g, '').toLowerCase();\r\n}\r\n\r\nexport function toName(name: any) {\r\n\tif (typeof name !== 'string' && typeof name !== 'number') return '';\r\n\tname = `${name}`.replace(/[|\\s[\\],\\u202e]+/g, ' ').trim();\r\n\tif (name.length > 18) name = name.substr(0, 18).trim();\r\n\r\n\t// remove zalgo\r\n\tname = name.replace(\r\n\t\t/[\\u0300-\\u036f\\u0483-\\u0489\\u0610-\\u0615\\u064B-\\u065F\\u0670\\u06D6-\\u06DC\\u06DF-\\u06ED\\u0E31\\u0E34-\\u0E3A\\u0E47-\\u0E4E]{3,}/g,\r\n\t\t''\r\n\t);\r\n\tname = name.replace(/[\\u239b-\\u23b9]/g, '');\r\n\r\n\treturn name;\r\n}\r\n\r\nexport interface SpriteData {\r\n\tw: number;\r\n\th: number;\r\n\ty?: number;\r\n\tgen?: number;\r\n\turl?: string;\r\n\trawHTML?: string;\r\n\tpixelated?: boolean;\r\n\tisFrontSprite?: boolean;\r\n\tcryurl?: string;\r\n\tshiny?: boolean;\r\n}\r\n\r\nexport interface TeambuilderSpriteData {\r\n\tx: number;\r\n\ty: number;\r\n\th?: number;\r\n\tspriteDir: string;\r\n\tspriteid: string;\r\n\tshiny?: boolean;\r\n}\r\n\r\nexport const Dex = new class implements ModdedDex {\r\n\treadonly Ability = Ability;\r\n\treadonly Item = Item;\r\n\treadonly Move = Move;\r\n\treadonly Species = Species;\r\n\r\n\treadonly gen = 9;\r\n\treadonly modid = 'gen9' as ID;\r\n\treadonly cache = null!;\r\n\r\n\treadonly REGULAR = 0;\r\n\treadonly WEAK = 1;\r\n\treadonly RESIST = 2;\r\n\treadonly IMMUNE = 3;\r\n\r\n\treadonly statNames: readonly Dex.StatName[] = ['hp', 'atk', 'def', 'spa', 'spd', 'spe'];\r\n\treadonly statNamesExceptHP: readonly Dex.StatNameExceptHP[] = ['atk', 'def', 'spa', 'spd', 'spe'];\r\n\r\n\tpokeballs: string[] | null = null;\r\n\r\n\tresourcePrefix = (() => {\r\n\t\tlet prefix = '';\r\n\t\tif (window.document?.location?.protocol !== 'http:') prefix = 'https:';\r\n\t\treturn `${prefix}//${window.Config ? Config.routes.client : 'play.pokemonshowdown.com'}/`;\r\n\t})();\r\n\r\n\tfxPrefix = (() => {\r\n\t\tconst protocol = (window.document?.location?.protocol !== 'http:') ? 'https:' : '';\r\n\t\treturn `${protocol}//${window.Config ? Config.routes.client : 'play.pokemonshowdown.com'}/fx/`;\r\n\t})();\r\n\r\n\tloadedSpriteData = { xy: 1, bw: 0 };\r\n\tmoddedDexes: { [mod: string]: ModdedDex } = {};\r\n\r\n\t/**\r\n\t * April Fools' Day setting:\r\n\t * * `true` = FULL, all jokes on\r\n\t * * `'sprites'` = SPRITES, only sprites and taunts\r\n\t * * `false | null | undefined` = OFF\r\n\t */\r\n\tafdMode?: boolean | 'sprites';\r\n\r\n\t/**\r\n\t * Takes in an input array for a moveset change and converts it to a string used internally.\r\n\t */\r\n\tconvertLearnsetArrayToString(learnsetArray: string[] | any): string | any {\r\n\t\tif (!Array.isArray(learnsetArray)) {\r\n\t\t\treturn learnsetArray;\r\n\t\t}\r\n\r\n\t\tconst generations = new Set();\r\n\t\tconst versionChars = new Set();\r\n\r\n\t\tfor (const moveSource of learnsetArray) {\r\n\t\t\t// Extract generation number (first character)\r\n\t\t\tconst gen = parseInt(moveSource.charAt(0));\r\n\t\t\tif (gen >= 1 && gen <= 9) {  // todo: test and maintain properly. I hate this piece of code.\r\n\t\t\t\tgenerations.add(gen);\r\n\r\n\t\t\t\tif (gen === 6) versionChars.add('p');\r\n\t\t\t\telse if (gen === 7 && !moveSource.includes('V')) versionChars.add('q');\r\n\t\t\t\telse if (gen === 8 && !moveSource.includes('V')) versionChars.add('g');\r\n\t\t\t\telse if (gen === 9 && !moveSource.includes('V')) versionChars.add('a');\r\n\r\n\t\t\t\t// Handle egg moves for Gen 9 (following build-tools logic)\r\n\t\t\t\tif (gen === 9 && moveSource.includes('E')) versionChars.add('e');\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Convert to sorted string format\r\n\t\tconst genString = Array.from(generations).sort().join('');\r\n\t\tconst versionString = Array.from(versionChars).join('');\r\n\r\n\t\treturn genString + versionString;\r\n\t}\r\n\r\n\t/**\r\n\t * Load mod data recursively based on parent mod.\r\n\t */\r\n\tloadModData(modId: ID, depth = 0) {\r\n\t\tif (depth > 10) throw new Error('Max mod inheritance depth exceeded. Potential cyclicality may be in effect.'); // todo: move magic number to config.\r\n\t\tif (window.BattleTeambuilderTable[modId]) return; // Already loaded\r\n\r\n\t\tif (!window.AvailableCustomMods.includes(modId)) {\r\n\t\t\tthrow new Error(`Attempt at loading mod that is not available from server: (${modId} not in [${window.AvailableCustomMods}])`);\r\n\t\t}\r\n\r\n\t\ttry {\r\n\t\t\tconst xhr = new XMLHttpRequest();\r\n\t\t\tconst serverUrl = `http://${PS.server.host}`;\r\n\t\t\tconsole.log(`Attempting to fetch moddata for ${modId} from ${serverUrl}`)\r\n\t\t\txhr.open('GET', `${serverUrl}/data/moddata?mod=${modId}`, false); // false = synchronous. Intentional.\r\n\t\t\txhr.send();\r\n\r\n\t\t\tif (xhr.status !== 200) {\r\n\t\t\t\tthrow new Error(`HTTP ${xhr.status}: ${xhr.statusText}`);\r\n\t\t\t}\r\n\r\n\t\t\tlet modData;\r\n\t\t\ttry {\r\n\t\t\t\tmodData = JSON.parse(xhr.responseText);\r\n\t\t\t} catch (e) {\r\n\t\t\t\tthrow new Error(`Invalid JSON for mod ${modId}: ${e}`);\r\n\t\t\t}\r\n\r\n\t\t\tif (!modData || typeof modData !== 'object') {\r\n\t\t\t\tthrow new Error(`Invalid mod data structure for ${modId}`);\r\n\t\t\t}\r\n\r\n\t\t\tconsole.log(`Integrating data for mod ${modId}`);\r\n\t\t\tthis.integrateModData(modId, modData, depth);\r\n\r\n\t\t} catch (error) {\r\n\t\t\tconsole.error(`Failed to load mod data for ${modId}:`, error);\r\n\t\t\tthrow error;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Integrates fetched mod data to be applied to modId's mod.\r\n\t * @param modId The ID of the mod to integrade this data into.\r\n\t * @param modData The data fetched from server to integrate this data into.\r\n\t * @param depth Current recursion depth for being able to load into parentMods.\r\n\t */\r\n\tintegrateModData(modId: ID, modData: any, depth: number) {\r\n\t\t// Recursively load parent if specified. Skips if it's the base gen; this is handled below.\r\n\t\tconsole.debug(`Mod: ${modId} has parent ${modData.parentMod}.`);\r\n\r\n\t\tif (modData.parentMod && modData.parentMod !== `gen${Dex.gen}`) {\r\n\t\t\tconsole.debug(`Preparing parent data of mod ${modData.parentMod} for ${modId}`);\r\n\t\t\tthis.loadModData(modData.parentMod, depth + 1);\r\n\t\t\t// Inherit parent data\r\n\t\t\tconst parentData = window.BattleTeambuilderTable[modData.parentMod];\r\n\t\t\twindow.BattleTeambuilderTable[modId] = JSON.parse(JSON.stringify(parentData));\r\n\t\t// Create a copy of the base gen.\r\n\t\t} else if (modData.parentMod === `gen${Dex.gen}`) {\r\n\t\t\tconsole.debug(`Loading base gen (gen${Dex.gen}) into ${modId} as it's parent.`)\r\n\t\t\t// Todo: create a copy of the base gen.\r\n\t\t\tconst baseProps = [\r\n\t\t\t\t'tiers', 'items', 'overrideTier', 'ubersUUBans', 'monotypeBans',\r\n\t\t\t\t'formatSlices', 'learnsets', 'overrideSpeciesData', 'overrideMoveData',\r\n\t\t\t\t'overrideAbilityData', 'overrideItemData', 'overrideTypeChart', 'removeType',\r\n\t\t\t];\r\n\r\n\t\t\tconst parentData: { [prop: string] : any} = {};\r\n\t\t\tfor (const prop of baseProps) {\r\n\t\t\t\tif (window.BattleTeambuilderTable[prop] !== undefined) {\r\n\t\t\t\t\tparentData[prop] = window.BattleTeambuilderTable[prop];\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\t// Horrible, brute-ish solution.\r\n\t\t\t\t\tif (prop === 'learnsets') {\r\n\t\t\t\t\t\tparentData[prop] = window.BattleTeambuilderTable.learnsets || {};\r\n\t\t\t\t\t} else if (['tiers', 'items'].includes(prop)) {\r\n\t\t\t\t\t\tparentData[prop] = [];\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tparentData[prop] = {};\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\twindow.BattleTeambuilderTable[modId] = JSON.parse(JSON.stringify(parentData));\r\n\t\t} else {\r\n\t\t\t// No parent, initialize empty structure\r\n\t\t\tconsole.debug(`Mod ${modId} has no parent, initializing empty table.`)\r\n\t\t\twindow.BattleTeambuilderTable[modId] = {\r\n\t\t\t\toverrideSpeciesData: {},\r\n\t\t\t\toverrideMoveData: {},\r\n\t\t\t\toverrideAbilityData: {},\r\n\t\t\t\toverrideItemData: {},\r\n\t\t\t\tlearnsets: {},\r\n\t\t\t\toverrideTier: {},\r\n\t\t\t\toverrideTypeChart: {},\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\t// Note: This repeated code segment is here by intention as it allows us to easily modify specific behaviour for each response format output we expect.\r\n\t\t// Merge pokedex entries\r\n\t\tconsole.debug(`Merging pokedex entries.`);\r\n\t\tfor (const mon in modData.pokedex) {\r\n\t\t\tconst monData = modData.pokedex[mon];\r\n\t\t\tconsole.debug(`Applying modification for mon ${mon}. inherit = ${monData.inherit}`);\r\n\t\t\tif (!monData.inherit) {\r\n\t\t\t\twindow.BattleTeambuilderTable[modId].overrideSpeciesData[mon] = monData;\r\n\t\t\t\tconsole.debug(`Replaced mon data for ${mon} due to inherit = ${monData.inherit}`);\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tif (!window.BattleTeambuilderTable[modId].overrideSpeciesData[mon]) {\r\n\t\t\t\twindow.BattleTeambuilderTable[modId].overrideSpeciesData[mon] = {};\r\n\t\t\t\tconsole.debug(`Created new table entry for mon ${mon}`);\r\n\t\t\t}\r\n\t\t\tfor (const attribute in monData) {\r\n\t\t\t\tif (attribute !== 'inherit') {\r\n\t\t\t\t\twindow.BattleTeambuilderTable[modId].overrideSpeciesData[mon][attribute] = monData[attribute];\r\n\t\t\t\t\tconsole.debug(`Attaching attribute ${attribute} to table.`);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// todo: add Abilities here. This is for Abilities functionality. I'm not sure this is even needed.\r\n\t\t// Merge move entries\r\n\t\tconsole.debug(`Merging move entries.`);\r\n\t\tfor (const move in modData.moves) {\r\n\t\t\tconst moveData = modData.moves[move];\r\n\t\t\tconsole.debug(`Applying modification for move ${move}. inherit = ${moveData.inherit}`);\r\n\t\t\tif (!moveData.inherit) {\r\n\t\t\t\twindow.BattleTeambuilderTable[modId].overrideMoveData[move] = moveData;\r\n\t\t\t\tconsole.debug(`Replaced move data for ${move} due to inherit = ${moveData.inherit}`);\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tif (!window.BattleTeambuilderTable[modId].overrideMoveData[move]) {\r\n\t\t\t\twindow.BattleTeambuilderTable[modId].overrideMoveData[move] = {};\r\n\t\t\t\tconsole.debug(`Created new table entry for move ${move}`);\r\n\t\t\t}\r\n\t\t\tfor (const attribute in moveData) {\r\n\t\t\t\tif (attribute !== 'inherit') {\r\n\t\t\t\t\twindow.BattleTeambuilderTable[modId].overrideMoveData[move][attribute] = moveData[attribute];\r\n\t\t\t\t\tconsole.debug(`Attaching attribute ${attribute} to table.`);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Merge items entries\r\n\t\tconsole.debug(`Merging item entries.`);\r\n\t\tfor (const item in modData.items) {\r\n\t\t\tconst itemData = modData.items[item];\r\n\t\t\tconsole.debug(`Applying modification for item ${item}. inherit = ${itemData.inherit}`);\r\n\t\t\tif (!itemData.inherit) {\r\n\t\t\t\twindow.BattleTeambuilderTable[modId].overrideItemData[item] = itemData;\r\n\t\t\t\tconsole.debug(`Replaced item data for ${item} due to inherit = ${itemData.inherit}`);\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tif (!window.BattleTeambuilderTable[modId].overrideItemData[item]) {\r\n\t\t\t\twindow.BattleTeambuilderTable[modId].overrideItemData[item] = {};\r\n\t\t\t\tconsole.debug(`Created new table entry for item ${item}`);\r\n\t\t\t}\r\n\t\t\tfor (const attribute in itemData) {\r\n\t\t\t\tif (attribute !== 'inherit') {\r\n\t\t\t\t\twindow.BattleTeambuilderTable[modId].overrideItemData[item][attribute] = itemData[attribute];\r\n\t\t\t\t\tconsole.debug(`Attaching attribute ${attribute} to table.`);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Merge learnset entries\r\n\t\tconsole.debug(`Merging learnset entries.`);\r\n\t\tfor (const mon in modData.learnsets) {\r\n\t\t\tconst monLearnsetData = modData.learnsets[mon];\r\n\t\t\tif (!window.BattleTeambuilderTable[modId].learnsets[mon]) {\r\n\t\t\t\twindow.BattleTeambuilderTable[modId].learnsets[mon] = {};\r\n\t\t\t}\r\n\t\t\tfor (const move in monLearnsetData) {\r\n\t\t\t\t// Set availability of moves here. Inherit is not applied as changes to base are assumed.\r\n\t\t\t\t// Have to have their type converted first.\r\n\t\t\t\twindow.BattleTeambuilderTable[modId].learnsets[mon][move] = this.convertLearnsetArrayToString(monLearnsetData[move]);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Merge formats data\r\n\t\tconsole.debug(`Merging formatdata entries.`);\r\n\t\tif (modData.formatsData) {\r\n\t\t\tif (!window.BattleTeambuilderTable[modId].overrideTier) {\r\n\t\t\t\twindow.BattleTeambuilderTable[modId].overrideTier = {};\r\n\t\t\t}\r\n\r\n\t\t\tfor (const speciesId in modData.formatsData) {\r\n\t\t\t\tconst formatData = modData.formatsData[speciesId];\r\n\t\t\t\tif (formatData.tier) {\r\n\t\t\t\t\twindow.BattleTeambuilderTable[modId].overrideTier[speciesId] = formatData.tier;\r\n\t\t\t\t\tconsole.debug(`Modifying formatdata for ${speciesId} to ${formatData.tier}`);\r\n\t\t\t\t\t// todo: implement other overrides too.. this just does default tier not ND Ubers or something. In case that might be relevant.\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Merge type chart changes.\r\n\t\tconsole.debug(\"Merging typechart entries.\");\r\n\t\tif (!window.BattleTeambuilderTable[modId].overrideTypeChart) {\r\n\t\t\twindow.BattleTeambuilderTable[modId].overrideTypeChart = {};\r\n\t\t}\r\n\t\t// if (!window.BattleTeambuilderTable[modId].removeType) {window.BattleTeambuilderTable[modId].removeType = {};} // Not currently supported, but might be in the future.\r\n\r\n\t\tfor (const typeId in modData.typechart) {\r\n\t\t\tconst typeData = modData.typechart[typeId];\r\n\t\t\t// Inherit is currently discarded, but might be supported in the future.\r\n\t\t\twindow.BattleTeambuilderTable[modId].overrideTypeChart[typeId] = typeData;\r\n\t\t}\r\n\r\n\t\tconsole.debug(`Implemented overrides from server on mod ${modId} with ${Object.keys(window.BattleTeambuilderTable[modId].overrideSpeciesData).length} species & ${Object.keys(window.BattleTeambuilderTable[modId].learnsets).length} learnsets.`);\r\n\t}\r\n\r\n\t/**\r\n\t * Function to initialise custom mods fetched from the configurated server.\r\n\t * Assumes to be ran after BattleTeambuilderTable is loaded.\r\n\t * Will always fetch from server if it's an available mod from the server.\r\n\t */\r\n\tinitializeCustomMods(): void {\r\n\t\ttry {\r\n\t\t\tconsole.log('Initializing custom-mods. Requires connection to server with the right endpoint infrastructure.');\r\n\r\n\t\t\tconst serverUrl = `http://${PS.server.host}`;\r\n\t\t\tconst availableModsXhr = new XMLHttpRequest();\r\n\t\t\tconsole.log(`Attempting to fetch availablemods from ${serverUrl}`)\r\n\t\t\tavailableModsXhr.open('GET', `${serverUrl}/data/availablemods`, false); // false = synchronous\r\n\t\t\tavailableModsXhr.send();\r\n\r\n\t\t\tif (availableModsXhr.status !== 200) {\r\n\t\t\t\tthrow new Error(`HTTP ${availableModsXhr.status}: ${availableModsXhr.statusText}`);\r\n\t\t\t}\r\n\r\n\t\t\tlet availableMods: string[] = [];\r\n\t\t\ttry {\r\n\t\t\t\tconst availableModsData = JSON.parse(availableModsXhr.responseText);\r\n\t\t\t\tif (Array.isArray(availableModsData)) {\r\n\t\t\t\t\tavailableMods = availableModsData.map(String);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tconsole.warn('Unexpected availableMods structure');\r\n\t\t\t\t}\r\n\t\t\t} catch (e) {\r\n\t\t\t\tthrow new Error(`Invalid JSON for availableMods: ${e}`);\r\n\t\t\t}\r\n\t\t\tconsole.log(`Found ${availableMods.length} available mods`);\r\n\r\n\r\n\r\n\t\t\tconst formatModsXhr = new XMLHttpRequest();\r\n\t\t\tconsole.log(`Attempting to fetch formatmods from ${serverUrl}`)\r\n\t\t\tformatModsXhr.open('GET', `${serverUrl}/data/formatmods`, false); // false = synchronous\r\n\t\t\tformatModsXhr.send();\r\n\r\n\t\t\tif (formatModsXhr.status !== 200) {\r\n\t\t\t\tthrow new Error(`HTTP ${formatModsXhr.status}: ${formatModsXhr.statusText}`);\r\n\t\t\t}\r\n\r\n\t\t\tlet formatMods: { [formatId: string]: string } = {};\r\n\r\n\t\t\ttry {\r\n\t\t\t\tformatMods = JSON.parse(formatModsXhr.responseText);\r\n\t\t\t} catch (e) {\r\n\t\t\t\tthrow new Error(`Invalid JSON for formatMods: ${e}`);\r\n\t\t\t}\r\n\t\t\tconsole.log(`Found ${Object.keys(formatMods).length} format mappings`);\r\n\r\n\t\t\twindow.FormatModMapping = formatMods;\r\n\t\t\twindow.AvailableCustomMods = availableMods;\r\n\r\n\t\t\t// Load all mods synchronously\r\n\t\t\tfor (const modId of availableMods) {\r\n\t\t\t\tthis.loadModData(modId as ID);\r\n\t\t\t}\r\n\r\n\t\t} catch (error) {\r\n\t\t\tconsole.warn('Failed to load custom mods:', error);\r\n\t\t}\r\n\t}\r\n\r\n\tmod(modid: ID): ModdedDex {\r\n\t\tif (modid === 'gen9') return this;\r\n\t\tif (!window.BattleTeambuilderTable) return this;\r\n\t\tif (modid in this.moddedDexes) {\r\n\t\t\treturn this.moddedDexes[modid];\r\n\t\t}\r\n\r\n\t\tif (!window.BattleTeambuilderTable[modid]) {\r\n\t\t\tthis.loadModData(modid); // Todo: async.run solution? I don't like this. I hate it, even. Doesn't wait here and thus means\r\n\t\t}\r\n\r\n\t\tthis.moddedDexes[modid] = new ModdedDex(modid);\r\n\t\treturn this.moddedDexes[modid];\r\n\t}\r\n\tforGen(gen: number) {\r\n\t\tif (!gen) return this;\r\n\t\treturn this.mod(`gen${gen}` as ID);\r\n\t}\r\n\tformatGen(format: string) {\r\n\t\tconst formatid = toID(format);\r\n\t\tif (!formatid) return Dex.gen;\r\n\t\tif (!formatid.startsWith('gen')) return 6;\r\n\t\treturn parseInt(formatid.charAt(3)) || Dex.gen;\r\n\t}\r\n\tforFormat(format: string) {\r\n\r\n\t\t// Inject custom format. I really hope this works ;-;\r\n\t\tconst formatId = toID(format).slice(4);\r\n\t\tif (window.FormatModMapping && window.FormatModMapping[formatId]) {\r\n\t\t\tconst modId = window.FormatModMapping[formatId];\r\n\t\t\treturn Dex.mod(modId);\r\n\t\t}\r\n\r\n\t\tlet dex = Dex.forGen(Dex.formatGen(format));\r\n\r\n\t\tconst formatid = toID(format).slice(4);\r\n\t\tif (dex.gen === 7 && formatid.includes('letsgo')) {\r\n\t\t\tdex = Dex.mod('gen7letsgo' as ID);\r\n\t\t}\r\n\t\tif (dex.gen === 8 && formatid.includes('bdsp')) {\r\n\t\t\tdex = Dex.mod('gen8bdsp' as ID);\r\n\t\t}\r\n\t\treturn dex;\r\n\t}\r\n\r\n\tresolveAvatar(avatar: string): string {\r\n\t\tif (window.BattleAvatarNumbers && avatar in BattleAvatarNumbers) {\r\n\t\t\tavatar = BattleAvatarNumbers[avatar];\r\n\t\t}\r\n\t\tif (avatar.startsWith('#')) {\r\n\t\t\treturn Dex.resourcePrefix + 'sprites/trainers-custom/' + toID(avatar.substr(1)) + '.png';\r\n\t\t}\r\n\t\tif (avatar.includes('.') && window.Config?.server?.registered) {\r\n\t\t\t// custom avatar served by the server\r\n\t\t\tconst protocol = (Config.server.port === 443) ? 'https' : 'http';\r\n\t\t\tconst server = `${protocol}://${Config.server.host}:${Config.server.port}`;\r\n\t\t\treturn `${server}/avatars/${encodeURIComponent(avatar).replace(/%3F/g, '?')}`;\r\n\t\t}\r\n\t\treturn Dex.resourcePrefix + 'sprites/trainers/' + Dex.sanitizeName(avatar || 'unknown') + '.png';\r\n\t}\r\n\r\n\t/**\r\n\t * This is used to sanitize strings from data files like `moves.js` and\r\n\t * `teambuilder-tables.js`.\r\n\t *\r\n\t * This makes sure untrusted strings can't wreak havoc if someone forgets to\r\n\t * escape it before putting it in HTML.\r\n\t *\r\n\t * None of these characters belong in these files, anyway. (They can be used\r\n\t * in move descriptions, but those are served from `text.js`, which are\r\n\t * definitely always treated as unsanitized.)\r\n\t */\r\n\tsanitizeName(name: any) {\r\n\t\tif (!name) return '';\r\n\t\treturn ('' + name)\r\n\t\t\t.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/\"/g, '&quot;')\r\n\t\t\t.slice(0, 50);\r\n\t}\r\n\r\n\tprefs(prop: string) {\r\n\t\t// @ts-expect-error this is what I get for calling it Storage...\r\n\t\treturn window.Storage?.prefs ? window.Storage.prefs(prop) : window.PS?.prefs?.[prop];\r\n\t}\r\n\r\n\tgetShortName(name: string) {\r\n\t\tlet shortName = name.replace(/[^A-Za-z0-9]+$/, '');\r\n\t\tif (shortName.includes('(')) {\r\n\t\t\tshortName += name.slice(shortName.length).replace(/[^()]+/g, '').replace(/\\(\\)/g, '');\r\n\t\t}\r\n\t\treturn shortName;\r\n\t}\r\n\r\n\tgetEffect(name: string | null | undefined): PureEffect | Item | Ability | Move {\r\n\t\tname = (name || '').trim();\r\n\t\tif (name.substr(0, 5) === 'item:') {\r\n\t\t\treturn Dex.items.get(name.substr(5).trim());\r\n\t\t} else if (name.substr(0, 8) === 'ability:') {\r\n\t\t\treturn Dex.abilities.get(name.substr(8).trim());\r\n\t\t} else if (name.substr(0, 5) === 'move:') {\r\n\t\t\treturn Dex.moves.get(name.substr(5).trim());\r\n\t\t}\r\n\t\tlet id = toID(name);\r\n\t\treturn new PureEffect(id, name);\r\n\t}\r\n\r\n\tmoves = {\r\n\t\tget: (nameOrMove: string | Move | null | undefined): Move => {\r\n\t\t\tif (nameOrMove && typeof nameOrMove !== 'string') {\r\n\t\t\t\t// TODO: don't accept Moves here\r\n\t\t\t\treturn nameOrMove;\r\n\t\t\t}\r\n\t\t\tlet name = nameOrMove || '';\r\n\t\t\tlet id = toID(nameOrMove);\r\n\t\t\tif (window.BattleAliases && id in BattleAliases) {\r\n\t\t\t\tname = BattleAliases[id];\r\n\t\t\t\tid = toID(name);\r\n\t\t\t}\r\n\t\t\tif (!window.BattleMovedex) window.BattleMovedex = {};\r\n\t\t\tlet data = window.BattleMovedex[id];\r\n\t\t\tif (data && typeof data.exists === 'boolean') return data;\r\n\r\n\t\t\tif (!data && id.substr(0, 11) === 'hiddenpower' && id.length > 11) {\r\n\t\t\t\tlet [, hpWithType, hpPower] = /([a-z]*)([0-9]*)/.exec(id)!;\r\n\t\t\t\tdata = {\r\n\t\t\t\t\t...(window.BattleMovedex[hpWithType] || {}),\r\n\t\t\t\t\tbasePower: Number(hpPower) || 60,\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t\tif (!data && id.substr(0, 6) === 'return' && id.length > 6) {\r\n\t\t\t\tdata = {\r\n\t\t\t\t\t...(window.BattleMovedex['return'] || {}),\r\n\t\t\t\t\tbasePower: Number(id.slice(6)),\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t\tif (!data && id.substr(0, 11) === 'frustration' && id.length > 11) {\r\n\t\t\t\tdata = {\r\n\t\t\t\t\t...(window.BattleMovedex['frustration'] || {}),\r\n\t\t\t\t\tbasePower: Number(id.slice(11)),\r\n\t\t\t\t};\r\n\t\t\t}\r\n\r\n\t\t\tif (!data) data = { exists: false };\r\n\t\t\tlet move = new Move(id, name, data);\r\n\t\t\twindow.BattleMovedex[id] = move;\r\n\t\t\treturn move;\r\n\t\t},\r\n\t};\r\n\r\n\tgetGen3Category(type: string) {\r\n\t\treturn [\r\n\t\t\t'Fire', 'Water', 'Grass', 'Electric', 'Ice', 'Psychic', 'Dark', 'Dragon',\r\n\t\t].includes(type) ? 'Special' : 'Physical';\r\n\t}\r\n\r\n\titems = {\r\n\t\tget: (nameOrItem: string | Item | null | undefined): Item => {\r\n\t\t\tif (nameOrItem && typeof nameOrItem !== 'string') {\r\n\t\t\t\t// TODO: don't accept Items here\r\n\t\t\t\treturn nameOrItem;\r\n\t\t\t}\r\n\t\t\tlet name = nameOrItem || '';\r\n\t\t\tlet id = toID(nameOrItem);\r\n\t\t\tif (window.BattleAliases && id in BattleAliases) {\r\n\t\t\t\tname = BattleAliases[id];\r\n\t\t\t\tid = toID(name);\r\n\t\t\t}\r\n\t\t\tif (!window.BattleItems) window.BattleItems = {};\r\n\t\t\tlet data = window.BattleItems[id];\r\n\t\t\tif (data && typeof data.exists === 'boolean') return data;\r\n\t\t\tif (!data) data = { exists: false };\r\n\t\t\tlet item = new Item(id, name, data);\r\n\t\t\twindow.BattleItems[id] = item;\r\n\t\t\treturn item;\r\n\t\t},\r\n\t};\r\n\r\n\tabilities = {\r\n\t\tget: (nameOrAbility: string | Ability | null | undefined): Ability => {\r\n\t\t\tif (nameOrAbility && typeof nameOrAbility !== 'string') {\r\n\t\t\t\t// TODO: don't accept Abilities here\r\n\t\t\t\treturn nameOrAbility;\r\n\t\t\t}\r\n\t\t\tlet name = nameOrAbility || '';\r\n\t\t\tlet id = toID(nameOrAbility);\r\n\t\t\tif (window.BattleAliases && id in BattleAliases) {\r\n\t\t\t\tname = BattleAliases[id];\r\n\t\t\t\tid = toID(name);\r\n\t\t\t}\r\n\t\t\tif (!window.BattleAbilities) window.BattleAbilities = {};\r\n\t\t\tlet data = window.BattleAbilities[id];\r\n\t\t\tif (data && typeof data.exists === 'boolean') return data;\r\n\t\t\tif (!data) data = { exists: false };\r\n\t\t\tlet ability = new Ability(id, name, data);\r\n\t\t\twindow.BattleAbilities[id] = ability;\r\n\t\t\treturn ability;\r\n\t\t},\r\n\t};\r\n\r\n\tspecies = {\r\n\t\tget: (nameOrSpecies: string | Species | null | undefined): Species => {\r\n\t\t\tif (nameOrSpecies && typeof nameOrSpecies !== 'string') {\r\n\t\t\t\t// TODO: don't accept Species' here\r\n\t\t\t\treturn nameOrSpecies;\r\n\t\t\t}\r\n\t\t\tlet name = nameOrSpecies || '';\r\n\t\t\tlet id = toID(nameOrSpecies);\r\n\t\t\tlet formid = id;\r\n\t\t\tif (!window.BattlePokedexAltForms) window.BattlePokedexAltForms = {};\r\n\t\t\tif (formid in window.BattlePokedexAltForms) return window.BattlePokedexAltForms[formid];\r\n\t\t\tif (window.BattleAliases && id in BattleAliases) {\r\n\t\t\t\tname = BattleAliases[id];\r\n\t\t\t\tid = toID(name);\r\n\t\t\t} else if (window.BattlePokedex && !(id in BattlePokedex) && window.BattleBaseSpeciesChart) {\r\n\t\t\t\tfor (const baseSpeciesId of BattleBaseSpeciesChart) {\r\n\t\t\t\t\tif (formid.startsWith(baseSpeciesId)) {\r\n\t\t\t\t\t\tid = baseSpeciesId;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (!window.BattlePokedex) window.BattlePokedex = {};\r\n\t\t\tlet data = window.BattlePokedex[id];\r\n\r\n\t\t\tlet species: Species;\r\n\t\t\tif (data && typeof data.exists === 'boolean') {\r\n\t\t\t\tspecies = data;\r\n\t\t\t} else {\r\n\t\t\t\tif (!data) data = { exists: false };\r\n\t\t\t\tif (!data.tier && id.endsWith('totem')) {\r\n\t\t\t\t\tdata.tier = this.species.get(id.slice(0, -5)).tier;\r\n\t\t\t\t}\r\n\t\t\t\tif (!data.tier && data.baseSpecies && toID(data.baseSpecies) !== id) {\r\n\t\t\t\t\tdata.tier = this.species.get(data.baseSpecies).tier;\r\n\t\t\t\t}\r\n\t\t\t\tdata.nfe = data.id === 'dipplin' || !!(data as Species).evos?.some(evo => {\r\n\t\t\t\t\tconst evoSpecies = this.species.get(evo);\r\n\t\t\t\t\treturn !evoSpecies.isNonstandard || evoSpecies.isNonstandard === data.isNonstandard ||\r\n\t\t\t\t\t\t// Pokemon with Hisui evolutions\r\n\t\t\t\t\t\tevoSpecies.isNonstandard === \"Unobtainable\";\r\n\t\t\t\t});\r\n\t\t\t\tspecies = new Species(id, name, data);\r\n\t\t\t\twindow.BattlePokedex[id] = species;\r\n\t\t\t}\r\n\r\n\t\t\tif (species.cosmeticFormes) {\r\n\t\t\t\tfor (const forme of species.cosmeticFormes) {\r\n\t\t\t\t\tif (toID(forme) === formid) {\r\n\t\t\t\t\t\tspecies = new Species(formid, name, {\r\n\t\t\t\t\t\t\t...species,\r\n\t\t\t\t\t\t\tname: forme,\r\n\t\t\t\t\t\t\tforme: forme.slice(species.name.length + 1),\r\n\t\t\t\t\t\t\tbaseForme: \"\",\r\n\t\t\t\t\t\t\tbaseSpecies: species.name,\r\n\t\t\t\t\t\t\totherFormes: null,\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\twindow.BattlePokedexAltForms[formid] = species;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn species;\r\n\t\t},\r\n\t};\r\n\r\n\ttypes = {\r\n\t\tallCache: null as Type[] | null,\r\n\t\tnamesCache: null as Dex.TypeName[] | null,\r\n\t\tget: (type: any): Type => {\r\n\t\t\tif (!type || typeof type === 'string') {\r\n\t\t\t\tconst id = toID(type) as string;\r\n\t\t\t\tconst name = id.substr(0, 1).toUpperCase() + id.substr(1);\r\n\t\t\t\ttype = window.BattleTypeChart?.[id] || {};\r\n\t\t\t\tif (type.damageTaken) type.exists = true;\r\n\t\t\t\tif (!type.id) type.id = id;\r\n\t\t\t\tif (!type.name) type.name = name;\r\n\t\t\t\tif (!type.effectType) {\r\n\t\t\t\t\ttype.effectType = 'Type';\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn type;\r\n\t\t},\r\n\t\tall: (): readonly Type[] => {\r\n\t\t\tif (this.types.allCache) return this.types.allCache;\r\n\t\t\tconst types = [];\r\n\t\t\tfor (const id in (window.BattleTypeChart || {})) {\r\n\t\t\t\ttypes.push(Dex.types.get(id));\r\n\t\t\t}\r\n\t\t\tif (types.length) this.types.allCache = types;\r\n\t\t\treturn types;\r\n\t\t},\r\n\t\tnames: (): readonly Dex.TypeName[] => {\r\n\t\t\tif (this.types.namesCache) return this.types.namesCache;\r\n\t\t\tconst names = this.types.all().map(type => type.name as Dex.TypeName);\r\n\t\t\tnames.splice(names.indexOf('Stellar'), 1);\r\n\t\t\tif (names.length) this.types.namesCache = names;\r\n\t\t\treturn names;\r\n\t\t},\r\n\t\tisName: (name: string | null): boolean => {\r\n\t\t\tconst id = toID(name);\r\n\t\t\tif (name !== id.substr(0, 1).toUpperCase() + id.substr(1)) return false;\r\n\t\t\treturn window.BattleTypeChart?.hasOwnProperty(id);\r\n\t\t},\r\n\t};\r\n\r\n\thasAbility(species: Species, ability: string) {\r\n\t\tfor (const i in species.abilities) {\r\n\t\t\tif (ability === species.abilities[i as '0']) return true;\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\tloadSpriteData(gen: 'xy' | 'bw') {\r\n\t\tif (this.loadedSpriteData[gen]) return;\r\n\t\tthis.loadedSpriteData[gen] = 1;\r\n\r\n\t\tlet path = $('script[src*=\"pokedex-mini.js\"]').attr('src') || '';\r\n\t\tlet qs = '?' + (path.split('?')[1] || '');\r\n\t\tpath = ((/.+?(?=data\\/pokedex-mini\\.js)/.exec(path)) || [])[0] || '';\r\n\r\n\t\tlet el = document.createElement('script');\r\n\t\tel.src = path + 'data/pokedex-mini-bw.js' + qs;\r\n\t\tdocument.getElementsByTagName('body')[0].appendChild(el);\r\n\t}\r\n\tgetSpriteData(pokemon: Pokemon | Species | string, isFront: boolean, options: {\r\n\t\tgen?: number,\r\n\t\tshiny?: boolean,\r\n\t\tgender?: Dex.GenderName,\r\n\t\tafd?: boolean,\r\n\t\tnoScale?: boolean,\r\n\t\tmod?: string,\r\n\t\tdynamax?: boolean,\r\n\t} = { gen: 6 }) {\r\n\t\tconst mechanicsGen = options.gen || 6;\r\n\t\tlet isDynamax = !!options.dynamax;\r\n\t\tif (pokemon instanceof Pokemon) {\r\n\t\t\tif (pokemon.volatiles.transform) {\r\n\t\t\t\toptions.shiny = pokemon.volatiles.transform[2];\r\n\t\t\t\toptions.gender = pokemon.volatiles.transform[3];\r\n\t\t\t} else {\r\n\t\t\t\toptions.shiny = pokemon.shiny;\r\n\t\t\t\toptions.gender = pokemon.gender;\r\n\t\t\t}\r\n\t\t\tlet isGigantamax = false;\r\n\t\t\tif (pokemon.volatiles.dynamax) {\r\n\t\t\t\tif (pokemon.volatiles.dynamax[1]) {\r\n\t\t\t\t\tisGigantamax = true;\r\n\t\t\t\t} else if (options.dynamax !== false) {\r\n\t\t\t\t\tisDynamax = true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tpokemon = pokemon.getSpeciesForme() + (isGigantamax ? '-Gmax' : '');\r\n\t\t}\r\n\t\tconst species = Dex.species.get(pokemon);\r\n\t\t// Gmax sprites are already extremely large, so we don't need to double.\r\n\t\tif (species.name.endsWith('-Gmax')) isDynamax = false;\r\n\t\tlet spriteData = {\r\n\t\t\tgen: mechanicsGen,\r\n\t\t\tw: 96,\r\n\t\t\th: 96,\r\n\t\t\ty: 0,\r\n\t\t\turl: Dex.resourcePrefix + 'sprites/',\r\n\t\t\tpixelated: true,\r\n\t\t\tisFrontSprite: false,\r\n\t\t\tcryurl: '',\r\n\t\t\tshiny: options.shiny,\r\n\t\t};\r\n\t\tlet name = species.spriteid;\r\n\t\tlet dir;\r\n\t\tlet facing;\r\n\t\tif (isFront) {\r\n\t\t\tspriteData.isFrontSprite = true;\r\n\t\t\tdir = '';\r\n\t\t\tfacing = 'front';\r\n\t\t} else {\r\n\t\t\tdir = '-back';\r\n\t\t\tfacing = 'back';\r\n\t\t}\r\n\r\n\t\t// Decide which gen sprites to use.\r\n\t\t//\r\n\t\t// There are several different generations we care about here:\r\n\t\t//\r\n\t\t//   - mechanicsGen: the generation number of the mechanics and battle (options.gen)\r\n\t\t//   - graphicsGen: the generation number of sprite/field graphics the user has requested.\r\n\t\t//     This will default to mechanicsGen, but may be altered depending on user preferences.\r\n\t\t//   - spriteData.gen: the generation number of a the specific Pokemon sprite in question.\r\n\t\t//     This defaults to graphicsGen, but if the graphicsGen doesn't have a sprite for the Pokemon\r\n\t\t//     (eg. Darmanitan in graphicsGen 2) then we go up gens until it exists.\r\n\t\t//\r\n\t\tlet graphicsGen = mechanicsGen;\r\n\t\tif (Dex.prefs('nopastgens')) graphicsGen = 6;\r\n\t\tif (Dex.prefs('bwgfx') && graphicsGen >= 6) graphicsGen = 5;\r\n\t\tspriteData.gen = Math.max(graphicsGen, Math.min(species.gen, 5));\r\n\t\tconst baseDir = ['', 'gen1', 'gen2', 'gen3', 'gen4', 'gen5', '', '', '', ''][spriteData.gen];\r\n\r\n\t\tlet miscData = null;\r\n\t\tlet speciesid = species.id;\r\n\t\tif (species.isTotem) speciesid = toID(name);\r\n\t\tif (window.BattlePokemonSprites) miscData = BattlePokemonSprites[speciesid];\r\n\t\tif (!miscData && window.BattlePokemonSpritesBW) miscData = BattlePokemonSpritesBW[speciesid];\r\n\t\tif (!miscData) miscData = {};\r\n\r\n\t\tif (miscData.num !== 0 && miscData.num > -5000) {\r\n\t\t\tlet baseSpeciesid = toID(species.baseSpecies);\r\n\t\t\tspriteData.cryurl = 'audio/cries/' + baseSpeciesid;\r\n\t\t\tlet formeid = species.formeid;\r\n\t\t\tif (species.isMega || formeid && (\r\n\t\t\t\tformeid === '-crowned' ||\r\n\t\t\t\tformeid === '-eternal' ||\r\n\t\t\t\tformeid === '-eternamax' ||\r\n\t\t\t\tformeid === '-four' ||\r\n\t\t\t\tformeid === '-hangry' ||\r\n\t\t\t\tformeid === '-hero' ||\r\n\t\t\t\tformeid === '-lowkey' ||\r\n\t\t\t\tformeid === '-noice' ||\r\n\t\t\t\tformeid === '-primal' ||\r\n\t\t\t\tformeid === '-rapidstrike' ||\r\n\t\t\t\tformeid === '-roaming' ||\r\n\t\t\t\tformeid === '-school' ||\r\n\t\t\t\tformeid === '-sky' ||\r\n\t\t\t\tformeid === '-starter' ||\r\n\t\t\t\tformeid === '-super' ||\r\n\t\t\t\tformeid === '-therian' ||\r\n\t\t\t\tformeid === '-unbound' ||\r\n\t\t\t\tbaseSpeciesid === 'calyrex' ||\r\n\t\t\t\tbaseSpeciesid === 'kyurem' ||\r\n\t\t\t\tbaseSpeciesid === 'cramorant' ||\r\n\t\t\t\tbaseSpeciesid === 'indeedee' ||\r\n\t\t\t\tbaseSpeciesid === 'lycanroc' ||\r\n\t\t\t\tbaseSpeciesid === 'necrozma' ||\r\n\t\t\t\tbaseSpeciesid === 'oinkologne' ||\r\n\t\t\t\tbaseSpeciesid === 'oricorio' ||\r\n\t\t\t\tbaseSpeciesid === 'slowpoke' ||\r\n\t\t\t\tbaseSpeciesid === 'tatsugiri' ||\r\n\t\t\t\tbaseSpeciesid === 'zygarde'\r\n\t\t\t)) {\r\n\t\t\t\tspriteData.cryurl += formeid;\r\n\t\t\t}\r\n\t\t\tspriteData.cryurl += '.mp3';\r\n\t\t}\r\n\r\n\t\tif (options.shiny && mechanicsGen > 1) dir += '-shiny';\r\n\r\n\t\t// April Fool's 2014\r\n\t\tif (Dex.afdMode || options.afd) {\r\n\t\t\t// Explicit false check above means AFD will be off if the user disables it - no matter what\r\n\t\t\tdir = 'afd' + dir;\r\n\t\t\tspriteData.url += dir + '/' + name + '.png';\r\n\t\t\t// Duplicate code but needed to make AFD tinymax work\r\n\t\t\t// April Fool's 2020\r\n\t\t\tif (isDynamax && !options.noScale) {\r\n\t\t\t\tspriteData.w *= 0.25;\r\n\t\t\t\tspriteData.h *= 0.25;\r\n\t\t\t\tspriteData.y += -22;\r\n\t\t\t} else if (species.isTotem && !options.noScale) {\r\n\t\t\t\tspriteData.w *= 0.5;\r\n\t\t\t\tspriteData.h *= 0.5;\r\n\t\t\t\tspriteData.y += -11;\r\n\t\t\t}\r\n\t\t\treturn spriteData;\r\n\t\t}\r\n\r\n\t\t// Mod Cries\r\n\t\tif (options.mod) {\r\n\t\t\tspriteData.cryurl = `sprites/${options.mod}/audio/${toID(species.baseSpecies)}`;\r\n\t\t\tspriteData.cryurl += '.mp3';\r\n\t\t}\r\n\r\n\t\tlet animatedSprite = false;\r\n\t\tif (!Dex.prefs('noanim') && !Dex.prefs('nogif') && spriteData.gen >= 5) {\r\n\t\t\tconst animationArray: [AnyObject, string][] = [];\r\n\t\t\tif (baseDir === '' && window.BattlePokemonSprites) {\r\n\t\t\t\tanimationArray.push([BattlePokemonSprites[speciesid], '']);\r\n\t\t\t}\r\n\t\t\tif (window.BattlePokemonSpritesBW) {\r\n\t\t\t\tanimationArray.push([BattlePokemonSpritesBW[speciesid], 'gen5']);\r\n\t\t\t}\r\n\t\t\tfor (const [animationData, animDir] of animationArray) {\r\n\t\t\t\tif (!animationData) continue;\r\n\t\t\t\tif (animationData[facing + 'f'] && options.gender === 'F') facing += 'f';\r\n\t\t\t\tif (!animationData[facing]) continue;\r\n\t\t\t\tif (facing.endsWith('f')) name += '-f';\r\n\t\t\t\tif (spriteData.gen >= 6) spriteData.pixelated = false;\r\n\t\t\t\tdir = animDir + 'ani' + dir;\r\n\t\t\t\tspriteData.w = animationData[facing].w;\r\n\t\t\t\tspriteData.h = animationData[facing].h;\r\n\t\t\t\tspriteData.url += dir + '/' + name + '.gif';\r\n\t\t\t\tanimatedSprite = true;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (!animatedSprite) {\r\n\t\t\t// There is no entry or enough data in pokedex-mini.js\r\n\t\t\t// Handle these in case-by-case basis; either using BW sprites or matching the played gen.\r\n\t\t\tdir = (baseDir || 'gen5') + dir;\r\n\r\n\t\t\t// Gender differences don't exist prior to Gen 4,\r\n\t\t\t// so there are no sprites for it\r\n\t\t\tif (spriteData.gen >= 4 && miscData['frontf'] && options.gender === 'F') {\r\n\t\t\t\tname += '-f';\r\n\t\t\t}\r\n\r\n\t\t\tspriteData.url += dir + '/' + name + '.png';\r\n\t\t}\r\n\r\n\t\tif (!options.noScale) {\r\n\t\t\tif (graphicsGen > 4) {\r\n\t\t\t\t// no scaling\r\n\t\t\t} else if (spriteData.isFrontSprite) {\r\n\t\t\t\tspriteData.w *= 2;\r\n\t\t\t\tspriteData.h *= 2;\r\n\t\t\t\tspriteData.y += -16;\r\n\t\t\t} else {\r\n\t\t\t\t// old gen backsprites are multiplied by 1.5x by the 3D engine\r\n\t\t\t\tspriteData.w *= 2 / 1.5;\r\n\t\t\t\tspriteData.h *= 2 / 1.5;\r\n\t\t\t\tspriteData.y += -11;\r\n\t\t\t}\r\n\t\t\tif (spriteData.gen <= 2) spriteData.y += 2;\r\n\t\t}\r\n\t\tif (isDynamax && !options.noScale) {\r\n\t\t\tspriteData.w *= 2;\r\n\t\t\tspriteData.h *= 2;\r\n\t\t\tspriteData.y += -22;\r\n\t\t} else if (species.isTotem && !options.noScale) {\r\n\t\t\tspriteData.w *= 1.5;\r\n\t\t\tspriteData.h *= 1.5;\r\n\t\t\tspriteData.y += -11;\r\n\t\t}\r\n\r\n\t\treturn spriteData;\r\n\t}\r\n\r\n\tgetPokemonIconNum(id: ID, isFemale?: boolean, facingLeft?: boolean) {\r\n\t\tlet num = 0;\r\n\t\tif (window.BattlePokemonSprites?.[id]?.num) {\r\n\t\t\tnum = BattlePokemonSprites[id].num;\r\n\t\t} else if (window.BattlePokedex?.[id]?.num) {\r\n\t\t\tnum = BattlePokedex[id].num;\r\n\t\t}\r\n\t\tif (num < 0) num = 0;\r\n\t\tif (num > 1025) num = 0;\r\n\r\n\t\tif (window.BattlePokemonIconIndexes?.[id]) {\r\n\t\t\tnum = BattlePokemonIconIndexes[id];\r\n\t\t}\r\n\r\n\t\tif (isFemale) {\r\n\t\t\tif (['unfezant', 'frillish', 'jellicent', 'meowstic', 'pyroar'].includes(id)) {\r\n\t\t\t\tnum = BattlePokemonIconIndexes[id + 'f'];\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (facingLeft) {\r\n\t\t\tif (BattlePokemonIconIndexesLeft[id]) {\r\n\t\t\t\tnum = BattlePokemonIconIndexesLeft[id];\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn num;\r\n\t}\r\n\r\n\tgetPokemonIcon(pokemon: string | Pokemon | ServerPokemon | Dex.PokemonSet | null, facingLeft?: boolean) {\r\n\t\tif (pokemon === 'pokeball') {\r\n\t\t\treturn `background:transparent url(${Dex.resourcePrefix}sprites/pokemonicons-pokeball-sheet.png) no-repeat scroll -0px 4px`;\r\n\t\t} else if (pokemon === 'pokeball-statused') {\r\n\t\t\treturn `background:transparent url(${Dex.resourcePrefix}sprites/pokemonicons-pokeball-sheet.png) no-repeat scroll -40px 4px`;\r\n\t\t} else if (pokemon === 'pokeball-fainted') {\r\n\t\t\treturn `background:transparent url(${Dex.resourcePrefix}sprites/pokemonicons-pokeball-sheet.png) no-repeat scroll -80px 4px;opacity:.4;filter:contrast(0)`;\r\n\t\t} else if (pokemon === 'pokeball-none') {\r\n\t\t\treturn `background:transparent url(${Dex.resourcePrefix}sprites/pokemonicons-pokeball-sheet.png) no-repeat scroll -80px 4px`;\r\n\t\t}\r\n\r\n\t\tlet id = toID(pokemon);\r\n\t\tif (!pokemon || typeof pokemon === 'string') pokemon = null;\r\n\t\t// @ts-expect-error safe, but too lazy to cast\r\n\t\tif (pokemon?.speciesForme) id = toID(pokemon.speciesForme);\r\n\t\t// @ts-expect-error safe, but too lazy to cast\r\n\t\tif (pokemon?.species) id = toID(pokemon.species);\r\n\t\t// @ts-expect-error safe, but too lazy to cast\r\n\t\tif (pokemon?.volatiles?.formechange && !pokemon.volatiles.transform) {\r\n\t\t\t// @ts-expect-error safe, but too lazy to cast\r\n\t\t\tid = toID(pokemon.volatiles.formechange[1]);\r\n\t\t}\r\n\t\tlet num = this.getPokemonIconNum(id, pokemon?.gender === 'F', facingLeft);\r\n\r\n\t\tlet top = Math.floor(num / 12) * 30;\r\n\t\tlet left = (num % 12) * 40;\r\n\t\tlet fainted = ((pokemon as Pokemon | ServerPokemon)?.fainted ?\r\n\t\t\t`;opacity:.3;filter:grayscale(100%) brightness(.5)` : ``);\r\n\t\treturn `background:transparent url(${Dex.resourcePrefix}sprites/pokemonicons-sheet.png?v19) no-repeat scroll -${left}px -${top}px${fainted}`;\r\n\t}\r\n\r\n\tgetTeambuilderSpriteData(pokemon: any, dex: ModdedDex = Dex): TeambuilderSpriteData {\r\n\t\tlet gen = dex.gen;\r\n\t\tlet id = toID(pokemon.species || pokemon);\r\n\t\tlet species = Dex.species.get(id);\r\n\t\tlet spriteid: string;\r\n\t\tif (typeof pokemon === 'string') {\r\n\t\t\tspriteid = species.spriteid || id;\r\n\t\t} else {\r\n\t\t\tspriteid = pokemon.spriteid;\r\n\t\t\tif (pokemon.species && !spriteid) {\r\n\t\t\t\tspriteid = species.spriteid || id;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (species.exists === false) return { spriteDir: 'sprites/gen5', spriteid: '0', x: 10, y: 5 };\r\n\t\tif (Dex.afdMode) {\r\n\t\t\treturn {\r\n\t\t\t\tspriteid,\r\n\t\t\t\tspriteDir: 'sprites/afd',\r\n\t\t\t\tshiny: !!pokemon.shiny,\r\n\t\t\t\tx: 10,\r\n\t\t\t\ty: 5,\r\n\t\t\t};\r\n\t\t}\r\n\t\tconst spriteData: TeambuilderSpriteData = {\r\n\t\t\tspriteid,\r\n\t\t\tspriteDir: 'sprites/dex',\r\n\t\t\tx: -2,\r\n\t\t\ty: -3,\r\n\t\t};\r\n\t\tif (pokemon.shiny) spriteData.shiny = true;\r\n\t\tif (dex.modid === 'gen7letsgo') gen = 8;\r\n\t\tif (Dex.prefs('nopastgens')) gen = 9;\r\n\t\tif (Dex.prefs('bwgfx') && gen > 5) gen = 5;\r\n\t\tlet homeExists = (!species.isNonstandard || !['CAP', 'Custom'].includes(species.isNonstandard) ||\r\n\t\t\tspecies.id === \"xerneasneutral\") && ![\r\n\t\t\t\"floetteeternal\", \"pichuspikyeared\", \"pikachubelle\", \"pikachucosplay\", \"pikachulibre\", \"pikachuphd\", \"pikachupopstar\", \"pikachurockstar\",\r\n\t\t].includes(species.id);\r\n\t\tif (gen >= 8 && homeExists) {\r\n\t\t\tspriteData.spriteDir = 'sprites/home-centered';\r\n\t\t\tspriteData.x = 8;\r\n\t\t\tspriteData.y = 10;\r\n\t\t\tspriteData.h = 96;\r\n\t\t\treturn spriteData;\r\n\t\t}\r\n\t\tlet xydexExists = (!species.isNonstandard || species.isNonstandard === 'Past' || species.isNonstandard === 'CAP') || [\r\n\t\t\t\"pikachustarter\", \"eeveestarter\", \"meltan\", \"melmetal\", \"pokestarufo\", \"pokestarufo2\", \"pokestarbrycenman\", \"pokestarmt\", \"pokestarmt2\", \"pokestargiant\", \"pokestarhumanoid\", \"pokestarmonster\", \"pokestarf00\", \"pokestarf002\", \"pokestarspirit\",\r\n\t\t].includes(species.id);\r\n\t\tif (species.gen >= 8 && species.isNonstandard !== 'CAP') xydexExists = false;\r\n\t\tif (gen >= 6 && xydexExists) {\r\n\t\t\tif (species.gen >= 7) {\r\n\t\t\t\tspriteData.x = -6;\r\n\t\t\t\tspriteData.y = -7;\r\n\t\t\t} else if (id.substr(0, 6) === 'arceus') {\r\n\t\t\t\tspriteData.x = -2;\r\n\t\t\t\tspriteData.y = 7;\r\n\t\t\t} else if (id === 'garchomp') {\r\n\t\t\t\tspriteData.x = -2;\r\n\t\t\t\tspriteData.y = 2;\r\n\t\t\t} else if (id === 'garchompmega') {\r\n\t\t\t\tspriteData.x = -2;\r\n\t\t\t\tspriteData.y = 0;\r\n\t\t\t}\r\n\t\t\treturn spriteData;\r\n\t\t}\r\n\t\tspriteData.spriteDir = 'sprites/gen5';\r\n\t\tif (gen <= 1 && species.gen <= 1) spriteData.spriteDir = 'sprites/gen1';\r\n\t\telse if (gen <= 2 && species.gen <= 2) spriteData.spriteDir = 'sprites/gen2';\r\n\t\telse if (gen <= 3 && species.gen <= 3) spriteData.spriteDir = 'sprites/gen3';\r\n\t\telse if (gen <= 4 && species.gen <= 4) spriteData.spriteDir = 'sprites/gen4';\r\n\t\tspriteData.x = 10;\r\n\t\tspriteData.y = 5;\r\n\t\treturn spriteData;\r\n\t}\r\n\r\n\tgetTeambuilderSprite(pokemon: any, dex?: ModdedDex, xOffset = 0, yOffset = 0) {\r\n\t\tif (!pokemon) return '';\r\n\t\tconst data = this.getTeambuilderSpriteData(pokemon, dex);\r\n\t\tconst shiny = (data.shiny ? '-shiny' : '');\r\n\t\tconst resize = (data.h ? `background-size:${data.h}px` : '');\r\n\t\treturn `background-image:url(${Dex.resourcePrefix}${data.spriteDir}${shiny}/${data.spriteid}.png);background-position:${data.x + xOffset}px ${data.y + yOffset}px;background-repeat:no-repeat;${resize}`;\r\n\t}\r\n\r\n\tgetItemIcon(item: any) {\r\n\t\tlet num = 0;\r\n\t\tif (typeof item === 'string' && window.BattleItems) item = window.BattleItems[toID(item)];\r\n\t\tif (item?.spritenum) num = item.spritenum;\r\n\r\n\t\tlet top = Math.floor(num / 16) * 24;\r\n\t\tlet left = (num % 16) * 24;\r\n\t\treturn `background:transparent url(${Dex.resourcePrefix}sprites/itemicons-sheet.png?v1) no-repeat scroll -${left}px -${top}px`;\r\n\t}\r\n\r\n\tgetTypeIcon(type: string | null, b?: boolean) { // b is just for utilichart.js\r\n\t\ttype = this.types.get(type).name;\r\n\t\tif (!type) type = '???';\r\n\t\tlet sanitizedType = type.replace(/\\?/g, '%3f');\r\n\t\treturn `<img src=\"${Dex.resourcePrefix}sprites/types/${sanitizedType}.png\" alt=\"${type}\" height=\"14\" width=\"32\" class=\"pixelated${b ? ' b' : ''}\" />`;\r\n\t}\r\n\r\n\tgetCategoryIcon(category: string | null) {\r\n\t\tconst categoryID = toID(category);\r\n\t\tlet sanitizedCategory = '';\r\n\t\tswitch (categoryID) {\r\n\t\tcase 'physical':\r\n\t\tcase 'special':\r\n\t\tcase 'status':\r\n\t\t\tsanitizedCategory = categoryID.charAt(0).toUpperCase() + categoryID.slice(1);\r\n\t\t\tbreak;\r\n\t\tdefault:\r\n\t\t\tsanitizedCategory = 'undefined';\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\treturn `<img src=\"${Dex.resourcePrefix}sprites/categories/${sanitizedCategory}.png\" alt=\"${sanitizedCategory}\" height=\"14\" width=\"32\" class=\"pixelated\" />`;\r\n\t}\r\n\r\n\tgetPokeballs() {\r\n\t\tif (this.pokeballs) return this.pokeballs;\r\n\t\tthis.pokeballs = [];\r\n\t\twindow.BattleItems ||= {};\r\n\t\tfor (const data of Object.values(BattleItems)) {\r\n\t\t\tif (!data.isPokeball) continue;\r\n\t\t\tthis.pokeballs.push(data.name);\r\n\t\t}\r\n\t\treturn this.pokeballs;\r\n\t}\r\n};\r\n\r\nexport class ModdedDex {\r\n\treadonly gen: number;\r\n\treadonly modid: ID;\r\n\treadonly cache = {\r\n\t\tMoves: {} as { [k: string]: Move },\r\n\t\tItems: {} as { [k: string]: Item },\r\n\t\tAbilities: {} as { [k: string]: Ability },\r\n\t\tSpecies: {} as { [k: string]: Species },\r\n\t\tTypes: {} as { [k: string]: Dex.Effect },\r\n\t};\r\n\tpokeballs: string[] | null = null;\r\n\tconstructor(modid: ID) {\r\n\t\tthis.modid = modid;\r\n\t\tconst gen = parseInt(modid.charAt(3), 10);\r\n\t\tif (!modid.startsWith('gen') || !gen) throw new Error(\"Unsupported modid\");\r\n\t\tthis.gen = gen;\r\n\t}\r\n\tmoves = {\r\n\t\tget: (name: string): Move => {\r\n\t\t\tlet id = toID(name);\r\n\t\t\tif (window.BattleAliases && id in BattleAliases) {\r\n\t\t\t\tname = BattleAliases[id];\r\n\t\t\t\tid = toID(name);\r\n\t\t\t}\r\n\t\t\tif (this.cache.Moves.hasOwnProperty(id)) return this.cache.Moves[id];\r\n\r\n\t\t\tlet data = { ...Dex.moves.get(name) };\r\n\r\n\t\t\tfor (let i = Dex.gen - 1; i >= this.gen; i--) {\r\n\t\t\t\tconst table = window.BattleTeambuilderTable[`gen${i}`];\r\n\t\t\t\tif (id in table.overrideMoveData) {\r\n\t\t\t\t\tObject.assign(data, table.overrideMoveData[id]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (this.modid !== `gen${this.gen}`) {\r\n\t\t\t\tconst table = window.BattleTeambuilderTable[this.modid];\r\n\t\t\t\tif (id in table.overrideMoveData) {\r\n\t\t\t\t\tObject.assign(data, table.overrideMoveData[id]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (this.gen <= 3 && data.category !== 'Status') {\r\n\t\t\t\tdata.category = Dex.getGen3Category(data.type);\r\n\t\t\t}\r\n\r\n\t\t\tconst move = new Move(id, name, data);\r\n\t\t\tthis.cache.Moves[id] = move;\r\n\t\t\treturn move;\r\n\t\t},\r\n\t};\r\n\r\n\titems = {\r\n\t\tget: (name: string): Item => {\r\n\t\t\tlet id = toID(name);\r\n\t\t\tif (window.BattleAliases && id in BattleAliases) {\r\n\t\t\t\tname = BattleAliases[id];\r\n\t\t\t\tid = toID(name);\r\n\t\t\t}\r\n\t\t\tif (this.cache.Items.hasOwnProperty(id)) return this.cache.Items[id];\r\n\r\n\t\t\tlet data = { ...Dex.items.get(name) };\r\n\r\n\t\t\tfor (let i = Dex.gen - 1; i >= this.gen; i--) {\r\n\t\t\t\tconst table = window.BattleTeambuilderTable[`gen${i}`];\r\n\t\t\t\tif (id in table.overrideItemData) {\r\n\t\t\t\t\tObject.assign(data, table.overrideItemData[id]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (this.modid !== `gen${this.gen}`) {\r\n\t\t\t\tconst table = window.BattleTeambuilderTable[this.modid];\r\n\t\t\t\tif (id in table.overrideItemData) {\r\n\t\t\t\t\tObject.assign(data, table.overrideItemData[id]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tconst item = new Item(id, name, data);\r\n\t\t\tthis.cache.Items[id] = item;\r\n\t\t\treturn item;\r\n\t\t},\r\n\t};\r\n\r\n\tabilities = {\r\n\t\tget: (name: string): Ability => {\r\n\t\t\tlet id = toID(name);\r\n\t\t\tif (window.BattleAliases && id in BattleAliases) {\r\n\t\t\t\tname = BattleAliases[id];\r\n\t\t\t\tid = toID(name);\r\n\t\t\t}\r\n\t\t\tif (this.cache.Abilities.hasOwnProperty(id)) return this.cache.Abilities[id];\r\n\r\n\t\t\tlet data = { ...Dex.abilities.get(name) };\r\n\r\n\t\t\tfor (let i = Dex.gen - 1; i >= this.gen; i--) {\r\n\t\t\t\tconst table = window.BattleTeambuilderTable[`gen${i}`];\r\n\t\t\t\tif (id in table.overrideAbilityData) {\r\n\t\t\t\t\tObject.assign(data, table.overrideAbilityData[id]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (this.modid !== `gen${this.gen}`) {\r\n\t\t\t\tconst table = window.BattleTeambuilderTable[this.modid];\r\n\t\t\t\tif (id in table.overrideAbilityData) {\r\n\t\t\t\t\tObject.assign(data, table.overrideAbilityData[id]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tconst ability = new Ability(id, name, data);\r\n\t\t\tthis.cache.Abilities[id] = ability;\r\n\t\t\treturn ability;\r\n\t\t},\r\n\t};\r\n\r\n\tspecies = {\r\n\t\tget: (name: string): Species => {\r\n\t\t\tlet id = toID(name);\r\n\t\t\tif (window.BattleAliases && id in BattleAliases) {\r\n\t\t\t\tname = BattleAliases[id];\r\n\t\t\t\tid = toID(name);\r\n\t\t\t}\r\n\t\t\tif (this.cache.Species.hasOwnProperty(id)) return this.cache.Species[id];\r\n\r\n\t\t\tlet data = { ...Dex.species.get(name) };\r\n\r\n\t\t\tfor (let i = Dex.gen - 1; i >= this.gen; i--) {\r\n\t\t\t\tconst table = window.BattleTeambuilderTable[`gen${i}`];\r\n\t\t\t\tif (id in table.overrideSpeciesData) {\r\n\t\t\t\t\tObject.assign(data, table.overrideSpeciesData[id]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (this.modid !== `gen${this.gen}`) {\r\n\t\t\t\tconst table = window.BattleTeambuilderTable[this.modid];\r\n\t\t\t\tif (id in table.overrideSpeciesData) {\r\n\t\t\t\t\tObject.assign(data, table.overrideSpeciesData[id]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (this.gen < 3 || this.modid === 'gen7letsgo') {\r\n\t\t\t\tdata.abilities = { 0: \"No Ability\" };\r\n\t\t\t}\r\n\r\n\t\t\tconst table = window.BattleTeambuilderTable[this.modid];\r\n\t\t\tif (id in table.overrideTier) data.tier = table.overrideTier[id];\r\n\t\t\tif (!data.tier && id.endsWith('totem')) {\r\n\t\t\t\tdata.tier = this.species.get(id.slice(0, -5)).tier;\r\n\t\t\t}\r\n\t\t\tif (!data.tier && data.baseSpecies && toID(data.baseSpecies) !== id) {\r\n\t\t\t\tdata.tier = this.species.get(data.baseSpecies).tier;\r\n\t\t\t}\r\n\t\t\tif (data.gen > this.gen) data.tier = 'Illegal';\r\n\t\t\tdata.nfe = data.id === 'dipplin' || !!data.evos?.some(evo => {\r\n\t\t\t\tconst evoSpecies = this.species.get(evo);\r\n\t\t\t\treturn !evoSpecies.isNonstandard || evoSpecies.isNonstandard === data.isNonstandard ||\r\n\t\t\t\t\t// Pokemon with Hisui evolutions\r\n\t\t\t\t\tevoSpecies.isNonstandard === \"Unobtainable\";\r\n\t\t\t});\r\n\r\n\t\t\tconst species = new Species(id, name, data);\r\n\t\t\tthis.cache.Species[id] = species;\r\n\t\t\treturn species;\r\n\t\t},\r\n\t};\r\n\r\n\ttypes = {\r\n\t\tnamesCache: null as readonly Dex.TypeName[] | null,\r\n\t\tnames: (): readonly Dex.TypeName[] => {\r\n\t\t\tif (this.types.namesCache) return this.types.namesCache;\r\n\t\t\tconst names = Dex.types.names();\r\n\t\t\tif (!names.length) return [];\r\n\t\t\tconst curNames = [...names];\r\n\t\t\t// if (this.gen < 9) curNames.splice(curNames.indexOf('Stellar'), 1);\r\n\t\t\tif (this.gen < 6) curNames.splice(curNames.indexOf('Fairy'), 1);\r\n\t\t\tif (this.gen < 2) curNames.splice(curNames.indexOf('Dark'), 1);\r\n\t\t\tif (this.gen < 2) curNames.splice(curNames.indexOf('Steel'), 1);\r\n\t\t\tthis.types.namesCache = curNames;\r\n\t\t\treturn curNames;\r\n\t\t},\r\n\t\tget: (name: string): Dex.Type => {\r\n\t\t\tconst id = toID(name);\r\n\t\t\tname = id.substr(0, 1).toUpperCase() + id.substr(1);\r\n\r\n\t\t\tif (this.cache.Types.hasOwnProperty(id)) return this.cache.Types[id];\r\n\r\n\t\t\tlet data = { ...Dex.types.get(name) };\r\n\r\n\t\t\tfor (let i = 7; i >= this.gen; i--) {\r\n\t\t\t\tconst table = window.BattleTeambuilderTable[`gen${i}`];\r\n\t\t\t\tif (id in table.removeType) {\r\n\t\t\t\t\tdata.exists = false;\r\n\t\t\t\t\t// don't bother correcting its attributes given it doesn't exist\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\tif (id in table.overrideTypeChart) {\r\n\t\t\t\t\tdata = { ...data, ...table.overrideTypeChart[id] };\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tthis.cache.Types[id] = data;\r\n\t\t\treturn data;\r\n\t\t},\r\n\t};\r\n\r\n\tgetPokeballs() {\r\n\t\tif (this.pokeballs) return this.pokeballs;\r\n\t\tthis.pokeballs = [];\r\n\t\twindow.BattleItems ||= {};\r\n\t\tfor (const data of Object.values(BattleItems)) {\r\n\t\t\tif (data.gen && data.gen > this.gen) continue;\r\n\t\t\tif (!data.isPokeball) continue;\r\n\t\t\tthis.pokeballs.push(data.name);\r\n\t\t}\r\n\t\treturn this.pokeballs;\r\n\t}\r\n}\r\n\r\nif (typeof require === 'function') {\r\n\t// in Node\r\n\tglobal.Dex = Dex;\r\n\tglobal.toID = toID;\r\n}\r\n"],"mappings":"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","ignoreList":[]}